# Unified Navigation (Client/Staff/Admin/Org)\n\nSTEVI now uses one app shell with role-based navigation. No workspace switching exists; visibility is driven by Supabase roles and approval status.\n\n## Source of truth\n- Nav config: `src/lib/portal-navigation.ts`\n- Shell components: `src/components/layout/app-navigation.tsx`, `src/components/shells/app-shell.tsx`\n- Capability flags: `PortalAccess` in `src/lib/portal-access.ts`\n\n## Adding a new surface\n1. **Access check**: Reuse existing Supabase roles. Add/extend a boolean in `PortalAccess` only if necessary; avoid new role strings without backend agreement.\n2. **Nav entry**: Add the route under the correct section/group in `portal-navigation.ts` with a `requires` guard that matches your capability flag.\n3. **Route guard**: On the page/action, redirect using `resolveLandingPath` when access is missing. Do not rely on hidden links alone.\n4. **RLS alignment**: Ensure Supabase policies already enforce the same capability. Coordinate with the Supabase team before schema/policy changes.\n5. **Caching**: For mutating admin/staff pages, call `revalidatePath`/`revalidateTag` as needed so marketing/public content stays in sync.\n6. **Design**: Use Material 3 tokens and shared components; avoid ad-hoc colors/spacing. Sidebar and header are provided by the app shell—keep page content within the page shell spacing.\n7. **Tests**: Add/adjust Vitest/Playwright coverage so nav visibility matches roles and redirects follow landing priority (admin → staff → org → client).\n\n## Landing priority\n`resolveLandingPath` routes users based on access: admin `/admin/operations`, else staff `/staff/overview`, else org `/org`, else `/home`.\n\n## Client preview\nStaff/admin/org users on client pages are in “client preview” mode; actions that would mutate client data should remain guarded.\n\n## Anti-patterns\n- No localStorage/cookie state for “current workspace”.\n- No duplicate nav definitions; update `portal-navigation.ts` only.\n- No backend changes without RLS review.\n*** End Patch
