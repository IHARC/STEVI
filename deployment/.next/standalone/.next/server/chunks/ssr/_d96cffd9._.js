module.exports=[63985,a=>{"use strict";let b="[redacted]",c=["password","token","secret","authorization","cookie","session","otp","code","sin","ssn","birth","dob","email","phone","contact","address"];function d(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return b===Object.prototype||null===b}let e=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,f=/^[0-9]+$/,g=/^[a-z0-9_]+$/i,h=/^[a-zA-Z0-9._:-]+$/;function i(a){if(null==a)return null;let b="number"==typeof a?String(a):a.trim?.()??a;return"string"!=typeof b||0===b.length?null:e.test(b)||f.test(b)?b:b.slice(0,128)}function j(a){let b=i(a);return b&&e.test(b)?b:null}function k(a){if(!a)return null;let{schema:b,table:c,id:d}=a;if(!g.test(b)||!g.test(c))return null;let e=i(d);return e&&h.test(e)?`${b.toLowerCase()}.${c.toLowerCase()}:${e}`:null}async function l(a,{actorProfileId:e=null,action:f,entityType:g,entityRef:h,entityId:i,meta:l}){let m=l&&d(l)?function a(e,f){let g={};return Object.entries(e).forEach(([e,h])=>{let i;if(i=e.toLowerCase(),c.some(a=>i.includes(a))){g[e]=b;return}let j=function c(e,f){if(void 0!==e){if(null===e)return null;if("string"==typeof e)return e.length>1024?`${e.slice(0,1024)}...`:e;if("number"==typeof e||"boolean"==typeof e)return e;if("bigint"==typeof e)return e.toString();if(e instanceof Date)return e.toISOString();if(e instanceof URL)return e.toString();if(e instanceof Error)return{name:e.name,message:e.message};if(Array.isArray(e))return e.map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Set)return Array.from(e).map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Map){let a={};return e.forEach((b,d)=>{let e=c(b,f);void 0!==e&&(a[String(d)]=e)}),a}return"object"==typeof e&&d(e)?f.has(e)?b:(f.add(e),a(e,f)):String(e)}}(h,f);void 0!==j&&(g[e]=j)}),g}(l,new WeakSet):{},n="string"==typeof h?h:k(h),o=j(i);!o&&n&&(o=j(n.split(":").pop()??null));let p=!n||"entity_ref"in m?m:{...m,entity_ref:n},q=j(e),{error:r}=await a.rpc("portal_log_audit_event",{p_action:f,p_entity_type:g,p_entity_id:o,p_meta:p,p_actor_profile_id:q});if(r)throw r}a.s(["buildEntityRef",()=>k,"logAuditEvent",()=>l],63985)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},52405,a=>{"use strict";var b=a.i(86731),c=a.i(37936),d=a.i(18558),e=a.i(16349),f=a.i(42145),g=a.i(65108),h=a.i(63985),i=a.i(20282),j=a.i(39138),k=a.i(13095);let l=["/admin","/admin/marketing/home"],m="app-branding";async function n(){let a=await (0,e.createSupabaseServerClient)(),b=await (0,g.loadPortalAccess)(a);if(!b)throw Error("Sign in to manage website content.");if(!b.canManageWebsiteContent)throw Error("Portal admin access is required.");let c=await (0,f.ensurePortalProfile)(a,b.userId);return{supabase:a,portal:a.schema("portal"),actorProfile:c}}async function o(a){let b,c,e={pill:(0,i.assertNonEmpty)(a.get("hero_pill"),"Hero pill"),headline:(0,i.assertNonEmpty)(a.get("hero_headline"),"Hero headline"),body:(0,i.assertNonEmpty)(a.get("hero_body"),"Hero body"),supporting:(0,i.assertNonEmpty)(a.get("hero_supporting"),"Hero supporting text"),imageUrl:a.get("hero_image_url")?.trim()||null,imageAlt:a.get("hero_image_alt")?.trim()||null,primaryCta:{label:(0,i.assertNonEmpty)(a.get("hero_primary_label"),"Primary CTA label"),href:(0,i.assertNonEmpty)(a.get("hero_primary_href"),"Primary CTA href"),analytics:null},secondaryLink:(b=a.get("hero_secondary_label")?.trim()??"",c=a.get("hero_secondary_href")?.trim()??"",b||c?{label:(0,i.assertNonEmpty)(b,"Secondary link label"),href:(0,i.assertNonEmpty)(c,"Secondary link href"),analytics:null}:null)};if(e.imageUrl&&!e.imageAlt)throw Error("Add alternative text for the hero image.");let f=function(a){let b;if(!a)throw Error("Context cards are required.");try{b=JSON.parse(a)}catch{throw Error("Context cards must be valid JSON.")}if(!Array.isArray(b))throw Error("Context cards must be an array.");let c=b.map((a,b)=>{if(!a||"object"!=typeof a)throw Error(`Context card ${b+1} is invalid.`);return{id:(0,i.assertNonEmpty)(a.id,`Context card ${b+1} id`),title:(0,i.assertNonEmpty)(a.title,`Context card ${b+1} title`),description:(0,i.assertNonEmpty)(a.description,`Context card ${b+1} description`),href:(0,i.assertNonEmpty)(a.href,`Context card ${b+1} href`)}});if(0===c.length)throw Error("Add at least one context card.");return c}("string"==typeof a.get("context_cards_json")?a.get("context_cards_json"):null),{supabase:g,portal:j,actorProfile:k}=await n(),m=new Date().toISOString(),{error:o}=await j.from("public_settings").upsert({setting_key:i.MARKETING_SETTINGS_KEYS.hero,setting_type:"json",setting_value:JSON.stringify(e),is_public:!0,updated_by_profile_id:k.id,updated_at:m},{onConflict:"setting_key"});if(o)throw o;let{error:p}=await j.from("public_settings").upsert({setting_key:i.MARKETING_SETTINGS_KEYS.contextCards,setting_type:"json",setting_value:JSON.stringify(f),is_public:!0,updated_by_profile_id:k.id,updated_at:m},{onConflict:"setting_key"});if(p)throw p;await (0,h.logAuditEvent)(g,{actorProfileId:k.id,action:"marketing_home_updated",entityType:"marketing_home",entityRef:(0,h.buildEntityRef)({schema:"portal",table:"public_settings",id:i.MARKETING_SETTINGS_KEYS.contextCards}),meta:{context_cards:f.length}}),l.forEach(a=>(0,d.revalidatePath)(a))}async function p(a){let b=a.get("file");if(!(b instanceof File))throw Error("Select an image to upload.");if(b.size>5242880)throw Error("Image must be under 5 MB.");let{supabase:c,actorProfile:d}=await n(),e=(0,j.sanitizeFileName)(b.name||"hero"),f=`hero/${Date.now()}-${e}`,{error:g}=await c.storage.from(m).upload(f,b,{upsert:!0,cacheControl:"3600",contentType:b.type||"image/jpeg"});if(g)throw g;let{data:i}=c.storage.from(m).getPublicUrl(f);return await (0,h.logAuditEvent)(c,{actorProfileId:d.id,action:"marketing_hero_image_uploaded",entityType:"marketing_hero_image",entityRef:(0,h.buildEntityRef)({schema:"storage",table:m,id:f}),meta:{bucket:m,path:f,size:b.size}}),{url:i.publicUrl,path:f}}(0,k.ensureServerEntryExports)([o,p]),(0,c.registerServerReference)(o,"407badbe88f2937e15e291f1270977a49cbd744a6f",null),(0,c.registerServerReference)(p,"40c78e145028d3ed019993c61524bde070d7ca5609",null),a.s([],38175),a.i(38175),a.s(["00b7ee4fee263fec1fe8acb860989f6ddb47485e3a",()=>b.$$RSC_SERVER_ACTION_0,"407badbe88f2937e15e291f1270977a49cbd744a6f",()=>o,"40c78e145028d3ed019993c61524bde070d7ca5609",()=>p],52405)}];

//# sourceMappingURL=_d96cffd9._.js.map