module.exports=[77994,a=>{"use strict";var b=a.i(72131);function c(a){let c=b.useRef({value:a,previous:a});return b.useMemo(()=>(c.current.value!==a&&(c.current.previous=c.current.value,c.current.value=a),c.current.previous),[a])}a.s(["usePrevious",()=>c])},5050,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={callServer:function(){return f.callServer},createServerReference:function(){return h.createServerReference},findSourceMapURL:function(){return g.findSourceMapURL}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(20611),g=a.r(1722),h=a.r(38783)},6015,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(68114);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{className:"relative w-full overflow-auto",children:(0,b.jsx)("table",{ref:e,className:(0,d.cn)("w-full caption-bottom text-body-md",a),...c})}));e.displayName="Table";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("thead",{ref:e,className:(0,d.cn)("[&_tr]:border-b",a),...c}));f.displayName="TableHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tbody",{ref:e,className:(0,d.cn)("[&_tr:last-child]:border-0",a),...c}));g.displayName="TableBody",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tfoot",{ref:e,className:(0,d.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...c})).displayName="TableFooter";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tr",{ref:e,className:(0,d.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...c}));h.displayName="TableRow";let i=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("th",{ref:e,className:(0,d.cn)("h-12 px-space-md text-left align-middle text-label-lg font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...c}));i.displayName="TableHead";let j=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("td",{ref:e,className:(0,d.cn)("p-space-md align-middle [&:has([role=checkbox])]:pr-0",a),...c}));j.displayName="TableCell",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("caption",{ref:e,className:(0,d.cn)("mt-space-md text-body-md text-muted-foreground",a),...c})).displayName="TableCaption",a.s(["Table",()=>e,"TableBody",()=>g,"TableCell",()=>j,"TableHead",()=>i,"TableHeader",()=>f,"TableRow",()=>h])},84381,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(86304),f=a.i(99570),g=a.i(7554),h=a.i(70121),i=a.i(50104),j=a.i(25152),k=a.i(77994),l=a.i(3688),m=a.i(30553),n="Switch",[o,p]=(0,i.createContextScope)(n),[q,r]=o(n),s=c.forwardRef((a,d)=>{let{__scopeSwitch:e,name:f,checked:i,defaultChecked:k,required:l,disabled:o,value:p="on",onCheckedChange:r,form:s,...t}=a,[u,x]=c.useState(null),y=(0,h.useComposedRefs)(d,a=>x(a)),z=c.useRef(!1),A=!u||s||!!u.closest("form"),[B,C]=(0,j.useControllableState)({prop:i,defaultProp:k??!1,onChange:r,caller:n});return(0,b.jsxs)(q,{scope:e,checked:B,disabled:o,children:[(0,b.jsx)(m.Primitive.button,{type:"button",role:"switch","aria-checked":B,"aria-required":l,"data-state":w(B),"data-disabled":o?"":void 0,disabled:o,value:p,...t,ref:y,onClick:(0,g.composeEventHandlers)(a.onClick,a=>{C(a=>!a),A&&(z.current=a.isPropagationStopped(),z.current||a.stopPropagation())})}),A&&(0,b.jsx)(v,{control:u,bubbles:!z.current,name:f,value:p,checked:B,required:l,disabled:o,form:s,style:{transform:"translateX(-100%)"}})]})});s.displayName=n;var t="SwitchThumb",u=c.forwardRef((a,c)=>{let{__scopeSwitch:d,...e}=a,f=r(t,d);return(0,b.jsx)(m.Primitive.span,{"data-state":w(f.checked),"data-disabled":f.disabled?"":void 0,...e,ref:c})});u.displayName=t;var v=c.forwardRef(({__scopeSwitch:a,control:d,checked:e,bubbles:f=!0,...g},i)=>{let j=c.useRef(null),m=(0,h.useComposedRefs)(j,i),n=(0,k.usePrevious)(e),o=(0,l.useSize)(d);return c.useEffect(()=>{let a=j.current;if(!a)return;let b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(n!==e&&b){let c=new Event("click",{bubbles:f});b.call(a,e),a.dispatchEvent(c)}},[n,e,f]),(0,b.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:e,...g,tabIndex:-1,ref:m,style:{...g.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function w(a){return a?"checked":"unchecked"}v.displayName="SwitchBubbleInput";var x=a.i(68114);let y=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(s,{className:(0,x.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...c,ref:d,children:(0,b.jsx)(u,{className:(0,x.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));y.displayName=s.displayName;var z=a.i(6015),A=a.i(78125),B=a.i(5050),C=(0,B.createServerReference)("40c902b3dbdc60cffb63d2516810fded4652ab4135",B.callServer,void 0,B.findSourceMapURL,"removeMemberAction"),D=(0,B.createServerReference)("405dd1f997612e490d8925326021e1036c46c9cab9",B.callServer,void 0,B.findSourceMapURL,"toggleMemberRoleAction");let E=new Intl.DateTimeFormat("en-CA",{dateStyle:"medium",timeStyle:"short"});function F(a){return a?{admin:a.portal_roles.includes("portal_org_admin")||a.portal_roles.includes("portal_admin"),rep:a.portal_roles.includes("portal_org_rep")}:{admin:!1,rep:!1}}function G(a){return a.reduce((a,b)=>(a[b.id]=F(b),a),{})}function H({members:a,currentProfileId:g}){let h=(0,d.useRouter)(),{toast:i}=(0,A.useToast)(),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useTransition)(),[n,o]=(0,c.useState)(()=>G(a));(0,c.useEffect)(()=>{o(G(a))},[a]);let p=(b,c,d)=>{k(`${b}-${c}`),m(async()=>{let e=new FormData;e.append("profile_id",b),e.append("role_name",c),e.append("enable",d.toString()),o(e=>{let f=e[b]??F(a.find(a=>a.id===b));return{...e,[b]:{...f,["portal_org_admin"===c?"admin":"rep"]:d}}});let f=await D(e);f.success?i({title:d?"Role granted":"Role removed",description:"portal_org_admin"===c?"Admin access updated.":"Representative access updated."}):(i({title:"Role update failed",description:f.error,variant:"destructive"}),o(e=>{let f=e[b]??F(a.find(a=>a.id===b));return{...e,[b]:{...f,["portal_org_admin"===c?"admin":"rep"]:!d}}})),k(null),h.refresh()})};return(0,b.jsxs)(z.Table,{children:[(0,b.jsx)(z.TableHeader,{children:(0,b.jsxs)(z.TableRow,{children:[(0,b.jsx)(z.TableHead,{children:"Name"}),(0,b.jsx)(z.TableHead,{children:"Affiliation"}),(0,b.jsx)(z.TableHead,{children:"Last seen"}),(0,b.jsx)(z.TableHead,{className:"text-right",children:"Access"})]})}),(0,b.jsx)(z.TableBody,{children:a.map(a=>{let c=a.id===g,d=a.portal_roles.includes("portal_org_admin")||a.portal_roles.includes("portal_admin"),o=a.portal_roles.includes("portal_org_rep"),q=n[a.id]??{admin:d,rep:o},r=`${a.id}-portal_org_admin`,s=`${a.id}-portal_org_rep`,t=`${a.id}-remove`,u=c&&q.admin;return(0,b.jsxs)(z.TableRow,{children:[(0,b.jsx)(z.TableCell,{children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-medium text-on-surface",children:a.display_name}),a.position_title?(0,b.jsx)("span",{className:"text-label-sm text-muted-foreground",children:a.position_title}):null]})}),(0,b.jsx)(z.TableCell,{children:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-space-2xs",children:[(0,b.jsx)(e.Badge,{variant:q.admin?"default":q.rep?"secondary":"outline",className:"capitalize",children:q.admin?"org admin":q.rep?"org rep":"member"}),(0,b.jsx)(e.Badge,{variant:"outline",className:"capitalize text-xs",children:a.affiliation_status})]})}),(0,b.jsx)(z.TableCell,{children:function(a){if(!a)return"—";try{return E.format(new Date(a))}catch{return a}}(a.last_seen_at)}),(0,b.jsx)(z.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex flex-col items-end gap-space-2xs text-left",children:[(0,b.jsx)(I,{id:`admin-${a.id}`,label:"Org admin",description:"Manage members, invites, and settings.",checked:q.admin,disabled:c||l&&j===r,onChange:b=>p(a.id,"portal_org_admin",b)}),(0,b.jsx)(I,{id:`rep-${a.id}`,label:"Org representative",description:"Invite members and coordinate with IHARC.",checked:q.rep,disabled:u||l&&j===s,onChange:b=>p(a.id,"portal_org_rep",b)}),(0,b.jsx)(f.Button,{type:"button",variant:"ghost",size:"sm",disabled:c||l&&j===t,onClick:()=>{var b;return b=a.id,void(k(`${b}-remove`),m(async()=>{let a=new FormData;a.append("profile_id",b);let c=await C(a);c.success?i({title:"Member removed",description:"Access revoked and audit logged."}):i({title:"Remove failed",description:c.error,variant:"destructive"}),k(null),h.refresh()}))},children:l&&j===t?"Removing…":"Remove"})]})})]},a.id)})})]})}function I({id:a,label:c,description:d,checked:e,disabled:f,onChange:g}){return(0,b.jsxs)("label",{htmlFor:a,className:"flex max-w-[320px] items-start gap-space-sm text-left",children:[(0,b.jsx)(y,{id:a,checked:e,disabled:f,onCheckedChange:g}),(0,b.jsxs)("div",{className:"space-y-space-3xs",children:[(0,b.jsx)("p",{className:"text-body-sm font-medium text-on-surface",children:c}),(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:d})]})]})}a.s(["OrgMembersTable",()=>H],84381)}];

//# sourceMappingURL=_f9932c18._.js.map