module.exports=[63985,a=>{"use strict";let b="[redacted]",c=["password","token","secret","authorization","cookie","session","otp","code","sin","ssn","birth","dob","email","phone","contact","address"];function d(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return b===Object.prototype||null===b}let e=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,f=/^[0-9]+$/,g=/^[a-z0-9_]+$/i,h=/^[a-zA-Z0-9._:-]+$/;function i(a){if(null==a)return null;let b="number"==typeof a?String(a):a.trim?.()??a;return"string"!=typeof b||0===b.length?null:e.test(b)||f.test(b)?b:b.slice(0,128)}function j(a){let b=i(a);return b&&e.test(b)?b:null}function k(a){if(!a)return null;let{schema:b,table:c,id:d}=a;if(!g.test(b)||!g.test(c))return null;let e=i(d);return e&&h.test(e)?`${b.toLowerCase()}.${c.toLowerCase()}:${e}`:null}async function l(a,{actorProfileId:e=null,action:f,entityType:g,entityRef:h,entityId:i,meta:l}){let m=l&&d(l)?function a(e,f){let g={};return Object.entries(e).forEach(([e,h])=>{let i;if(i=e.toLowerCase(),c.some(a=>i.includes(a))){g[e]=b;return}let j=function c(e,f){if(void 0!==e){if(null===e)return null;if("string"==typeof e)return e.length>1024?`${e.slice(0,1024)}...`:e;if("number"==typeof e||"boolean"==typeof e)return e;if("bigint"==typeof e)return e.toString();if(e instanceof Date)return e.toISOString();if(e instanceof URL)return e.toString();if(e instanceof Error)return{name:e.name,message:e.message};if(Array.isArray(e))return e.map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Set)return Array.from(e).map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Map){let a={};return e.forEach((b,d)=>{let e=c(b,f);void 0!==e&&(a[String(d)]=e)}),a}return"object"==typeof e&&d(e)?f.has(e)?b:(f.add(e),a(e,f)):String(e)}}(h,f);void 0!==j&&(g[e]=j)}),g}(l,new WeakSet):{},n="string"==typeof h?h:k(h),o=j(i);!o&&n&&(o=j(n.split(":").pop()??null));let p=!n||"entity_ref"in m?m:{...m,entity_ref:n},q=j(e),{error:r}=await a.rpc("portal_log_audit_event",{p_action:f,p_entity_type:g,p_entity_id:o,p_meta:p,p_actor_profile_id:q});if(r)throw r}a.s(["buildEntityRef",()=>k,"logAuditEvent",()=>l],63985)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},83667,a=>{"use strict";function b(a,c=0){if("number"==typeof a)return Number.isFinite(a)?a:c;if("string"==typeof a){let b=Number.parseFloat(a);return Number.isFinite(b)?b:c}return"bigint"==typeof a?Number(a):c}function c(a,b=!1){if("boolean"==typeof a)return a;if("number"==typeof a)return 0!==a;if("string"==typeof a){let b=a.toLowerCase();return"true"===b||"1"===b}return b}function d(a){return{id:String(a.id),name:String(a.name??""),description:"string"==typeof a.description?a.description:null,category:"string"==typeof a.category?a.category:null,unitType:"string"==typeof a.unit_type?a.unit_type:null,minimumThreshold:null===a.minimum_threshold||void 0===a.minimum_threshold?null:b(a.minimum_threshold),costPerUnit:null===a.cost_per_unit||void 0===a.cost_per_unit?null:b(a.cost_per_unit),supplier:"string"==typeof a.supplier?a.supplier:null,active:c(a.active,!0),onHandQuantity:b(a.onhand_qty),committedQuantity:b(a.committed_qty),availableQuantity:b(a.available_qty??a.onhand_qty),lastReceiptAt:"string"==typeof a.last_receipt_at?a.last_receipt_at:null}}function e(a){let c={id:String(a.item_id??a.id??crypto.randomUUID()),name:String(a.item_name??a.name??""),category:"string"==typeof a.category?a.category:null,unitType:"string"==typeof a.unit_type?a.unit_type:null,onHandQuantity:b(a.onhand_qty??a.qty_onhand),minimumThreshold:null===a.minimum_threshold||void 0===a.minimum_threshold?null:b(a.minimum_threshold)};return Array.isArray(a.locations)&&(c.locations=a.locations.map(a=>({id:String(a.id??a.location_id??crypto.randomUUID()),name:String(a.name??a.location_name??""),code:"string"==typeof a.code?a.code:null,onHandQuantity:b(a.onhand_qty??a.qty_onhand)}))),c}function f(a){return{id:String(a.id??a.batch_id??crypto.randomUUID()),itemId:String(a.item_id??a.id??""),itemName:String(a.item_name??a.name??""),lotNumber:"string"==typeof a.lot_number?a.lot_number:null,expiryDate:"string"==typeof a.expiry_date?a.expiry_date:null,daysUntilExpiry:null===a.days_until_expiry||void 0===a.days_until_expiry?null:b(a.days_until_expiry),locationId:"string"==typeof a.location_id?a.location_id:null,locationName:"string"==typeof a.location_name?a.location_name:null}}function g(a){let b=a.address,d=null;return"string"==typeof b?d=b:b&&"object"==typeof b&&(d=("string"==typeof b.formatted?String(b.formatted):"string"==typeof b.label?String(b.label):null)??JSON.stringify(b)),{id:String(a.id),name:String(a.name??""),code:"string"==typeof a.code?a.code:null,type:"string"==typeof a.type?a.type:null,address:d,active:c(a.active,!0),createdAt:"string"==typeof a.created_at?a.created_at:null,updatedAt:"string"==typeof a.updated_at?a.updated_at:null}}function h(a){return{id:Number.parseInt(String(a.id),10),name:String(a.name??""),description:"string"==typeof a.description?a.description:null,website:"string"==typeof a.website?a.website:null,isActive:c(a.is_active,!0),createdAt:"string"==typeof a.created_at?a.created_at:null,updatedAt:"string"==typeof a.updated_at?a.updated_at:null}}function i(a){return{id:String(a.id),itemId:String(a.item_id??""),itemName:String(a.item_name??a.name??""),locationId:"string"==typeof a.location_id?a.location_id:null,locationName:"string"==typeof a.location_name?a.location_name:null,qty:b(a.qty??a.quantity??0),refType:"string"==typeof a.ref_type?a.ref_type:null,providerOrgId:null===a.provider_org_id||void 0===a.provider_org_id?null:Number.parseInt(String(a.provider_org_id),10),providerOrgName:"string"==typeof a.provider_org_name?a.provider_org_name:null,notes:"string"==typeof a.notes?a.notes:null,unitCost:null===a.unit_cost||void 0===a.unit_cost?null:b(a.unit_cost),createdAt:String(a.created_at??new Date().toISOString()),createdBy:"string"==typeof a.created_by?a.created_by:null,batchId:"string"==typeof a.batch_id?a.batch_id:null,lotNumber:"string"==typeof a.lot_number?a.lot_number:null,expiryDate:"string"==typeof a.expiry_date?a.expiry_date:null}}async function j(a,b,c){let{data:d,error:e}=await a.schema("inventory").rpc(b,c??{});if(e)throw e;return d?Array.isArray(d)?d:[d]:[]}async function k(a){let{data:b,error:c}=await a.schema("inventory").from("v_items_with_balances").select("*").order("name");if(c)throw c;return(b??[]).map(d)}async function l(a){let{data:b,error:c}=await a.schema("inventory").from("v_low_stock").select("*").order("onhand_qty",{ascending:!0});if(c)throw c;return(b??[]).map(e)}async function m(a,b=30){return(await j(a,"get_expiring_items",{days_ahead:b})).map(f)}async function n(a){let{data:b,error:c}=await a.schema("inventory").from("locations").select("*").order("name");if(c)throw c;return(b??[]).map(g)}async function o(a){let{data:b,error:c}=await a.schema("core").from("organizations").select("*").order("is_active",{ascending:!1}).order("name");if(c)throw c;return(b??[]).map(h)}async function p(a,{startDate:b,endDate:c,organizationId:d,sourceType:e,locationId:f,itemId:g,search:h,limit:j}={}){let k=Math.min(Math.max(Number(j??100),1),500),l=a.schema("inventory").from("v_transactions_with_org").select("*").eq("reason_code","receipt").order("created_at",{ascending:!1}).limit(k);if(b&&(l=l.gte("created_at",b)),c&&(l=l.lte("created_at",c)),d){let a=Number.parseInt(d,10);Number.isNaN(a)||(l=l.eq("provider_org_id",a))}if(e&&(l=l.eq("ref_type",e)),f&&(l=l.eq("location_id",f)),g&&(l=l.eq("item_id",g)),h){let a=h.trim();if(a.length>0){let b=`%${a}%`;l=l.or(`item_name.ilike.${b},provider_org_name.ilike.${b},notes.ilike.${b},location_name.ilike.${b}`)}}let{data:m,error:n}=await l;if(n)throw n;return(m??[]).map(i)}async function q(a,b){if(!b)return null;let{data:c,error:d}=await a.schema("inventory").from("v_transactions_with_org").select("*").eq("id",b).maybeSingle();if(d)throw d;return c?i(c):null}async function r(a){let[b,c,d,e]=await Promise.all([k(a),l(a),m(a,30),p(a,{limit:10})]);return{summary:{totalItems:b.length,activeItems:b.filter(a=>a.active).length,lowStockCount:c.length,expiringCount:d.filter(a=>(a.daysUntilExpiry??1/0)<=7).length,totalOnHand:b.reduce((a,b)=>a+b.onHandQuantity,0)},lowStockItems:c,expiringItems:d,recentReceipts:e.slice(0,10)}}async function s(a){let[b,c,d,e,f]=await Promise.all([k(a),r(a),n(a),o(a),p(a,{limit:50})]),g=Array.from(new Set(b.map(a=>a.category).filter(a=>"string"==typeof a&&a.length>0))).sort((a,b)=>a.localeCompare(b));return{items:b,dashboard:c,locations:d,organizations:e,receipts:f,categories:g}}a.s(["fetchInventoryBootstrap",()=>s,"fetchInventoryItems",()=>k,"fetchInventoryReceiptById",()=>q])},56293,a=>{"use strict";a.i(70396);var b=a.i(73727),c=a.i(65108);class d extends Error{constructor(a="You do not have permission to manage inventory."){super(a),this.name="InventoryAccessError"}}async function e(a,f=!1){let{data:{user:g},error:h}=await a.auth.getUser();if(h||!g)throw f&&(0,b.redirect)("/login?next=/admin/inventory"),new d("Sign in to continue.");let i=await (0,c.loadPortalAccess)(a);if(!i)throw f&&(0,b.redirect)("/login?next=/admin/inventory"),new d("Sign in to continue.");if(!i.canAccessInventoryWorkspace)throw f&&(0,b.redirect)("/admin"),new d("IHARC inventory access is restricted to staff accounts.");return{profile:i.profile,roles:i.iharcRoles}}function f(a){if(!a.includes("iharc_admin"))throw new d("Only IHARC admins can change inventory locations.")}a.s(["InventoryAccessError",()=>d,"ensureInventoryActor",()=>e,"requireInventoryAdmin",()=>f])}];

//# sourceMappingURL=_73a1ae32._.js.map