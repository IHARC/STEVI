module.exports=[64153,a=>{"use strict";var b=a.i(7997),c=a.i(37936),d=a.i(95936);a.i(70396);var e=a.i(73727),f=a.i(9919),g=a.i(42145),h=a.i(65108),i=a.i(46592),j=a.i(77175),k=a.i(35330),l=a.i(38904),m=a.i(55583),n=a.i(43562),o=a.i(70444),p=a.i(19637),q=a.i(58774),r=a.i(45310),s=a.i(41923);let t="/admin/organizations",u=new Intl.DateTimeFormat("en-CA",{dateStyle:"medium",timeStyle:"short"}),v=async function(a){let b=await (0,j.updateOrganizationAction)(a);if(!b.success)throw Error(b.error)};(0,c.registerServerReference)(v,"404cb3e641abfb3aa12ecb321b1d4a8a89404267ab",null);let w=async function(a){let b=await (0,j.deleteOrganizationAction)(a);if(!b.success)throw Error(b.error);(0,e.redirect)("/admin/organizations")};(0,c.registerServerReference)(w,"408138480e876f019773478c0dedad434e098280a7",null);let x=async function(a){let b=await (0,j.attachOrgMemberAction)(a);if(!b.success)throw Error(b.error)};(0,c.registerServerReference)(x,"405b63c1a4f60f89c84784420700e3e9d5439c1497",null);let y=async function(a){let b=await (0,j.adminToggleOrgMemberRoleAction)(a);if(!b.success)throw Error(b.error)};(0,c.registerServerReference)(y,"404a92a85f795c40de8e7974d99b633e134e135600",null);let z=async function(a){let b=await (0,j.adminRemoveOrgMemberAction)(a);if(!b.success)throw Error(b.error)};async function A({params:a}){var c;let j=await a,A=Number.parseInt(j.id,10);Number.isNaN(A)&&(0,e.redirect)(t);let B=await (0,f.createSupabaseRSCClient)(),C=await (0,h.loadPortalAccess)(B);C||(0,e.redirect)(`/login?next=${t}/${j.id}`),C.canAccessAdminWorkspace&&C.portalRoles.includes("portal_admin")||(0,e.redirect)((0,i.resolveDefaultWorkspacePath)(C)),await (0,g.ensurePortalProfile)(B,C.userId);let D=B.schema("core"),E=B.schema("portal"),{data:F,error:G}=await D.from("organizations").select("*").eq("id",A).maybeSingle();if(G)throw G;F||(0,e.redirect)(t);let{data:H,error:I}=await E.from("profiles").select("id, user_id, display_name, position_title, organization_id, last_seen_at, affiliation_status").eq("organization_id",A).order("display_name");if(I)throw I;let J=H??[],K=J.map(a=>a.user_id).filter(a=>!!a),L=new Map;if(K.length){let{data:a,error:b}=await B.schema("core").from("user_roles").select("user_id, roles:roles!inner(name)").in("user_id",K);if(b)throw b;(a??[]).forEach(a=>{let b=a.roles?.name;if(!b)return;let c=L.get(a.user_id)??[];c.push(b),L.set(a.user_id,c)})}let M=J.map(a=>({...a,portal_roles:(L.get(a.user_id??"")??[]).filter(a=>a.startsWith("portal_"))})),N=(0,s.extractOrgFeatureFlags)(F.services_tags),O=F.status??(!1===F.is_active?"inactive":"active");return(0,b.jsxs)("div",{className:"space-y-space-lg",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-space-sm sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("p",{className:"text-label-sm font-medium uppercase text-muted-foreground",children:"Admin · Organizations"}),(0,b.jsxs)("div",{className:"flex items-center gap-space-sm",children:[(0,b.jsx)("h1",{className:"text-headline-lg text-on-surface",children:F.name}),(0,b.jsx)(p.Badge,{variant:(c=F.status,!1===F.is_active||"inactive"===c?"secondary":"pending"===c||"under_review"===c?"outline":"default"),children:O?.replace(/_/g," ")})]}),(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:"Manage organization metadata, feature availability, and member/admin roles. All writes are audited and enforced by Supabase RLS."})]}),(0,b.jsx)(l.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(d.default,{href:"/admin/organizations",children:"Back to list"})})]}),(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{children:[(0,b.jsx)(k.CardTitle,{children:"Organization profile"}),(0,b.jsx)(k.CardDescription,{children:"Update core details, contact info, and feature availability."})]}),(0,b.jsx)(k.CardContent,{children:(0,b.jsxs)("form",{action:v,className:"grid gap-space-md lg:grid-cols-2",children:[(0,b.jsx)("input",{type:"hidden",name:"organization_id",value:F.id}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"name",children:"Name"}),(0,b.jsx)(m.Input,{id:"name",name:"name",required:!0,defaultValue:F.name})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"status",children:"Status"}),(0,b.jsxs)(o.Select,{name:"status",defaultValue:F.status??"active",children:[(0,b.jsx)(o.SelectTrigger,{id:"status",children:(0,b.jsx)(o.SelectValue,{placeholder:"Select status"})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:"active",children:"Active"}),(0,b.jsx)(o.SelectItem,{value:"pending",children:"Pending"}),(0,b.jsx)(o.SelectItem,{value:"under_review",children:"Under review"}),(0,b.jsx)(o.SelectItem,{value:"inactive",children:"Inactive"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"organization_type",children:"Organization type"}),(0,b.jsxs)(o.Select,{name:"organization_type",defaultValue:F.organization_type??void 0,children:[(0,b.jsx)(o.SelectTrigger,{id:"organization_type",children:(0,b.jsx)(o.SelectValue,{placeholder:"Select type"})}),(0,b.jsx)(o.SelectContent,{children:["addiction","crisis_support","food_services","housing","mental_health","multi_service","healthcare","government","non_profit","faith_based","community_center","legal_services","other"].map(a=>(0,b.jsx)(o.SelectItem,{value:a,children:a.replace(/_/g," ")},a))})]})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"partnership_type",children:"Partnership type"}),(0,b.jsxs)(o.Select,{name:"partnership_type",defaultValue:F.partnership_type??void 0,children:[(0,b.jsx)(o.SelectTrigger,{id:"partnership_type",children:(0,b.jsx)(o.SelectValue,{placeholder:"Select partnership"})}),(0,b.jsx)(o.SelectContent,{children:["referral_partner","service_provider","funding_partner","collaborative_partner","resource_partner","other"].map(a=>(0,b.jsx)(o.SelectItem,{value:a,children:a.replace(/_/g," ")},a))})]})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"website",children:"Website"}),(0,b.jsx)(m.Input,{id:"website",name:"website",type:"url",defaultValue:F.website??"",placeholder:"https://example.org"})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(m.Input,{id:"email",name:"email",type:"email",defaultValue:F.email??"",placeholder:"team@example.org"})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"phone",children:"Phone"}),(0,b.jsx)(m.Input,{id:"phone",name:"phone",defaultValue:F.phone??"",placeholder:"+1 (905) 555-1234"})]}),(0,b.jsx)("div",{className:"space-y-space-xs",children:(0,b.jsxs)(n.Label,{className:"flex items-center gap-space-xs text-body-sm",children:[(0,b.jsx)("input",{type:"checkbox",name:"is_active",defaultChecked:F.is_active??!0,className:"h-4 w-4 rounded border border-input"}),(0,b.jsx)("span",{children:"Active"})]})}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(q.Textarea,{id:"description",name:"description",defaultValue:F.description??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"services_provided",children:"Services provided"}),(0,b.jsx)(q.Textarea,{id:"services_provided",name:"services_provided",defaultValue:F.services_provided??"",placeholder:"Key programs, supports, or resources offered"})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"address",children:"Address"}),(0,b.jsx)(m.Input,{id:"address",name:"address",defaultValue:F.address??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"city",children:"City"}),(0,b.jsx)(m.Input,{id:"city",name:"city",defaultValue:F.city??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"province",children:"Province"}),(0,b.jsx)(m.Input,{id:"province",name:"province",defaultValue:F.province??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"postal_code",children:"Postal code"}),(0,b.jsx)(m.Input,{id:"postal_code",name:"postal_code",defaultValue:F.postal_code??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"contact_person",children:"Primary contact"}),(0,b.jsx)(m.Input,{id:"contact_person",name:"contact_person",defaultValue:F.contact_person??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"contact_title",children:"Contact title"}),(0,b.jsx)(m.Input,{id:"contact_title",name:"contact_title",defaultValue:F.contact_title??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"contact_phone",children:"Contact phone"}),(0,b.jsx)(m.Input,{id:"contact_phone",name:"contact_phone",defaultValue:F.contact_phone??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"contact_email",children:"Contact email"}),(0,b.jsx)(m.Input,{id:"contact_email",name:"contact_email",type:"email",defaultValue:F.contact_email??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"operating_hours",children:"Operating hours"}),(0,b.jsx)(q.Textarea,{id:"operating_hours",name:"operating_hours",defaultValue:F.operating_hours??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"availability_notes",children:"Availability notes"}),(0,b.jsx)(q.Textarea,{id:"availability_notes",name:"availability_notes",defaultValue:F.availability_notes??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"referral_process",children:"Referral process"}),(0,b.jsx)(q.Textarea,{id:"referral_process",name:"referral_process",defaultValue:F.referral_process??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs",children:[(0,b.jsx)(n.Label,{htmlFor:"special_requirements",children:"Special requirements"}),(0,b.jsx)(q.Textarea,{id:"special_requirements",name:"special_requirements",defaultValue:F.special_requirements??""})]}),(0,b.jsxs)("div",{className:"space-y-space-xs lg:col-span-2",children:[(0,b.jsx)(n.Label,{htmlFor:"notes",children:"Notes"}),(0,b.jsx)(q.Textarea,{id:"notes",name:"notes",defaultValue:F.notes??""})]}),(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-space-xs",children:[(0,b.jsx)(n.Label,{className:"text-body-sm",children:"Feature availability"}),(0,b.jsx)("div",{className:"mt-space-sm grid gap-space-xs md:grid-cols-3",children:s.ORG_FEATURE_OPTIONS.map(a=>(0,b.jsxs)("label",{className:"flex items-center gap-space-xs rounded-md border border-outline/20 px-space-sm py-space-xs text-body-sm",children:[(0,b.jsx)("input",{type:"checkbox",name:"features",value:a.value,defaultChecked:N.includes(a.value),className:"h-4 w-4 rounded border border-input"}),(0,b.jsx)("span",{children:a.label})]},a.value))})]}),(0,b.jsx)("div",{className:"lg:col-span-2 flex justify-end",children:(0,b.jsx)(l.Button,{type:"submit",children:"Save changes"})})]})})]}),(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{children:[(0,b.jsx)(k.CardTitle,{children:"Members & admins"}),(0,b.jsx)(k.CardDescription,{children:"Link profiles to this organization and control portal roles."})]}),(0,b.jsxs)(k.CardContent,{className:"space-y-space-lg",children:[(0,b.jsxs)("form",{action:x,className:"grid gap-space-md md:grid-cols-4",children:[(0,b.jsx)("input",{type:"hidden",name:"organization_id",value:F.id}),(0,b.jsxs)("div",{className:"space-y-space-xs md:col-span-2",children:[(0,b.jsx)(n.Label,{htmlFor:"profile_id",children:"Profile ID"}),(0,b.jsx)(m.Input,{id:"profile_id",name:"profile_id",required:!0,placeholder:"Profile UUID"}),(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:"Find the profile in verification or profiles list first."})]}),(0,b.jsx)("div",{className:"space-y-space-xs",children:(0,b.jsxs)(n.Label,{className:"flex items-center gap-space-xs text-body-sm",children:[(0,b.jsx)("input",{type:"checkbox",name:"make_admin",className:"h-4 w-4 rounded border border-input"}),(0,b.jsx)("span",{children:"Make org admin"})]})}),(0,b.jsx)("div",{className:"space-y-space-xs",children:(0,b.jsxs)(n.Label,{className:"flex items-center gap-space-xs text-body-sm",children:[(0,b.jsx)("input",{type:"checkbox",name:"make_rep",defaultChecked:!0,className:"h-4 w-4 rounded border border-input"}),(0,b.jsx)("span",{children:"Give org rep access"})]})}),(0,b.jsx)("div",{className:"md:col-span-4 flex justify-end",children:(0,b.jsx)(l.Button,{type:"submit",variant:"outline",children:"Add member"})})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(r.Table,{children:[(0,b.jsx)(r.TableHeader,{children:(0,b.jsxs)(r.TableRow,{children:[(0,b.jsx)(r.TableHead,{children:"Name"}),(0,b.jsx)(r.TableHead,{children:"Roles"}),(0,b.jsx)(r.TableHead,{children:"Status"}),(0,b.jsx)(r.TableHead,{children:"Last seen"}),(0,b.jsx)(r.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(r.TableBody,{children:0===M.length?(0,b.jsx)(r.TableRow,{children:(0,b.jsx)(r.TableCell,{colSpan:5,className:"text-center text-muted-foreground",children:"No members yet."})}):M.map(a=>{let c=a.portal_roles.includes("portal_org_admin")||a.portal_roles.includes("portal_admin"),d=a.portal_roles.includes("portal_org_rep"),e=a.id===C.profile.id;return(0,b.jsxs)(r.TableRow,{children:[(0,b.jsx)(r.TableCell,{children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-medium text-on-surface",children:a.display_name}),a.position_title?(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:a.position_title}):null]})}),(0,b.jsx)(r.TableCell,{children:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-space-2xs",children:[c?(0,b.jsx)(p.Badge,{children:"Org admin"}):null,d?(0,b.jsx)(p.Badge,{variant:c?"outline":"secondary",children:"Org rep"}):null,c||d?null:(0,b.jsx)(p.Badge,{variant:"outline",children:"portal_user"})]})}),(0,b.jsx)(r.TableCell,{children:(0,b.jsx)(p.Badge,{variant:"outline",className:"capitalize",children:a.affiliation_status})}),(0,b.jsx)(r.TableCell,{children:function(a){if(!a)return"—";try{return u.format(new Date(a))}catch{return a}}(a.last_seen_at)}),(0,b.jsxs)(r.TableCell,{className:"flex justify-end gap-space-xs",children:[(0,b.jsxs)("form",{action:y,children:[(0,b.jsx)("input",{type:"hidden",name:"organization_id",value:F.id}),(0,b.jsx)("input",{type:"hidden",name:"profile_id",value:a.id}),(0,b.jsx)("input",{type:"hidden",name:"role_name",value:"portal_org_admin"}),(0,b.jsx)("input",{type:"hidden",name:"enable",value:(!c).toString()}),(0,b.jsx)(l.Button,{type:"submit",size:"sm",variant:c?"outline":"default",disabled:e&&c,children:c?"Remove admin":"Make admin"})]}),(0,b.jsxs)("form",{action:y,children:[(0,b.jsx)("input",{type:"hidden",name:"organization_id",value:F.id}),(0,b.jsx)("input",{type:"hidden",name:"profile_id",value:a.id}),(0,b.jsx)("input",{type:"hidden",name:"role_name",value:"portal_org_rep"}),(0,b.jsx)("input",{type:"hidden",name:"enable",value:(!d).toString()}),(0,b.jsx)(l.Button,{type:"submit",size:"sm",variant:d?"outline":"secondary",disabled:e&&c,children:d?"Remove rep":"Make rep"})]}),(0,b.jsxs)("form",{action:z,children:[(0,b.jsx)("input",{type:"hidden",name:"organization_id",value:F.id}),(0,b.jsx)("input",{type:"hidden",name:"profile_id",value:a.id}),(0,b.jsx)(l.Button,{type:"submit",size:"sm",variant:"ghost",disabled:e,children:"Remove"})]})]})]},a.id)})})]})})]})]}),(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{children:[(0,b.jsx)(k.CardTitle,{children:"Danger zone"}),(0,b.jsx)(k.CardDescription,{children:"Delete the organization after detaching all linked members and invites."})]}),(0,b.jsx)(k.CardContent,{children:(0,b.jsxs)("form",{action:w,className:"grid gap-space-md md:grid-cols-3 md:items-end",children:[(0,b.jsx)("input",{type:"hidden",name:"organization_id",value:F.id}),(0,b.jsxs)("div",{className:"space-y-space-xs md:col-span-2",children:[(0,b.jsx)(n.Label,{htmlFor:"confirm_name",children:"Type the organization name to confirm"}),(0,b.jsx)(m.Input,{id:"confirm_name",name:"confirm_name",placeholder:F.name})]}),(0,b.jsx)("div",{className:"md:col-span-1 flex justify-end",children:(0,b.jsx)(l.Button,{type:"submit",variant:"destructive",children:"Delete organization"})})]})})]})]})}(0,c.registerServerReference)(z,"40edf247a8e20a974b7b449a2ab4236b527d1706a4",null),a.s(["$$RSC_SERVER_ACTION_0",0,v,"$$RSC_SERVER_ACTION_1",0,w,"$$RSC_SERVER_ACTION_2",0,x,"$$RSC_SERVER_ACTION_3",0,y,"$$RSC_SERVER_ACTION_4",0,z,"default",()=>A,"dynamic",0,"force-dynamic"])}];

//# sourceMappingURL=src_app_%28portal%29_admin_organizations_%5Bid%5D_page_tsx_c68adb99._.js.map