module.exports=[6687,a=>{"use strict";function b(a){if("string"!=typeof a)return;let b=a.trim();if(!b)return;let c=b.startsWith("+"),d=b.replace(/\D+/g,"");if(d){if(c)return`+${d}`;if(10===d.length)return`+1${d}`;if(d.length>10)return`+${d}`}}function c(a){let c=b(a);if(!c)return"";let d=c.slice(-4),e=c.slice(0,Math.max(2,c.length-4)).replace(/\d/g,"*");return`${e}${d}`}a.s(["maskPhoneNumber",()=>c,"normalizePhoneNumber",()=>b])},39251,a=>{"use strict";var b=a.i(10508);let c=["agency_partner","government_partner"];async function d(a){let[c,d,e]=await Promise.all([(0,b.getAffiliationTypes)(a),(0,b.getAffiliationStatuses)(a),(0,b.getGovernmentRoleTypes)(a)]);return{affiliationTypes:c,affiliationStatuses:d,governmentRoleTypes:e}}async function e(a,b){if(0===b.length)return new Set;let{data:c,error:d}=await a.schema("core").from("user_roles").select("user_id, roles:roles!inner(name)").in("roles.name",b).not("user_id","is",null);if(d)throw d;let e=new Set;return(c??[]).forEach(a=>{a.user_id&&e.add(a.user_id)}),e}async function f(a,c,d){let f=[];if("staff"===c){let c=await (0,b.getIharcRoles)(a);f.push(...c)}return(d&&f.push(d),0===f.length)?null:e(a,f)}async function g(a,b){let c=new Map;if(0===b.length)return c;let{data:d,error:e}=await a.schema("core").from("user_roles").select("user_id, roles:roles!inner(name)").in("user_id",b);if(e)throw e;return(d??[]).forEach(a=>{let b=a.user_id,d=a.roles?.name;if(!d)return;let e=c.get(b)??{portal:[],iharc:[]};d.startsWith("portal_")?e.portal.push(d):d.startsWith("iharc_")&&e.iharc.push(d),c.set(b,e)}),c}async function h(a,b){let c=new Map;if(0===b.length)return c;let{data:d,error:e}=await a.schema("core").from("organizations").select("id, name, status").in("id",b);if(e)throw e;return(d??[]).forEach(a=>{c.set(a.id,{id:a.id,name:a.name,status:a.status})}),c}async function i(a,b){let c=new Map;return 0===b.length||await Promise.all(b.map(async b=>{try{let{data:d,error:e}=await a.rpc("portal_get_user_email",{p_profile_id:b.id});!e&&d&&c.set(b.id,d)}catch(a){}})),c}async function j(a,b,d={}){let e=function(a,b=1){if("string"==typeof a){let b=Number.parseInt(a,10);if(Number.isFinite(b)&&b>0)return b}return"number"==typeof a&&Number.isFinite(a)&&a>0?a:b}(d.page),k=function(a,b=25){if("string"==typeof a){let b=Number.parseInt(a,10);if(Number.isFinite(b)&&b>0)return Math.min(b,100)}return"number"==typeof a&&Number.isFinite(a)&&a>0?Math.min(a,100):b}(d.pageSize),l=(e-1)*k,m=function(a){if(!a)return null;let b=a.trim();return b?b.replace(/[%_]/g,a=>`\\${a}`):null}(d.search??null),n=d.role??null,o=await f(a,b,n);if(o&&0===o.size)return{items:[],page:e,pageSize:k,total:0,hasMore:!1};let p=a.schema("portal").from("profiles").select("id, user_id, display_name, position_title, affiliation_type, affiliation_status, organization_id, last_seen_at, updated_at",{count:"exact"});"clients"===b?p=p.eq("affiliation_type","community_member"):"partners"===b&&(p=p.in("affiliation_type",c)),d.status&&(p=p.eq("affiliation_status",d.status)),d.organizationId&&(p=p.eq("organization_id",d.organizationId)),o&&(p=p.in("user_id",Array.from(o))),m&&(p=p.ilike("display_name",`%${m}%`));let q="name"===d.sort?"display_name":"updated_at";p=p.order(q,{ascending:"name"===d.sort}).range(l,l+k-1);let{data:r,error:s,count:t}=await p;if(s)throw s;let u=r??[];if(0===u.length)return{items:[],page:e,pageSize:k,total:t??0,hasMore:!1};let v=Array.from(new Set(u.map(a=>a.organization_id).filter(a=>"number"==typeof a))),w=Array.from(new Set(u.map(a=>a.user_id).filter(a=>"string"==typeof a&&a.length>0))),[x,y,z]=await Promise.all([h(a,v),g(a,w),i(a,u)]),A=u.map(a=>{let b=y.get(a.user_id??"")??{portal:[],iharc:[]},c=a.organization_id?x.get(a.organization_id):null;return{profileId:a.id,displayName:a.display_name,positionTitle:a.position_title,affiliationType:a.affiliation_type,affiliationStatus:a.affiliation_status,organizationId:a.organization_id,organizationName:c?.name??null,userId:a.user_id,email:z.get(a.id)??null,lastSeenAt:a.last_seen_at,roles:b}}),B=t??A.length,C=B>l+A.length;return{items:A,total:B,page:e,pageSize:k,hasMore:C}}async function k(a){let d=a.schema("portal"),f=(0,b.getIharcRoles)(a),[g,h,i,j,k,l]=await Promise.all([d.from("profiles").select("id",{count:"exact",head:!0}),d.from("profiles").select("id",{count:"exact",head:!0}).eq("affiliation_type","community_member"),d.from("profiles").select("id",{count:"exact",head:!0}).in("affiliation_type",c),d.from("profiles").select("id",{count:"exact",head:!0}).eq("affiliation_status","pending"),d.from("profiles").select("id",{count:"exact",head:!0}).eq("affiliation_status","revoked"),f.then(b=>e(a,b))]);return{total:g.count??0,clients:h.count??0,partners:i.count??0,pending:j.count??0,revoked:k.count??0,staff:l.size}}async function l(a,b){let c=a.schema("portal"),{data:d,error:e}=await c.from("profiles").select("*").eq("id",b).maybeSingle();if(e)throw e;if(!d)return null;let f=d.organization_id?await (async()=>{let{data:b,error:c}=await a.schema("core").from("organizations").select("id, name, status").eq("id",d.organization_id).maybeSingle();if(c)throw c;return b??null})():null,h=d.user_id,j=h?await g(a,[h]):new Map,k=h?j.get(h)??{portal:[],iharc:[]}:{portal:[],iharc:[]},l=(await i(a,[d])).get(d.id)??null,{data:m,error:n}=await c.from("audit_log").select("id, action, created_at, actor_profile_id, entity_id, entity_type, meta").eq("entity_id",b).order("created_at",{ascending:!1}).limit(30);if(n)throw n;let o=(m??[]).map(a=>({id:a.id,action:a.action,createdAt:a.created_at,actorProfileId:a.actor_profile_id,meta:a.meta}))??[];return{profile:d,organization:f?{id:f.id,name:f.name,status:f.status}:null,roles:k,email:l,auditEvents:o}}function m(a){if("string"!=typeof a)return null;let b=a.trim();if(!b)return null;let c=Number.parseInt(b,10);return Number.isNaN(c)?null:c}function n(a,b){return a&&b.affiliationTypes.includes(a)?a:null}function o(a,b){return a&&b.affiliationStatuses.includes(a)?a:null}function p(a,b){return a&&b.governmentRoleTypes.includes(a)?a:null}function q(a){return"clients"===a||"partners"===a||"staff"===a?a:"all"}function r(a){if(!a)return 1;let b=Number.parseInt(Array.isArray(a)?a[0]:a,10);return Number.isFinite(b)&&b>0?b:1}a.s(["coerceSegment",()=>q,"fetchAdminUserDetail",()=>l,"fetchAdminUserSummary",()=>k,"fetchAdminUsers",()=>j,"loadProfileEnums",()=>d,"normalizeOrganizationId",()=>m,"parseAffiliationStatus",()=>o,"parseAffiliationType",()=>n,"parseGovernmentRole",()=>p,"parsePageParam",()=>r])},28725,a=>{"use strict";function b(a){if("string"!=typeof a)return;let b=a.trim();return b.length>0?b.toLowerCase():void 0}a.s(["normalizeEmail",()=>b])},82666,a=>{"use strict";var b=a.i(86731),c=a.i(38971);a.s([],70138),a.i(70138),a.s(["00b7ee4fee263fec1fe8acb860989f6ddb47485e3a",()=>b.$$RSC_SERVER_ACTION_0,"606a91c4a11386e7d7a83090ffd66bdb5c0735e1f7",()=>c.$$RSC_SERVER_ACTION_1,"60f02e46daa9f34680b68312895254364a20d08c5e",()=>c.$$RSC_SERVER_ACTION_2,"60f0a63e8deab51e95f440f1315d1f1db76b399e37",()=>c.$$RSC_SERVER_ACTION_3,"70ba9926c40a190231a1e41a6b602078bf89aff60e",()=>c.$$RSC_SERVER_ACTION_0],82666)}];

//# sourceMappingURL=_1618ad5d._.js.map