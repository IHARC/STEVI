module.exports=[10780,a=>{"use strict";var b=a.i(86731),c=a.i(37936),d=a.i(18558),e=a.i(16349),f=a.i(63985),g=a.i(56293);function h(a){if(!a||0===a.trim().length)return null;let b=a.trim();try{let a=JSON.parse(b);if(a&&"object"==typeof a)return a}catch{}return{formatted:b}}async function i(a,b){let c,d=(c=new Date().toISOString(),{id:crypto.randomUUID(),name:b.name,description:b.description??null,category:b.category,unit_type:b.unitType,minimum_threshold:b.minimumThreshold??null,cost_per_unit:b.costPerUnit??null,supplier:b.supplier??null,active:b.active,created_at:c,updated_at:c}),{data:e,error:f}=await a.schema("core").from("items").insert(d).select("*").single();if(f)throw f;return b.initialStockQuantity&&b.initialStockQuantity>0&&b.initialStockLocationId&&await a.schema("inventory").rpc("receive_stock",{p_item_id:d.id,p_location_id:b.initialStockLocationId,p_qty:b.initialStockQuantity,p_unit_cost:b.costPerUnit??null,p_notes:b.initialStockNotes??"Initial stock recorded in STEVI inventory workspace",p_batch_id:null,p_lot_number:null,p_expiry_date:null}),{id:String(e.id),name:e.name??d.name,description:e.description??d.description??null,category:e.category??d.category??null,unitType:e.unit_type??d.unit_type??null,minimumThreshold:e.minimum_threshold??d.minimum_threshold??null,costPerUnit:e.cost_per_unit??d.cost_per_unit??null,supplier:e.supplier??d.supplier??null,active:e.active??d.active??!0,onHandQuantity:0,committedQuantity:0,availableQuantity:0,lastReceiptAt:null}}async function j(a,b,c){let d,e=(d=new Date().toISOString(),{name:c.name,description:c.description??null,category:c.category,unit_type:c.unitType,minimum_threshold:c.minimumThreshold??null,cost_per_unit:c.costPerUnit??null,supplier:c.supplier??null,active:c.active,updated_at:d}),{error:f}=await a.schema("core").from("items").update(e).eq("id",b);if(f)throw f}async function k(a,b){let{error:c}=await a.schema("core").from("items").delete().eq("id",b);if(c)throw c}async function l(a,b,c){let{error:d}=await a.schema("core").from("items").update({active:c,updated_at:new Date().toISOString()}).eq("id",b);if(d)throw d}async function m(a,b){await a.schema("inventory").rpc("receive_stock_with_source",{p_item_id:b.itemId,p_location_id:b.locationId,p_qty:b.quantity,p_unit_cost:b.unitCost??null,p_notes:b.notes??null,p_batch_id:null,p_lot_number:b.lotNumber??null,p_expiry_date:b.expiryDate??null,p_source_type:b.sourceType??null,p_provider_org_id:b.providerOrganizationId??null})}async function n(a,b){await a.schema("inventory").rpc("transfer_stock",{p_item_id:b.itemId,p_from_location_id:b.fromLocationId,p_to_location_id:b.toLocationId,p_qty:b.quantity,p_notes:b.notes??null,p_batch_id:null})}async function o(a,b){await a.schema("inventory").rpc("adjust_stock",{p_item_id:b.itemId,p_location_id:b.locationId,p_qty_delta:b.quantityDelta,p_reason:b.reason,p_notes:b.notes??null,p_batch_id:null,p_unit_cost:b.unitCost??null})}async function p(a,b){for(let c of b.items)await m(a,{itemId:c.itemId,locationId:c.locationId??b.defaultLocationId??"",quantity:c.quantity,unitCost:c.unitCost??null,notes:c.notes??b.globalNotes??null,sourceType:b.sourceType??null,providerOrganizationId:b.providerOrganizationId??null,lotNumber:c.lotNumber??null,expiryDate:c.expiryDate??null})}async function q(a,b){let c,d=(c=new Date().toISOString(),{id:crypto.randomUUID(),name:b.name,code:b.code,type:b.type,address:h(b.address),active:b.active??!0,created_at:c,updated_at:c}),{data:e,error:f}=await a.schema("inventory").from("locations").insert(d).select("*").single();if(f)throw f;return{id:String(e.id),name:e.name??d.name,code:e.code??d.code??null,type:e.type??d.type??null,address:e.address??d.address??null,active:e.active??d.active??!0,createdAt:e.created_at??d.created_at??null,updatedAt:e.updated_at??d.updated_at??null}}async function r(a,b,c){let d,e=(d=new Date().toISOString(),{name:c.name,code:c.code,type:c.type,address:h(c.address),active:c.active??!0,updated_at:d}),{error:f}=await a.schema("inventory").from("locations").update(e).eq("id",b);if(f)throw f}async function s(a,b){let{error:c}=await a.schema("inventory").from("locations").delete().eq("id",b);if(c)throw c}async function t(a,b,c){let{error:d}=await a.schema("inventory").from("locations").update({active:c,updated_at:new Date().toISOString()}).eq("id",b);if(d)throw d}async function u(a,b){let c,d=(c=new Date().toISOString(),{name:b.name,description:b.description??null,website:b.website??null,is_active:!0,created_at:c,updated_at:c}),{data:e,error:f}=await a.schema("core").from("organizations").insert(d).select("*").single();if(f)throw f;return{id:Number.parseInt(String(e.id),10),name:e.name??d.name,description:e.description??d.description??null,website:e.website??d.website??null,isActive:e.is_active??!0,createdAt:e.created_at??d.created_at??null,updatedAt:e.updated_at??d.updated_at??null}}async function v(a,b,c){let d,e=(d=new Date().toISOString(),{name:c.name,description:c.description??null,website:c.website??null,updated_at:d}),{error:f}=await a.schema("core").from("organizations").update(e).eq("id",b);if(f)throw f}async function w(a,b){let{error:c}=await a.schema("core").from("organizations").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",b);if(c)throw c}async function x(a,b){let{error:c}=await a.schema("core").from("organizations").update({is_active:!0,updated_at:new Date().toISOString()}).eq("id",b);if(c)throw c}async function y(a,b,c,d,e){let f=null===c||Number.isNaN(c)?null:c,{error:g}=await a.schema("inventory").rpc("update_transaction_source",{p_transaction_id:b,p_provider_org_id:f,p_source_type:d,p_notes:e});if(g)throw g;let{data:h,error:i}=await a.schema("inventory").from("v_transactions_with_org").select("*").eq("id",b).maybeSingle();if(i)throw i;return h?{id:String(h.id),itemId:String(h.item_id??""),itemName:h.item_name??"",locationId:"string"==typeof h.location_id?h.location_id:null,locationName:"string"==typeof h.location_name?h.location_name:null,qty:Number.parseFloat(String(h.qty??0)),refType:h.ref_type??null,providerOrgId:null===h.provider_org_id||void 0===h.provider_org_id?null:Number.parseInt(String(h.provider_org_id),10),providerOrgName:h.provider_org_name??null,notes:h.notes??null,unitCost:null===h.unit_cost||void 0===h.unit_cost?null:Number.parseFloat(String(h.unit_cost)),createdAt:String(h.created_at??new Date().toISOString()),createdBy:h.created_by??null,batchId:h.batch_id??null,lotNumber:h.lot_number??null,expiryDate:h.expiry_date??null}:null}var z=a.i(83667);function A(a,b=!1){if(null===a)return b;let c="string"==typeof a?a.toLowerCase():String(a).toLowerCase();return"true"===c||"1"===c||"on"===c||"yes"===c}function B(a,{required:b=!1,allowNegative:c=!1}={}){if(null===a||""===a){if(b)throw new g.InventoryAccessError("Missing numeric value.");return null}let d=Number.parseFloat(String(a));if(Number.isNaN(d))throw new g.InventoryAccessError("Invalid numeric value provided.");if(!c&&d<0)throw new g.InventoryAccessError("Negative values are not allowed.");return d}function C(a,b,c){let d=a.get(b);if("string"!=typeof d||0===d.trim().length)throw new g.InventoryAccessError(c);return d.trim()}function D(a,b){let c=a.get(b);if("string"!=typeof c)return null;let d=c.trim();return d.length>0?d:null}async function E(a,b){try{let c=await (0,e.createSupabaseServerClient)(),f=await (0,g.ensureInventoryActor)(c);if(C(a,"actor_profile_id","Admin context is required.")!==f.profile.id)throw new g.InventoryAccessError("Actor profile mismatch.");let h=await b(f,c,a);return await (0,d.revalidatePath)("/admin/inventory"),{success:!0,data:h}}catch(a){return console.error("Inventory mutation failed",a),{success:!1,error:a instanceof g.InventoryAccessError||a instanceof Error?a.message:"An unexpected error occurred."}}}async function F(a){return E(a,async({profile:b},c)=>{let d=await i(c,{name:C(a,"name","Name is required."),description:D(a,"description"),category:C(a,"category","Select a category."),unitType:C(a,"unit_type","Unit type is required."),minimumThreshold:B(a.get("minimum_threshold")),costPerUnit:B(a.get("cost_per_unit")),supplier:D(a,"supplier"),active:A(a.get("active"),!0),initialStockQuantity:B(a.get("initial_stock"),{allowNegative:!1})??0,initialStockLocationId:D(a,"initial_location_id"),initialStockNotes:D(a,"initial_stock_notes")});return await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_item_created",entityType:"inventory_item",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"items",id:d.id}),meta:{name:d.name,category:d.category}}),{item:d}})}async function G(a){return E(a,async({profile:b},c)=>{let d=C(a,"item_id","Item context missing.");await j(c,d,{name:C(a,"name","Name is required."),description:D(a,"description"),category:C(a,"category","Select a category."),unitType:C(a,"unit_type","Unit type is required."),minimumThreshold:B(a.get("minimum_threshold")),costPerUnit:B(a.get("cost_per_unit")),supplier:D(a,"supplier"),active:A(a.get("active"),!0)}),await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_item_updated",entityType:"inventory_item",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"items",id:d})})})}async function H(a){return E(a,async({profile:b},c)=>{let d=C(a,"item_id","Item context missing.");await k(c,d),await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_item_deleted",entityType:"inventory_item",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"items",id:d})})})}async function I(a){return E(a,async({profile:b},c)=>{let d=C(a,"item_id","Item context missing."),e=A(a.get("active"),!0);await l(c,d,e),await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:e?"inventory_item_activated":"inventory_item_deactivated",entityType:"inventory_item",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"items",id:d})})})}async function J(a){return E(a,async({profile:b},c)=>{await m(c,{itemId:C(a,"item_id","Select an item to receive stock for."),locationId:C(a,"location_id","Select a location."),quantity:B(a.get("quantity"),{required:!0,allowNegative:!1})??0,unitCost:B(a.get("unit_cost")),notes:D(a,"notes"),sourceType:D(a,"source_type"),providerOrganizationId:B(a.get("provider_org_id"))??null,lotNumber:D(a,"lot_number"),expiryDate:D(a,"expiry_date")}),await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_stock_received",entityType:"inventory_item",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"items",id:C(a,"item_id","Select an item to receive stock for.")})})})}async function K(a){return E(a,async({profile:b},c)=>{let d,e=C(a,"items","Receipt payload missing.");try{d=JSON.parse(e)}catch{throw new g.InventoryAccessError("Invalid bulk receipt payload.")}await p(c,d),await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_bulk_receipt_processed",entityType:"inventory_bulk_receipt",entityRef:null,meta:{item_ids:d.items.map(a=>a.itemId),total_items:d.items.length}})})}async function L(a){return E(a,async({profile:b},c)=>{await n(c,{itemId:C(a,"item_id","Select an item."),fromLocationId:C(a,"from_location_id","Select the source location."),toLocationId:C(a,"to_location_id","Select the destination location."),quantity:B(a.get("quantity"),{required:!0})??0,notes:D(a,"notes")}),await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_stock_transferred",entityType:"inventory_item",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"items",id:C(a,"item_id","Select an item.")})})})}async function M(a){return E(a,async({profile:b},c)=>{await o(c,{itemId:C(a,"item_id","Select an item."),locationId:C(a,"location_id","Select a location."),quantityDelta:B(a.get("quantity_delta"),{required:!0,allowNegative:!0})??0,reason:C(a,"reason","Include a reason for this adjustment."),notes:D(a,"notes"),unitCost:B(a.get("unit_cost"))}),await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_stock_adjusted",entityType:"inventory_item",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"items",id:C(a,"item_id","Select an item.")})})})}async function N(a){return E(a,async({profile:b,roles:c},d)=>{(0,g.requireInventoryAdmin)(c);let e=await q(d,{name:C(a,"name","Location name is required."),code:C(a,"code","Location code is required."),type:C(a,"type","Location type is required."),address:D(a,"address"),active:A(a.get("active"),!0)});return await (0,f.logAuditEvent)(d,{actorProfileId:b.id,action:"inventory_location_created",entityType:"inventory_location",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"locations",id:e.id})}),{location:e}})}async function O(a){return E(a,async({profile:b,roles:c},d)=>{(0,g.requireInventoryAdmin)(c);let e=C(a,"location_id","Location context missing.");await r(d,e,{name:C(a,"name","Location name is required."),code:C(a,"code","Location code is required."),type:C(a,"type","Location type is required."),address:D(a,"address"),active:A(a.get("active"),!0)}),await (0,f.logAuditEvent)(d,{actorProfileId:b.id,action:"inventory_location_updated",entityType:"inventory_location",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"locations",id:e})})})}async function P(a){return E(a,async({profile:b,roles:c},d)=>{(0,g.requireInventoryAdmin)(c);let e=C(a,"location_id","Location context missing."),h=A(a.get("active"),!0);await t(d,e,h),await (0,f.logAuditEvent)(d,{actorProfileId:b.id,action:h?"inventory_location_activated":"inventory_location_deactivated",entityType:"inventory_location",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"locations",id:e})})})}async function Q(a){return E(a,async({profile:b,roles:c},d)=>{(0,g.requireInventoryAdmin)(c);let e=C(a,"location_id","Location context missing.");await s(d,e),await (0,f.logAuditEvent)(d,{actorProfileId:b.id,action:"inventory_location_deleted",entityType:"inventory_location",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"locations",id:e})})})}async function R(a){return E(a,async({profile:b},c)=>{let d=await u(c,{name:C(a,"name","Organization name is required."),description:D(a,"description"),website:D(a,"website")});return await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_organization_created",entityType:"inventory_organization",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"organizations",id:d.id}),meta:{pk_int:d.id,name:d.name}}),{organization:d}})}async function S(a){return E(a,async({profile:b},c)=>{let d=B(a.get("organization_id"),{required:!0});if(null===d)throw new g.InventoryAccessError("Organization context missing.");await v(c,d,{name:C(a,"name","Organization name is required."),description:D(a,"description"),website:D(a,"website")}),await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_organization_updated",entityType:"inventory_organization",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"organizations",id:d}),meta:{pk_int:d}})})}async function T(a){return E(a,async({profile:b},c)=>{let d=B(a.get("organization_id"),{required:!0});if(null===d)throw new g.InventoryAccessError("Organization context missing.");await x(c,d),await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_organization_activated",entityType:"inventory_organization",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"organizations",id:d}),meta:{pk_int:d}})})}async function U(a){return E(a,async({profile:b},c)=>{let d=B(a.get("organization_id"),{required:!0});if(null===d)throw new g.InventoryAccessError("Organization context missing.");await w(c,d),await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_organization_deactivated",entityType:"inventory_organization",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"organizations",id:d}),meta:{pk_int:d}})})}async function V(a){return E(a,async({profile:b},c)=>{let d=C(a,"transaction_id","Receipt context missing."),e=B(a.get("provider_org_id")),g=D(a,"source_type"),h=D(a,"notes"),i=await y(c,d,e??null,g,h)??await (0,z.fetchInventoryReceiptById)(c,d);return await (0,f.logAuditEvent)(c,{actorProfileId:b.id,action:"inventory_receipt_source_updated",entityType:"inventory_receipt",entityRef:(0,f.buildEntityRef)({schema:"inventory",table:"receipts",id:d})}),{receipt:i??null}})}(0,a.i(13095).ensureServerEntryExports)([F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V]),(0,c.registerServerReference)(F,"400bce6c909697364ba29c68866355de13b09a5677",null),(0,c.registerServerReference)(G,"401df522679bb5cd394bde463e79e3f995ce6a5efc",null),(0,c.registerServerReference)(H,"40a3769bbe61042790510d7f50d8ece8a924cd4c39",null),(0,c.registerServerReference)(I,"40ffa48111ad0c4a3013e10d2da655d8e2d303b4e1",null),(0,c.registerServerReference)(J,"40851b3784f78e9ef426e0d09453fef736e8732c6a",null),(0,c.registerServerReference)(K,"40108f8f43fea9ee4608a53636c7e5b4320d353870",null),(0,c.registerServerReference)(L,"400b464e5b0991def1b3b2300bc775c284e2b96d8f",null),(0,c.registerServerReference)(M,"40fb42223fbaabe80e63bff0a00e0c25fc6ca0c331",null),(0,c.registerServerReference)(N,"40c153c0874e0597d5f04a817d0928aefa366716e4",null),(0,c.registerServerReference)(O,"403014c4d0ee7a583a8a2c8c5a314df163558e4736",null),(0,c.registerServerReference)(P,"40fd8e40b97335e8e630438a39271991fb2f4f520b",null),(0,c.registerServerReference)(Q,"40f775c10ca9cf9d6c308ac61d1b52e8a140be2f0e",null),(0,c.registerServerReference)(R,"403263e68d5afcf0e54388f8c3c082e81b41c0e5e6",null),(0,c.registerServerReference)(S,"40b57083cd9a496d5383e32b42398020dd1ffbba71",null),(0,c.registerServerReference)(T,"40e5c60a8c1676edfc87099175fd266ba32884246b",null),(0,c.registerServerReference)(U,"408435383f391874e84eaed865e5e05045fc70724a",null),(0,c.registerServerReference)(V,"401deed810cec397afe0dde30ec44d021f5dd2c3e9",null),a.s([],85986),a.i(85986),a.s(["00b7ee4fee263fec1fe8acb860989f6ddb47485e3a",()=>b.$$RSC_SERVER_ACTION_0,"400b464e5b0991def1b3b2300bc775c284e2b96d8f",()=>L,"400bce6c909697364ba29c68866355de13b09a5677",()=>F,"40108f8f43fea9ee4608a53636c7e5b4320d353870",()=>K,"401deed810cec397afe0dde30ec44d021f5dd2c3e9",()=>V,"401df522679bb5cd394bde463e79e3f995ce6a5efc",()=>G,"403014c4d0ee7a583a8a2c8c5a314df163558e4736",()=>O,"403263e68d5afcf0e54388f8c3c082e81b41c0e5e6",()=>R,"408435383f391874e84eaed865e5e05045fc70724a",()=>U,"40851b3784f78e9ef426e0d09453fef736e8732c6a",()=>J,"40a3769bbe61042790510d7f50d8ece8a924cd4c39",()=>H,"40b57083cd9a496d5383e32b42398020dd1ffbba71",()=>S,"40c153c0874e0597d5f04a817d0928aefa366716e4",()=>N,"40e5c60a8c1676edfc87099175fd266ba32884246b",()=>T,"40f775c10ca9cf9d6c308ac61d1b52e8a140be2f0e",()=>Q,"40fb42223fbaabe80e63bff0a00e0c25fc6ca0c331",()=>M,"40fd8e40b97335e8e630438a39271991fb2f4f520b",()=>P,"40ffa48111ad0c4a3013e10d2da655d8e2d303b4e1",()=>I],10780)}];

//# sourceMappingURL=ce889_server_app_%28portal%29_admin_inventory_overview_page_actions_de609751.js.map