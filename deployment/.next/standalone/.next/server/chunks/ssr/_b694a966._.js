module.exports=[63985,a=>{"use strict";let b="[redacted]",c=["password","token","secret","authorization","cookie","session","otp","code","sin","ssn","birth","dob","email","phone","contact","address"];function d(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return b===Object.prototype||null===b}let e=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,f=/^[0-9]+$/,g=/^[a-z0-9_]+$/i,h=/^[a-zA-Z0-9._:-]+$/;function i(a){if(null==a)return null;let b="number"==typeof a?String(a):a.trim?.()??a;return"string"!=typeof b||0===b.length?null:e.test(b)||f.test(b)?b:b.slice(0,128)}function j(a){let b=i(a);return b&&e.test(b)?b:null}function k(a){if(!a)return null;let{schema:b,table:c,id:d}=a;if(!g.test(b)||!g.test(c))return null;let e=i(d);return e&&h.test(e)?`${b.toLowerCase()}.${c.toLowerCase()}:${e}`:null}async function l(a,{actorProfileId:e=null,action:f,entityType:g,entityRef:h,entityId:i,meta:l}){let m=l&&d(l)?function a(e,f){let g={};return Object.entries(e).forEach(([e,h])=>{let i;if(i=e.toLowerCase(),c.some(a=>i.includes(a))){g[e]=b;return}let j=function c(e,f){if(void 0!==e){if(null===e)return null;if("string"==typeof e)return e.length>1024?`${e.slice(0,1024)}...`:e;if("number"==typeof e||"boolean"==typeof e)return e;if("bigint"==typeof e)return e.toString();if(e instanceof Date)return e.toISOString();if(e instanceof URL)return e.toString();if(e instanceof Error)return{name:e.name,message:e.message};if(Array.isArray(e))return e.map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Set)return Array.from(e).map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Map){let a={};return e.forEach((b,d)=>{let e=c(b,f);void 0!==e&&(a[String(d)]=e)}),a}return"object"==typeof e&&d(e)?f.has(e)?b:(f.add(e),a(e,f)):String(e)}}(h,f);void 0!==j&&(g[e]=j)}),g}(l,new WeakSet):{},n="string"==typeof h?h:k(h),o=j(i);!o&&n&&(o=j(n.split(":").pop()??null));let p=!n||"entity_ref"in m?m:{...m,entity_ref:n},q=j(e),{error:r}=await a.rpc("portal_log_audit_event",{p_action:f,p_entity_type:g,p_entity_id:o,p_meta:p,p_actor_profile_id:q});if(r)throw r}a.s(["buildEntityRef",()=>k,"logAuditEvent",()=>l],63985)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},3922,90457,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(16349),e=a.i(63985),f=a.i(62722),g=a.i(52404),h=a.i(27331);let i=Array.from(new Set([...h.default.defaults.allowedTags,"iframe"])),j={...h.default.defaults.allowedAttributes,iframe:["src","title","allow","allowfullscreen","loading","referrerpolicy"],a:["href","title","rel","target"]},k=["https","mailto"];function l(a){try{return new URL(a).hostname.toLowerCase()}catch{return""}}let m=new Set(["https:","mailto:"]);function n(a){return a.split(",").map(a=>a.trim()).filter(a=>a.length>0).map(a=>a.toLowerCase()).slice(0,20)}function o(a){let b=a.split("\n").map(a=>a.trim()).filter(Boolean),c=[];for(let a of b){let b,[d,e]=a.split("|").map(a=>a.trim()),f=e??d??"";if(!f)continue;try{b=(function(a,b){if(!m.has(a.protocol))throw Error(`Attachments must use https or mailto links. Check: ${b}`);return a})(new URL(f),f).toString()}catch{throw Error(`Attachment URL must be valid. Check: ${f}`)}let g=d&&e?d:b;c.push({label:g.slice(0,160),url:b})}return c.slice(0,10)}function p(a){let b=a.type??"none";if(!b||"none"===b)return null;switch(b){case"google-doc":case"pdf":{let c=a.url?.trim();if(!c)throw Error("Provide a URL for the embed.");return(0,f.assertAllowedEmbedUrl)(c,"resource_embed"),{type:b,url:c}}case"video":{let c=a.url?.trim(),d="vimeo"===a.provider?"vimeo":"youtube";if(!c)throw Error("Provide a video URL to embed.");return(0,f.assertAllowedEmbedUrl)(c,"resource_video_embed"),{type:b,url:c,provider:d}}case"external":{let c,d=a.url?.trim();if(!d)throw Error("Provide the external resource URL.");try{c=new URL(d)}catch{throw Error("Provide a valid https URL for the external resource.")}if("https:"!==c.protocol)throw Error("External resource URLs must use https.");return{type:b,url:d,label:a.label?.trim()||void 0}}case"html":{let c=a.html?.trim();if(!c)throw Error("Paste the HTML snippet you would like to embed.");return{type:b,html:(0,h.default)(c,{allowedTags:i,allowedAttributes:j,allowedSchemes:k,allowedSchemesByTag:{iframe:["https"]},transformTags:{iframe:(a,b)=>{let c=b.src;return c&&f.ALLOWED_EMBED_HOSTS.has(l(c))?{tagName:a,attribs:{...b,loading:b.loading??"lazy",referrerpolicy:b.referrerpolicy??"no-referrer-when-downgrade"}}:{tagName:"div",attribs:{},text:""}},a:(a,b)=>b.href?{tagName:a,attribs:{...b,rel:b.rel??"noopener noreferrer",target:b.target??"_blank"}}:{tagName:a,attribs:{...b}}},exclusiveFilter:a=>{if("iframe"===a.tag){let b=a.attribs?.src;if(!b||!f.ALLOWED_EMBED_HOSTS.has(l(b)))return!0}return!1}})}}default:return null}}function q(a){return a.length?a.map(a=>`${a.label} | ${a.url}`).join("\n"):""}function r(a){let b=a.embed;if(!b)return{type:"none",url:"",provider:"youtube",label:"",html:""};switch(b.type){case"google-doc":case"pdf":return{type:b.type,url:b.url,provider:"youtube",label:"",html:""};case"video":return{type:"video",url:b.url,provider:b.provider,label:"",html:""};case"external":return{type:"external",url:b.url,provider:"youtube",label:b.label??"",html:""};case"html":return{type:"html",url:"",provider:"youtube",label:"",html:b.html};default:return{type:"none",url:"",provider:"youtube",label:"",html:""}}}a.s(["attachmentsToTextarea",()=>q,"buildResourceEmbedPayload",()=>p,"getResourceEmbedDefaults",()=>r,"parseResourceAttachmentsInput",()=>o,"parseResourceTagsInput",()=>n],90457);var s=a.i(42145),t=a.i(65108),u=a.i(10508);async function v(...a){let b=Array.from(new Set(a.filter(a=>!!a).map(a=>a.trim()).filter(Boolean)));await Promise.all(b.map(a=>(0,c.revalidatePath)(a)))}async function w(){let a=await (0,d.createSupabaseServerClient)(),b=await (0,t.loadPortalAccess)(a);if(!b)throw Error("Sign in to continue.");if(!b.canManageResources)throw Error("Admin access is required.");let c=await (0,s.ensurePortalProfile)(a,b.userId);return{supabase:a,portalClient:a.schema("portal"),actorProfile:c}}async function x(a){let{supabase:b,portalClient:c,actorProfile:d}=await w(),h=a.get("title")?.trim()??"";if(!h)throw Error("Add a resource title.");let i=a.get("slug")?.trim()??"",j=(0,f.normalizeResourceSlug)(i||h);j||(j=`resource-${Date.now()}`);let k=a.get("kind")?.trim()??"",l=await (0,u.getResourceKinds)(b);if(!k||!l.includes(k))throw Error("Select a valid resource type.");let m=a.get("date_published")?.trim()??"";if(!/^\d{4}-\d{2}-\d{2}$/.test(m))throw Error("Enter the publication date in YYYY-MM-DD format.");let q=a.get("summary")?.trim()||null,r=a.get("location")?.trim()||null,s=n(a.get("tags")??""),t=o(a.get("attachments")??""),x=p({type:a.get("embed_type")??"none",url:a.get("embed_url")??"",provider:a.get("embed_provider")??"youtube",label:a.get("embed_label")??"",html:a.get("embed_html")??""}),y=a.get("embed_placement")?.trim()??"above",z=await (0,u.getResourceEmbedPlacements)(b),A=z.includes(y)?y:z[0]||"above",B=a.get("body_html")??"",C=(0,g.sanitizeResourceHtml)(B),D="on"===a.get("is_published"),{data:E,error:F}=await c.from("resource_pages").insert({slug:j,title:h,kind:k,date_published:m,summary:q,location:r,tags:s,attachments:t,embed:x,embed_placement:A,body_html:C,is_published:D,created_by_profile_id:d.id,updated_by_profile_id:d.id}).select("id, slug").maybeSingle();if(F)throw F;await (0,e.logAuditEvent)(b,{actorProfileId:d.id,action:"resource_page_created",entityType:"resource_page",entityRef:(0,e.buildEntityRef)({schema:"portal",table:"resource_pages",id:E?.id??null}),meta:{slug:j,kind:k,is_published:D,tags:s}});let G=`/admin/resources/${j}`;await v("/admin","/admin/resources",G)}async function y(a){let{supabase:b,portalClient:c,actorProfile:d}=await w(),h=a.get("resource_id"),i=a.get("current_slug")?.trim()??null;if(!h)throw Error("Admin context is required.");let{data:j,error:k}=await c.from("resource_pages").select("slug").eq("id",h).maybeSingle();if(k||!j)throw k??Error("Resource not found.");let l=a.get("title")?.trim()??"";if(!l)throw Error("Add a resource title.");let m=a.get("slug")?.trim()??"",q=(0,f.normalizeResourceSlug)(m||l);q||(q=j.slug);let r=a.get("kind")?.trim()??"",s=await (0,u.getResourceKinds)(b);if(!r||!s.includes(r))throw Error("Select a valid resource type.");let t=a.get("date_published")?.trim()??"";if(!/^\d{4}-\d{2}-\d{2}$/.test(t))throw Error("Enter the publication date in YYYY-MM-DD format.");let x=a.get("summary")?.trim()||null,y=a.get("location")?.trim()||null,z=n(a.get("tags")??""),A=o(a.get("attachments")??""),B=p({type:a.get("embed_type")??"none",url:a.get("embed_url")??"",provider:a.get("embed_provider")??"youtube",label:a.get("embed_label")??"",html:a.get("embed_html")??""}),C=a.get("embed_placement")?.trim()??"above",D=await (0,u.getResourceEmbedPlacements)(b),E=D.includes(C)?C:D[0]||"above",F=a.get("body_html")??"",G=(0,g.sanitizeResourceHtml)(F),H="on"===a.get("is_published"),{error:I}=await c.from("resource_pages").update({slug:q,title:l,kind:r,date_published:t,summary:x,location:y,tags:z,attachments:A,embed:B,embed_placement:E,body_html:G,is_published:H,updated_by_profile_id:d.id}).eq("id",h);if(I)throw I;await (0,e.logAuditEvent)(b,{actorProfileId:d.id,action:"resource_page_updated",entityType:"resource_page",entityRef:(0,e.buildEntityRef)({schema:"portal",table:"resource_pages",id:h}),meta:{slug:q,kind:r,is_published:H,tags:z}});let J=`/admin/resources/${q}`,K=i&&i!==q?`/resources/${i}`:null,L=i&&i!==q?`/admin/resources/${i}`:null;await v("/admin","/admin/resources",J,"/resources",`/resources/${q}`,K,L,"/sitemap.xml")}async function z(a){try{let{supabase:b,portalClient:c,actorProfile:d}=await w(),f=a.get("resource_id");if(!f)throw Error("Resource context missing.");let h=a.get("body_html")??"",i=a.get("summary")??null,j=i?.trim()||null,k=(0,g.sanitizeResourceHtml)(h),{error:l}=await c.from("resource_pages").update({body_html:k,summary:j,updated_by_profile_id:d.id}).eq("id",f);if(l)throw l;return await (0,e.logAuditEvent)(b,{actorProfileId:d.id,action:"resource_page_autosaved",entityType:"resource_page",entityRef:(0,e.buildEntityRef)({schema:"portal",table:"resource_pages",id:f}),meta:{fields:["body_html","summary"]}}),{success:!0}}catch(a){return console.error("updateResourceDraftAction error",a),{success:!1,error:a instanceof Error?a.message:"Unable to autosave right now."}}}async function A(a){let b=a.get("resource_id"),c=a.get("resource_slug")?.trim()??null;if(!b)throw Error("Admin context is required.");let{supabase:d,portalClient:f,actorProfile:g}=await w(),{error:h}=await f.from("resource_pages").delete().eq("id",b);if(h)throw h;await (0,e.logAuditEvent)(d,{actorProfileId:g.id,action:"resource_page_deleted",entityType:"resource_page",entityRef:(0,e.buildEntityRef)({schema:"portal",table:"resource_pages",id:b}),meta:{slug:c}}),await v("/admin","/admin/resources","/resources",c?`/resources/${c}`:null,c?`/admin/resources/${c}`:null,"/sitemap.xml")}(0,a.i(13095).ensureServerEntryExports)([x,y,z,A]),(0,b.registerServerReference)(x,"4019f6db14d508e67bd0c10f883fd9731f3da1fe8f",null),(0,b.registerServerReference)(y,"40d6ce552731eb3482b730ff5b50c5307350d78295",null),(0,b.registerServerReference)(z,"409b772654760143dd42acb61b41d8d1c1d00d0ddf",null),(0,b.registerServerReference)(A,"40bb15427bdcc383201e244bb8950ff6286b2da660",null),a.s(["createResourcePage",()=>x,"deleteResourcePage",()=>A,"updateResourceDraftAction",()=>z,"updateResourcePage",()=>y],3922)},86680,a=>{"use strict";var b=a.i(86731),c=a.i(3922);a.s([],22046),a.i(22046),a.s(["00b7ee4fee263fec1fe8acb860989f6ddb47485e3a",()=>b.$$RSC_SERVER_ACTION_0,"4019f6db14d508e67bd0c10f883fd9731f3da1fe8f",()=>c.createResourcePage,"409b772654760143dd42acb61b41d8d1c1d00d0ddf",()=>c.updateResourceDraftAction,"40bb15427bdcc383201e244bb8950ff6286b2da660",()=>c.deleteResourcePage,"40d6ce552731eb3482b730ff5b50c5307350d78295",()=>c.updateResourcePage],86680)}];

//# sourceMappingURL=_b694a966._.js.map