module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},16349,a=>{"use strict";var b=a.i(5246);a.i(42537);var c=a.i(5860),d=a.i(31507);async function e(){let{url:a,anonKey:e}=(0,d.getSupabaseEnv)(),f=await (0,b.cookies)();return(0,c.createServerClient)(a,e,{cookies:{getAll:()=>f.getAll(),setAll(a){a.forEach(({name:a,value:b,options:c})=>{try{f.set(a,b,{path:"/",sameSite:"lax",httpOnly:!0,secure:!0,...c})}catch(a){}})}}})}a.s(["createSupabaseServerClient",()=>e])},24448,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call AuthLinks() from the server but AuthLinks is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/layout/auth-links.tsx <module evaluation>","AuthLinks");a.s(["AuthLinks",0,b])},73771,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call AuthLinks() from the server but AuthLinks is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/layout/auth-links.tsx","AuthLinks");a.s(["AuthLinks",0,b])},73991,a=>{"use strict";a.i(24448);var b=a.i(73771);a.n(b)},6387,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call UserMenu() from the server but UserMenu is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/layout/user-menu.tsx <module evaluation>","UserMenu");a.s(["UserMenu",0,b])},38747,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call UserMenu() from the server but UserMenu is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/layout/user-menu.tsx","UserMenu");a.s(["UserMenu",0,b])},45670,a=>{"use strict";a.i(6387);var b=a.i(38747);a.n(b)},86731,a=>{"use strict";var b=a.i(7997),c=a.i(37936);a.i(70396);var d=a.i(73727),e=a.i(9919),f=a.i(16349),g=a.i(65108),h=a.i(73991),i=a.i(45670);async function j(a){let c=a;if(!c){let a=await (0,e.createSupabaseRSCClient)();c=await (0,g.loadPortalAccess)(a)}if(!c)return{desktop:(0,b.jsx)(h.AuthLinks,{}),mobile:(0,b.jsx)(h.AuthLinks,{layout:"stacked"})};let{profile:d}=c,f=d.display_name||"Community member",j=d.position_title,k="pending"===d.affiliation_status,m="revoked"===d.affiliation_status,n=(0,g.buildUserMenuLinks)(c),o=(0,b.jsx)(i.UserMenu,{displayName:f,positionTitle:j??void 0,awaitingVerification:k,affiliationRevoked:m,menuItems:n,initials:function(a){let b=a.trim().split(/\s+/);if(0===b.length)return"CM";let c=b[0]?.[0],d=b.length>1?b[b.length-1]?.[0]:b[0]?.[1];return`${c??""}${d??""}`.toUpperCase()||"CM"}(f),signOutAction:l});return{desktop:o,mobile:o}}let k=async function(){let a=await (0,f.createSupabaseServerClient)();await a.auth.signOut(),(0,d.redirect)("/")};(0,c.registerServerReference)(k,"00b7ee4fee263fec1fe8acb860989f6ddb47485e3a",null);var l=k;a.s(["$$RSC_SERVER_ACTION_0",0,k,"getUserNavigation",()=>j])},46592,28215,a=>{"use strict";var b=a.i(4985);function c(a){if(!a)return a;let b=a.replace(/\/\([^/]+\)/g,"")||"/";return b.startsWith("/")?b:`/${b}`}function d(a,b="/"){if(!a)return{pathname:b,path:b};let e=(a,d)=>{let e=c(a||b),f=`${e}${d}`||b;return{pathname:e||b,path:f}};try{let c=a.startsWith("http://")||a.startsWith("https://")?new URL(a):new URL(a,"http://localhost"),d=c.pathname||b,f=c.search||"";return e(d,f)}catch{if(a.startsWith("/")){let[b,...c]=a.split("?");return e(b||"/",c.length?`?${c.join("?")}`:"")}return{pathname:b,path:b}}}a.s(["normalizePathFromHeader",()=>d,"stripRouteGroups",()=>c],28215);let e=["admin","org","staff","client"];function f(a){let c=(0,b.getWorkspaceNavBlueprint)(a);if(c?.defaultRoute)return c.defaultRoute;switch(a){case"admin":return"/admin";case"org":return"/org";case"staff":return"/staff";default:return"/home"}}function g(a){if(!a)return[m()];let b=[m({roleLabel:n(a,"client"),statusLabel:o(a),statusTone:p(a)})];return a.canAccessAdminWorkspace&&b.push({id:"admin",label:"Admin workspace",href:f("admin"),description:"Team tooling for moderation, content, and operations.",roleLabel:n(a,"admin"),statusLabel:o(a),statusTone:p(a)}),a.canAccessOrgWorkspace&&b.push({id:"org",label:"Organization workspace",href:f("org"),description:"Org-scoped controls for members, invites, and settings.",roleLabel:n(a,"org"),statusLabel:o(a),statusTone:p(a)}),a.canAccessStaffWorkspace&&b.push({id:"staff",label:"Staff workspace",href:f("staff"),description:"IHARC staff and volunteer caseload + outreach tools.",roleLabel:n(a,"staff"),statusLabel:o(a),statusTone:p(a)}),b}function h(a){let b=g(a),c=e.find(a=>b.some(b=>b.id===a));if(c){let a=b.find(a=>a.id===c);if(a)return a}return m()}function i(a){return h(a).href}function j(a){let b=c(a);return b.startsWith("/admin")?"admin":b.startsWith("/org")?"org":b.startsWith("/staff")?"staff":"client"}function k(a,b){return"client"===b&&g(a).some(a=>"client"!==a.id)}function l(a,b,{isPreview:c}={}){if(!a)return[];let d=!!c;return"client"===b?[{id:"client-request-appointment",label:"Request appointment",href:"/appointments#request-form",description:"Share availability with outreach staff",icon:"calendar",disabled:d},{id:"client-message-support",label:"Message the team",href:"/support#message-tray",description:"Ask for help or updates",icon:"chat",disabled:d},{id:"client-view-documents",label:"View secure documents",href:"/documents",description:"Check shared files and expiry",icon:"file",disabled:!1}]:"staff"===b?[{id:"staff-add-outreach",label:"Log outreach note",href:"/staff/outreach",description:"Capture quick outreach details",icon:"chat",disabled:d},{id:"staff-new-case-note",label:"Add case note",href:"/staff/cases",description:"Open cases and add updates",icon:"file",disabled:d}]:"org"===b?[{id:"org-new-invite",label:"Invite member",href:"/org/invites",description:"Send an organization invite",icon:"chat",disabled:d},{id:"org-add-profile",label:"Update org profile",href:"/org/settings",description:"Edit details and contacts",icon:"file",disabled:d}]:"admin"===b?[{id:"admin-invite-user",label:"Invite user",href:"/admin/profiles",description:"Send portal invite",icon:"chat",disabled:d},{id:"admin-new-notification",label:"Send notification",href:"/admin/notifications",description:"Queue SMS or email",icon:"file",disabled:d}]:[]}function m(a={}){return{id:"client",label:"Client portal",href:f("client"),description:"Client-facing navigation for neighbours using STEVI.",roleLabel:"Client",statusLabel:"Approved",statusTone:"neutral",...a}}function n(a,b){switch(b){case"admin":if(a.portalRoles.includes("portal_admin"))return"Portal admin";if(a.iharcRoles.includes("iharc_admin"))return"IHARC admin";if(a.portalRoles.includes("portal_org_admin"))return"Org admin";return"Admin";case"org":if(a.portalRoles.includes("portal_org_admin"))return"Org admin";if(a.portalRoles.includes("portal_org_rep"))return"Org rep";return"Organization";case"staff":if(a.iharcRoles.includes("iharc_supervisor"))return"IHARC supervisor";if(a.iharcRoles.includes("iharc_staff"))return"IHARC staff";if(a.iharcRoles.includes("iharc_volunteer"))return"Volunteer";return"Staff";default:return"Client"}}function o(a){let b=a.profile.affiliation_status;return"approved"===b?"Approved":"pending"===b?"Pending review":"revoked"===b?"Suspended":"Unknown"}function p(a){let b=a.profile.affiliation_status;return"approved"===b?"success":"pending"===b?"warning":"revoked"===b?"critical":"neutral"}a.s(["inferWorkspaceFromPath",()=>j,"isClientPreview",()=>k,"resolveDefaultWorkspace",()=>h,"resolveDefaultWorkspacePath",()=>i,"resolveWorkspaceOptions",()=>g,"resolveWorkspaceQuickActions",()=>l],46592)},790,(a,b,c)=>{let{createClientModuleProxy:d}=a.r(11857);a.n(d("[project]/node_modules/next/dist/client/app-dir/link.js <module evaluation>"))},84707,(a,b,c)=>{let{createClientModuleProxy:d}=a.r(11857);a.n(d("[project]/node_modules/next/dist/client/app-dir/link.js"))},97647,a=>{"use strict";a.i(790);var b=a.i(84707);a.n(b)},95936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return i},useLinkStatus:function(){return h.useLinkStatus}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(64240),g=a.r(7997),h=f._(a.r(97647));function i(a){let b=a.legacyBehavior,c="string"==typeof a.children||"number"==typeof a.children||"string"==typeof a.children?.type,d=a.children?.type?.$$typeof===Symbol.for("react.client.reference");return!b||c||d||(a.children?.type?.$$typeof===Symbol.for("react.lazy")?console.error("Using a Lazy Component as a direct child of `<Link legacyBehavior>` from a Server Component is not supported. If you need legacyBehavior, wrap your Lazy Component in a Client Component that renders the Link's `<a>` tag."):console.error("Using a Server Component as a direct child of `<Link legacyBehavior>` is not supported. If you need legacyBehavior, wrap your Server Component in a Client Component that renders the Link's `<a>` tag.")),(0,g.jsx)(h.default,{...a})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},42085,a=>{"use strict";var b=a.i(66799);let c="case_mgmt",d="case_management",e="people_activities";async function f(a,e){let f=await (0,b.findPersonForUser)(a,e);if(!f)return[];let g=a.schema(c),{data:h,error:i}=await g.from(d).select("*").eq("person_id",f.id).order("start_date",{ascending:!1});if(i)throw console.error("Failed to load client cases",{userId:e,personId:f.id,error:i}),Error("Unable to load your cases right now.");return(h??[]).map(n)}async function g(a,e,f){let g=await (0,b.findPersonForUser)(a,e);if(!g)return null;let h=a.schema(c),{data:i,error:j}=await h.from(d).select("*").eq("id",f).eq("person_id",g.id).maybeSingle();if(j)throw console.error("Failed to load client case detail",{userId:e,caseId:f,error:j}),Error("Unable to load that case.");return i?{...n(i),personId:g.id}:null}async function h(a,b,c=20){let d=a.schema("core"),{data:f,error:g}=await d.from(e).select("*").eq("person_id",b).contains("metadata",{client_visible:!0}).order("activity_date",{ascending:!1}).order("activity_time",{ascending:!1}).limit(c);if(g)throw Error("Unable to load case activity right now.");return(f??[]).map(a=>({id:a.id,title:a.title,description:a.description,activityDate:a.activity_date,activityTime:a.activity_time,activityType:a.activity_type}))}async function i(a,c){let d=await (0,b.findPersonForUser)(a,c);return d?{personId:d.id,snapshot:{dataSharing:d.data_sharing_consent,preferredContactMethod:d.preferred_contact_method,privacyRestrictions:d.privacy_restrictions}}:null}async function j(a,b=50){let e=a.schema(c),{data:f,error:g}=await e.from(d).select("*").order("start_date",{ascending:!1}).limit(b);if(g)throw console.error("Failed to load staff cases",{error:g}),Error("Unable to load cases.");return(f??[]).map(a=>({...n(a),personId:a.person_id}))}async function k(a,b){let e=a.schema(c),{data:f,error:g}=await e.from(d).select("*").eq("id",b).maybeSingle();if(g)throw console.error("Failed to load staff case detail",{caseId:b,error:g}),Error("Unable to load that case.");return f?{...n(f),personId:f.person_id}:null}async function l(a,b,c=50){let d=a.schema("core"),{data:f,error:g}=await d.from(e).select("*").eq("person_id",b).order("activity_date",{ascending:!1}).order("activity_time",{ascending:!1}).limit(c);if(g)throw console.error("Failed to load staff case activities",{personId:b,error:g}),Error("Unable to load activity.");return(f??[]).map(a=>({id:a.id,title:a.title,description:a.description,activityDate:a.activity_date,activityTime:a.activity_time,activityType:a.activity_type}))}async function m(a){let b=a.schema("portal"),{data:c,error:d}=await b.from("registration_flows").select("*").eq("flow_type","client_intake").eq("status","submitted").order("created_at",{ascending:!0}).limit(50);if(d)throw Error("Unable to load intake submissions.");return(c??[]).map(a=>({id:a.id,chosenName:a.chosen_name,contactEmail:a.contact_email,contactPhone:a.contact_phone,status:a.status,createdAt:a.created_at,metadata:a.metadata??{},supabaseUserId:a.supabase_user_id,profileId:a.profile_id,consentContact:a.consent_contact,consentDataSharing:a.consent_data_sharing}))}function n(a){return{id:Number(a.id),caseNumber:a.case_number??null,caseType:a.case_type??null,status:a.status??null,priority:a.priority??null,caseManagerName:a.case_manager_name??"Case manager",caseManagerContact:a.case_manager_contact??null,startDate:a.start_date??null,endDate:a.end_date??null}}a.s(["fetchClientCaseActivities",()=>h,"fetchClientCaseDetail",()=>g,"fetchClientCases",()=>f,"fetchPendingIntakes",()=>m,"fetchPersonConsents",()=>i,"fetchStaffCaseActivities",()=>l,"fetchStaffCaseDetail",()=>k,"fetchStaffCases",()=>j])},3412,a=>{"use strict";var b=a.i(9919);let c="inactive",d="core",e="portal",f="case_mgmt",g="people",h="user_people",i="client_intakes",j="registration_flows";function k(...a){let b=a.filter(a=>!!a).map(a=>({value:a,parsed:Date.parse(a)})).filter(({parsed:a})=>Number.isFinite(a));return 0===b.length?null:b.reduce((a,b)=>b.parsed>a.parsed?b:a).value}async function l(a,{userId:b,personId:c}){let f={personId:c??null,profileId:null,linkedAt:null};if(b){let c=a.schema(e),{data:d,error:g}=await c.from("profiles").select("id").eq("user_id",b).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(g)throw Error("Unable to resolve onboarding status right now.");f.profileId=d?.id??null}if(b){let c=a.schema(d),{data:e,error:g}=await c.from(h).select("person_id, profile_id, linked_at").eq("user_id",b).order("linked_at",{ascending:!1}).limit(1).maybeSingle();if(g)throw Error("Unable to resolve onboarding status right now.");f.linkedAt=e?.linked_at??null,f.personId||(f.personId=e?.person_id??null),f.profileId||(f.profileId=e?.profile_id??null)}return f}async function m(a,b){if(!b)return null;let c=a.schema(d),{data:e,error:f}=await c.from(g).select("id, status, data_sharing_consent, updated_at, created_at").eq("id",b).maybeSingle();if(f)throw Error("Unable to resolve onboarding status right now.");return e??null}async function n(a,b){if(!b)return null;let c=a.schema(f),{data:d,error:e}=await c.from(i).select("id, consent_confirmed, privacy_acknowledged, created_at").eq("person_id",b).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(e)throw Error("Unable to resolve onboarding status right now.");return d??null}async function o(a,{userId:b,profileId:c}){let d=[];if(c&&d.push(`profile_id.eq.${c}`),b&&d.push(`supabase_user_id.eq.${b}`),0===d.length)return null;let f=a.schema(e).from(j).select("id, updated_at, created_at").order("updated_at",{ascending:!1}).limit(1);if(1===d.length){let[a,b]=d[0].split(".eq.");a&&b&&(f=f.eq(a,b))}else f=f.or(d.join(","));let{data:g,error:h}=await f.maybeSingle();if(h)throw Error("Unable to resolve onboarding status right now.");return g?g.updated_at??g.created_at??null:null}async function p(a,d){let{userId:e=null,personId:f=null}=a;if(!e&&!f)throw Error("Onboarding status requires a user id or person id.");let g=d??await (0,b.createSupabaseRSCClient)(),h=await l(g,{userId:e,personId:f}),[i,j,p]=await Promise.all([m(g,h.personId),n(g,h.personId),o(g,{userId:e,profileId:h.profileId})]),q=!!i&&i.status!==c,r=!!j,s=j?.consent_confirmed===!0,t=j?.privacy_acknowledged===!0,u="boolean"==typeof i?.data_sharing_consent,v=k(i?.updated_at,i?.created_at,j?.created_at,h.linkedAt,p);return{status:q?s&&t&&u?"COMPLETED":"NEEDS_CONSENTS":"NOT_STARTED",hasPerson:q,hasIntake:r,hasServiceAgreementConsent:s,hasPrivacyAcknowledgement:t,hasDataSharingPreference:u,personId:i?.id??h.personId??null,profileId:h.profileId,lastUpdatedAt:v}}async function q(a,b){return p({userId:a},b)}async function r(a,l){if(0===a.length)return{};let m=l??await (0,b.createSupabaseRSCClient)(),n=m.schema(d),o=m.schema(f),[p,q,r]=await Promise.all([n.from(g).select("id, status, data_sharing_consent, updated_at, created_at").in("id",a),o.from(i).select("id, person_id, consent_confirmed, privacy_acknowledged, created_at").in("person_id",a).order("created_at",{ascending:!1}),n.from(h).select("person_id, profile_id, linked_at").in("person_id",a).order("linked_at",{ascending:!1})]);if(p.error)throw p.error;if(q.error)throw q.error;if(r.error)throw r.error;let s=p.data??[],t=q.data??[],u=r.data??[],v=new Map(s.map(a=>[a.id,a])),w=new Map;for(let a of t)w.has(a.person_id)||w.set(a.person_id,{id:a.id,consent_confirmed:a.consent_confirmed,privacy_acknowledged:a.privacy_acknowledged,created_at:a.created_at});let x=new Map,y=[];for(let a of u)!x.has(a.person_id)&&(x.set(a.person_id,{profileId:a.profile_id??null,linkedAt:a.linked_at??null}),a.profile_id&&y.push(a.profile_id));let z=new Map;if(y.length>0){let a=m.schema(e),{data:b,error:c}=await a.from(j).select("profile_id, updated_at, created_at").in("profile_id",y).order("updated_at",{ascending:!1});if(c)throw c;for(let a of(z=new Map,b??[])){let b=a.profile_id,c=a.updated_at??a.created_at??null;b&&c&&(z.has(b)||z.set(b,c))}}let A={};for(let b of a){let a=v.get(b)??null,d=w.get(b)??null,e=x.get(b)??null,f=e?.profileId&&z.has(e.profileId)?z.get(e.profileId)??null:null,g=!!a&&a.status!==c,h=d?.consent_confirmed===!0,i=d?.privacy_acknowledged===!0,j="boolean"==typeof a?.data_sharing_consent,l=g?h&&i&&j?"COMPLETED":"NEEDS_CONSENTS":"NOT_STARTED",m=k(a?.updated_at,a?.created_at,d?.created_at,e?.linkedAt??null,f);A[b]={status:l,hasPerson:g,hasIntake:!!d,hasServiceAgreementConsent:h,hasPrivacyAcknowledgement:i,hasDataSharingPreference:j,personId:a?.id??b??null,profileId:e?.profileId??null,lastUpdatedAt:m}}return A}a.s(["getOnboardingStatus",()=>p,"getOnboardingStatusForPeople",()=>r,"getOnboardingStatusForUser",()=>q])},66799,a=>{"use strict";var b=a.i(10508);let c="people",d="user_people";async function e(a,b){let e=a.schema("core"),{data:f,error:g}=await e.from(d).select("person_id").eq("user_id",b).limit(1).maybeSingle();if(g)throw Error("Unable to resolve your client link right now.");if(!f?.person_id)return null;let{data:h,error:i}=await e.from(c).select("*").eq("id",f.person_id).maybeSingle();if(i)throw Error("Unable to load linked client record.");return h??null}async function f(a,d){let e=a.schema("core"),f=await (0,b.getGrantScopes)(a);if(0===f.length)return null;let{data:g,error:h}=await e.from("person_access_grants").select("person_id").eq("grantee_user_id",d).in("scope",f).order("granted_at",{ascending:!1}).limit(1).maybeSingle();if(h)throw Error("Unable to resolve access grants right now.");if(!g?.person_id)return null;let{data:i,error:j}=await e.from(c).select("*").eq("id",g.person_id).maybeSingle();if(j)throw Error("Unable to load linked client record.");return i??null}async function g(a,b,c){let e=a.schema("core");await e.from(d).upsert({user_id:b,person_id:c},{onConflict:"user_id"})}async function h(a,b){let c=await e(a,b);if(c)return c;let d=await f(a,b);return d?(await g(a,b,d.id),d):null}async function i(a,b){let c=await h(a,b);if(!c)throw Error("Your profile has not been onboarded to case management yet.");return c}a.s(["findPersonForUser",()=>h,"requirePersonForUser",()=>i])},62722,a=>{"use strict";var b=a.i(9919),c=a.i(10508);let d=new Set(["docs.google.com","drive.google.com","www.youtube.com","youtube.com","youtu.be","player.vimeo.com","vimeo.com","iharc.ca"]);async function e(){let a=await (0,b.createSupabaseRSCClient)(),d=await (0,c.getResourceKinds)(a);return{kinds:(0,c.toOptions)(d)}}function f(a){return(0,c.formatEnumLabel)(a)}let g=`
        id,
        slug,
        title,
        kind,
        summary,
        location,
        date_published,
        tags,
        attachments,
        embed,
        embed_placement,
        body_html,
        is_published,
        cover_image,
        created_by_profile_id,
        updated_by_profile_id,
        created_at,
        updated_at
      `;async function h(a={},c={}){var d;let e,f=(d=a,(e={q:d.q?.toString().trim()||null,kind:d.kind??null,tag:d.tag?.toString().trim()||null,year:d.year?.toString().trim()||null}).year&&!/^\d{4}$/.test(e.year)&&(e.year=null),e.tag&&(e.tag=e.tag.toLowerCase()),e),{page:i,pageSize:j,from:k,to:m}=function(a={}){let b=Math.max(1,a.page??1),c=Math.min(Math.max(a.pageSize??50,1),200),d=(b-1)*c;return{page:b,pageSize:c,from:d,to:d+c-1}}(c),n=(await (0,b.createSupabaseRSCClient)()).schema("portal").from("resource_pages").select(g,{count:"exact"}).order("date_published",{ascending:!1}).order("created_at",{ascending:!1}).range(k,m);if(c.includeUnpublished||(n=n.eq("is_published",!0)),f.kind&&(n=n.eq("kind",f.kind)),f.tag&&(n=n.contains("tags",[f.tag])),f.year){let a=`${f.year}-01-01`,b=`${Number(f.year)+1}-01-01`;n=n.gte("date_published",a).lt("date_published",b)}if(f.q){let a=`%${f.q}%`;n=n.or(["title.ilike."+a,"summary.ilike."+a,"location.ilike."+a].join(","))}let{data:o,error:p,count:q}=await n;if(p)throw p;let r=(o??[]).map(l),s="number"==typeof q?q:r.length,t=s>m+1;return{items:r,total:s,page:i,pageSize:j,hasMore:t}}async function i(a,c={}){let d=(await (0,b.createSupabaseRSCClient)()).schema("portal").from("resource_pages").select(g).eq("slug",a).limit(1);c.includeUnpublished||(d=d.eq("is_published",!0));let{data:e,error:f}=await d.maybeSingle();if(f){if("PGRST116"===f.code)return null;throw f}return e?l(e):null}function j(a,b){if(!function(a){try{let b=a instanceof URL?a:new URL(a);if("https:"!==b.protocol.toLowerCase())return!1;let c=b.hostname.toLowerCase();return d.has(c)}catch{return!1}}(a))throw Error(`Blocked embed host for ${b}`);return a}function k(a){return a.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,80)}function l(a){var b;return{id:a.id,slug:a.slug,title:a.title,kind:a.kind,datePublished:a.date_published,summary:a.summary,location:a.location,tags:Array.isArray(a.tags)?a.tags:[],attachments:Array.isArray(b=a.attachments)?b.map(a=>{if(!a||"object"!=typeof a||Array.isArray(a))return null;let b="label"in a?String(a.label):"",c="url"in a?String(a.url):"";return b&&c?{label:b,url:c}:null}).filter(a=>!!a):[],embed:function(a){if(!a||"object"!=typeof a||Array.isArray(a))return null;let b="type"in a?String(a.type):null;if(!b)return null;switch(b){case"google-doc":case"pdf":{let c="url"in a&&"string"==typeof a.url?a.url:null;if(!c)return null;return{type:b,url:c}}case"video":{let c="url"in a&&"string"==typeof a.url?a.url:null,d="provider"in a&&("youtube"===a.provider||"vimeo"===a.provider)?a.provider:null;if(!c||!d)return null;return{type:b,url:c,provider:d}}case"external":{let c="url"in a&&"string"==typeof a.url?a.url:null;if(!c)return null;return{type:b,url:c,label:"label"in a&&"string"==typeof a.label?a.label:void 0}}case"html":{let c="html"in a&&"string"==typeof a.html?a.html:null;if(!c)return null;return{type:b,html:c}}default:return null}}(a.embed),embedPlacement:a.embed_placement??"above",bodyHtml:a.body_html??"",isPublished:a.is_published,coverImage:a.cover_image,createdAt:a.created_at,updatedAt:a.updated_at}}a.s(["ALLOWED_EMBED_HOSTS",0,d,"assertAllowedEmbedUrl",()=>j,"fetchResourceEnumOptions",()=>e,"formatResourceKindLabel",()=>f,"getResourceBySlug",()=>i,"listResources",()=>h,"normalizeResourceSlug",()=>k])},59972,a=>{"use strict";let b="core";async function c(a,c){let d=a.schema(b),{data:e,error:f}=await d.rpc("staff_caseload",{staff_uuid:c});if(f)throw console.error("Failed to load staff caseload",f),Error("Unable to load caseload right now.");return(e??[]).map(a=>({id:String(a.person_id),clientName:a.client_name??"Client",status:a.status??"active",nextStep:a.next_step??null,nextAt:a.next_at?String(a.next_at):null}))}async function d(a,c){let d=a.schema(b),{data:e,error:f}=await d.rpc("staff_shifts_today",{staff_uuid:c});if(f)throw console.error("Failed to load staff shifts",f),Error("Unable to load todayâ€™s shifts right now.");return(e??[]).map(a=>({id:String(a.id),title:a.title??"Shift",location:a.location??"Location pending",startsAt:a.starts_at??"",endsAt:a.ends_at??""}))}async function e(a,c,d=20){let f=a.schema(b),{data:g,error:h}=await f.rpc("staff_outreach_logs",{staff_uuid:c,limit_rows:d});if(h)throw console.error("Failed to load staff outreach logs",h),Error("Unable to load outreach logs right now.");return(g??[]).map(a=>({id:String(a.id),title:a.title??"Outreach interaction",summary:a.summary??null,location:a.location??null,occurredAt:a.occurred_at??""}))}a.s(["fetchOutreachLogs",()=>e,"fetchStaffCaseload",()=>c,"fetchStaffShifts",()=>d])},47280,a=>{"use strict";let b=`
  id, title, description, status, requested_window, occurs_at, duration_minutes, location, location_type, meeting_url,
  client_profile_id, requester_profile_id, staff_profile_id, organization_id, confirmed_at, confirmed_by_profile_id,
  canceled_at, cancellation_reason, reschedule_note, outcome_notes, created_at, updated_at,
  client:client_profile_id ( id, display_name, organization_id ),
  requester:requester_profile_id ( id, display_name ),
  staff:staff_profile_id ( id, display_name )
`;function c(a){let b=["requested","pending_confirmation","reschedule_requested","scheduled"],c=["completed","cancelled_by_client","cancelled_by_staff","no_show"],d=[],e=[];for(let f of a){if(b.includes(f.status)){d.push(f);continue}if(c.includes(f.status)){e.push(f);continue}d.push(f)}return{upcoming:d.sort((a,b)=>{let c=a.occurs_at?Date.parse(a.occurs_at):Number.MAX_SAFE_INTEGER,d=b.occurs_at?Date.parse(b.occurs_at):Number.MAX_SAFE_INTEGER;return c===d?Date.parse(a.created_at)-Date.parse(b.created_at):c-d}),past:e.sort((a,b)=>Date.parse(b.created_at)-Date.parse(a.created_at))}}async function d(a,d){let{data:e,error:f}=await a.schema("portal").from("appointments").select(b).or(`client_profile_id.eq.${d},requester_profile_id.eq.${d}`).order("occurs_at",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!1});if(f)throw console.error("Failed to load client appointments",{profileId:d,error:f}),Error("Unable to load your appointments right now.");return c(e??[])}async function e(a,d,f={}){let g=[];d.canAccessAdminWorkspace||(d.canAccessOrgWorkspace&&d.organizationId?g.push(`organization_id.eq.${d.organizationId}`):d.canAccessStaffWorkspace?(g.push(`staff_profile_id.eq.${d.profile.id}`),d.organizationId&&g.push(`organization_id.eq.${d.organizationId}`)):g.push(`client_profile_id.eq.${d.profile.id}`));let h=a.schema("portal").from("appointments").select(b).order("occurs_at",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!1});g.length>0&&h.or(g.join(",")),f.limit&&h.limit(f.limit),f.includeCompleted||h.neq("status","completed");let{data:i,error:j}=await h;if(j)throw console.error("Failed to load scoped appointments",{userId:d.userId,options:f,error:j}),Error("Unable to load appointments.");return c(i??[])}a.s(["fetchClientAppointments",()=>d,"fetchScopedAppointments",()=>e])},54504,a=>{"use strict";async function b(a,b){let c=new Map;if(!b.length)return c;let{data:d,error:e}=await a.schema("core").from("user_roles").select("user_id, roles:roles!inner(name)").in("user_id",b);if(e)throw e;return(d??[]).forEach(a=>{let b=a.roles?.name;if(!b)return;let d=c.get(a.user_id)??[];d.push(b),c.set(a.user_id,d)}),c}async function c(a,c){let d=a.schema("portal"),{data:e,error:f}=await d.from("profiles").select("id, user_id, display_name, position_title, organization_id, last_seen_at, affiliation_status").eq("organization_id",c).order("display_name");if(f)throw f;let g=e??[],h=g.map(a=>a.user_id).filter(a=>!!a),i=await b(a,h);return g.map(a=>({...a,portal_roles:i.get(a.user_id??"")??[]}))}async function d(a,b,c=50){let e=a.schema("portal"),{data:f,error:g}=await e.from("profile_invites").select("id, email, display_name, status, created_at, position_title, invited_by_profile_id").eq("organization_id",b).order("created_at",{ascending:!1}).limit(c);if(g)throw g;return f??[]}a.s(["fetchOrgInvites",()=>d,"fetchOrgMembersWithRoles",()=>c])},18877,a=>{"use strict";var b=a.i(5246);a.i(70396);var c=a.i(73727),d=a.i(9919),e=a.i(65108),f=a.i(28215),g=a.i(46592);async function h(){let a=await (0,b.headers)(),h=(0,f.normalizePathFromHeader)(a.get("x-invoke-path")??a.get("next-url"),"/"),i=await (0,d.createSupabaseRSCClient)(),j=await (0,e.loadPortalAccess)(i);if(!j){let a=encodeURIComponent(h.path||"/home");(0,c.redirect)(`/login?next=${a}`)}let k=(0,g.resolveDefaultWorkspace)(j).href,l=h.pathname&&"/"!==h.pathname?h.pathname:k,m=h.path&&"/"!==h.path?h.path:k;return{portalAccess:j,defaultWorkspacePath:k,activeWorkspace:(0,g.inferWorkspaceFromPath)(l),currentPathname:l,currentPath:m,supabase:i}}a.s(["getPortalRequestContext",()=>h])},71029,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},16426,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"warnOnce",{enumerable:!0,get:function(){return d}});let d=a=>{}},1359,(a,b,c)=>{"use strict";function d({widthInt:a,heightInt:b,blurWidth:c,blurHeight:d,blurDataURL:e,objectFit:f}){let g=c?40*c:a,h=d?40*d:b,i=g&&h?`viewBox='0 0 ${g} ${h}'`:"";return`%3Csvg xmlns='http://www.w3.org/2000/svg' ${i}%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3CfeColorMatrix values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1' result='s'/%3E%3CfeFlood x='0' y='0' width='100%25' height='100%25'/%3E%3CfeComposite operator='out' in='s'/%3E%3CfeComposite in2='SourceGraphic'/%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage width='100%25' height='100%25' x='0' y='0' preserveAspectRatio='${i?"none":"contain"===f?"xMidYMid":"cover"===f?"xMidYMid slice":"none"}' style='filter: url(%23b);' href='${e}'/%3E%3C/svg%3E`}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"getImageBlurSvg",{enumerable:!0,get:function(){return d}})},53549,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={VALID_LOADERS:function(){return f},imageConfigDefault:function(){return g}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=["default","imgix","cloudinary","akamai","custom"],g={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:14400,formats:["image/webp"],maximumRedirects:3,dangerouslyAllowLocalIP:!1,dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:[75],unoptimized:!1}},87713,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"getImgProps",{enumerable:!0,get:function(){return i}}),a.r(16426);let d=a.r(1359),e=a.r(53549),f=["-moz-initial","fill","none","scale-down",void 0];function g(a){return void 0!==a.default}function h(a){return void 0===a?a:"number"==typeof a?Number.isFinite(a)?a:NaN:"string"==typeof a&&/^[0-9]+$/.test(a)?parseInt(a,10):NaN}function i({src:a,sizes:b,unoptimized:c=!1,priority:i=!1,preload:j=!1,loading:k,className:l,quality:m,width:n,height:o,fill:p=!1,style:q,overrideSrc:r,onLoad:s,onLoadingComplete:t,placeholder:u="empty",blurDataURL:v,fetchPriority:w,decoding:x="async",layout:y,objectFit:z,objectPosition:A,lazyBoundary:B,lazyRoot:C,...D},E){var F;let G,H,I,{imgConf:J,showAltText:K,blurComplete:L,defaultLoader:M}=E,N=J||e.imageConfigDefault;if("allSizes"in N)G=N;else{let a=[...N.deviceSizes,...N.imageSizes].sort((a,b)=>a-b),b=N.deviceSizes.sort((a,b)=>a-b),c=N.qualities?.sort((a,b)=>a-b);G={...N,allSizes:a,deviceSizes:b,qualities:c}}if(void 0===M)throw Object.defineProperty(Error("images.loaderFile detected but the file is missing default export.\nRead more: https://nextjs.org/docs/messages/invalid-images-config"),"__NEXT_ERROR_CODE",{value:"E163",enumerable:!1,configurable:!0});let O=D.loader||M;delete D.loader,delete D.srcSet;let P="__next_img_default"in O;if(P){if("custom"===G.loader)throw Object.defineProperty(Error(`Image with src "${a}" is missing "loader" prop.
Read more: https://nextjs.org/docs/messages/next-image-missing-loader`),"__NEXT_ERROR_CODE",{value:"E252",enumerable:!1,configurable:!0})}else{let a=O;O=b=>{let{config:c,...d}=b;return a(d)}}if(y){"fill"===y&&(p=!0);let a={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}}[y];a&&(q={...q,...a});let c={responsive:"100vw",fill:"100vw"}[y];c&&!b&&(b=c)}let Q="",R=h(n),S=h(o);if((F=a)&&"object"==typeof F&&(g(F)||void 0!==F.src)){let b=g(a)?a.default:a;if(!b.src)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received ${JSON.stringify(b)}`),"__NEXT_ERROR_CODE",{value:"E460",enumerable:!1,configurable:!0});if(!b.height||!b.width)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received ${JSON.stringify(b)}`),"__NEXT_ERROR_CODE",{value:"E48",enumerable:!1,configurable:!0});if(H=b.blurWidth,I=b.blurHeight,v=v||b.blurDataURL,Q=b.src,!p)if(R||S){if(R&&!S){let a=R/b.width;S=Math.round(b.height*a)}else if(!R&&S){let a=S/b.height;R=Math.round(b.width*a)}}else R=b.width,S=b.height}let T=!i&&!j&&("lazy"===k||void 0===k);(!(a="string"==typeof a?a:Q)||a.startsWith("data:")||a.startsWith("blob:"))&&(c=!0,T=!1),G.unoptimized&&(c=!0),P&&!G.dangerouslyAllowSVG&&a.split("?",1)[0].endsWith(".svg")&&(c=!0);let U=h(m),V=Object.assign(p?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:z,objectPosition:A}:{},K?{}:{color:"transparent"},q),W=L||"empty"===u?null:"blur"===u?`url("data:image/svg+xml;charset=utf-8,${(0,d.getImageBlurSvg)({widthInt:R,heightInt:S,blurWidth:H,blurHeight:I,blurDataURL:v||"",objectFit:V.objectFit})}")`:`url("${u}")`,X=f.includes(V.objectFit)?"fill"===V.objectFit?"100% 100%":"cover":V.objectFit,Y=W?{backgroundSize:X,backgroundPosition:V.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:W}:{},Z=function({config:a,src:b,unoptimized:c,width:d,quality:e,sizes:f,loader:g}){if(c)return{src:b,srcSet:void 0,sizes:void 0};let{widths:h,kind:i}=function({deviceSizes:a,allSizes:b},c,d){if(d){let c=/(^|\s)(1?\d?\d)vw/g,e=[];for(let a;a=c.exec(d);)e.push(parseInt(a[2]));if(e.length){let c=.01*Math.min(...e);return{widths:b.filter(b=>b>=a[0]*c),kind:"w"}}return{widths:b,kind:"w"}}return"number"!=typeof c?{widths:a,kind:"w"}:{widths:[...new Set([c,2*c].map(a=>b.find(b=>b>=a)||b[b.length-1]))],kind:"x"}}(a,d,f),j=h.length-1;return{sizes:f||"w"!==i?f:"100vw",srcSet:h.map((c,d)=>`${g({config:a,src:b,quality:e,width:c})} ${"w"===i?c:d+1}${i}`).join(", "),src:g({config:a,src:b,quality:e,width:h[j]})}}({config:G,src:a,unoptimized:c,width:R,quality:U,sizes:b,loader:O}),$=T?"lazy":k;return{props:{...D,loading:$,fetchPriority:w,width:R,height:S,decoding:x,className:l,style:{...V,...Y},sizes:Z.sizes,srcSet:Z.srcSet,src:r||Z.src},meta:{unoptimized:c,preload:j||i,placeholder:u,fill:p}}}},42377,(a,b,c)=>{let{createClientModuleProxy:d}=a.r(11857);a.n(d("[project]/node_modules/next/dist/client/image-component.js <module evaluation>"))},43489,(a,b,c)=>{let{createClientModuleProxy:d}=a.r(11857);a.n(d("[project]/node_modules/next/dist/client/image-component.js"))},18409,a=>{"use strict";a.i(42377);var b=a.i(43489);a.n(b)},53200,(a,b,c)=>{"use strict";function d(a,b){let c=a||75;return b?.qualities?.length?b.qualities.reduce((a,b)=>Math.abs(b-c)<Math.abs(a-c)?b:a,0):c}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"findClosestQuality",{enumerable:!0,get:function(){return d}})},37763,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return f}});let d=a.r(53200);function e({config:a,src:b,width:c,quality:e}){if(b.startsWith("/")&&b.includes("?")&&a.localPatterns?.length===1&&"**"===a.localPatterns[0].pathname&&""===a.localPatterns[0].search)throw Object.defineProperty(Error(`Image with src "${b}" is using a query string which is not configured in images.localPatterns.
Read more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns`),"__NEXT_ERROR_CODE",{value:"E871",enumerable:!1,configurable:!0});let f=(0,d.findClosestQuality)(e,a);return`${a.path}?url=${encodeURIComponent(b)}&w=${c}&q=${f}${b.startsWith("/_next/static/media/"),""}`}e.__next_img_default=!0;let f=e},50858,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return k},getImageProps:function(){return j}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(71029),g=a.r(87713),h=a.r(18409),i=f._(a.r(37763));function j(a){let{props:b}=(0,g.getImgProps)(a,{defaultLoader:i.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[a,c]of Object.entries(b))void 0===c&&delete b[a];return{props:b}}let k=h.Image},3236,(a,b,c)=>{b.exports=a.r(50858)},73934,a=>{"use strict";var b=a.i(9919);let c="portal-attachments";async function d(a){let d=await (0,b.createSupabaseRSCClient)();try{let{data:b,error:e}=await d.storage.from(c).list(a,{limit:50,sortBy:{column:"created_at",order:"desc"}});if(e)return console.warn("Unable to list client documents",e),[];let f=[];for(let e of b??[]){let b=`${a}/${e.name}`,g=function(a){if(!a)return null;let b=a.expires_at||a.expiresAt;return b&&"string"==typeof b?b:null}(e.metadata??null),h=e.metadata?.category??function(a){let b=a.toLowerCase();return b.includes("id")||b.includes("passport")||b.includes("license")?"identity":b.includes("health")||b.includes("med")||b.includes("clinic")?"health":b.includes("lease")||b.includes("housing")?"housing":null}(e.name),i=e.metadata?.shared_by??null,j=e.metadata?.last_viewed_at??null,k=null;try{let{data:a}=await d.storage.from(c).createSignedUrl(b,1800);k=a?.signedUrl??null}catch(a){console.warn("Failed to create signed URL for document",b,a)}f.push({path:b,name:e.name,signedUrl:k,lastModified:e.updated_at??e.created_at??null,size:e.size??null,category:h??null,expiresAt:g,sharedBy:i,lastViewedAt:j})}return f}catch(a){return console.warn("Failed to load client documents",a),[]}}a.s(["listClientDocuments",()=>d])}];

//# sourceMappingURL=_34d8cd18._.js.map