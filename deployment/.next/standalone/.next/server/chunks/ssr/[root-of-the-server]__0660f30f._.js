module.exports=[42145,3071,a=>{"use strict";let b="Member of the public";function c(a){return!!(a&&"object"==typeof a&&"message"in a&&"string"==typeof a.message)}function d(a,b){return"42501"===b.code?Error("You do not have permission to modify this profile. Contact a moderator for support."):Error("We could not load your profile right now. Please try again.")}async function e(a,e,f){let g=a.schema("portal"),h=async()=>{let{data:a,error:b}=await g.from("profiles").select("*").eq("user_id",e).maybeSingle();if(b){if(c(b)&&"406"===b.code)throw Error("Multiple profiles are linked to this account. Please contact an administrator to resolve the duplicate profile before continuing.");if(c(b))throw d("fetch your profile",b);throw b}return a??null},i=async b=>{try{await a.rpc("refresh_user_permissions",{user_uuid:b})}catch(a){}},j=async a=>{if(a.position_title||"community_member"!==a.affiliation_type)return a;let{data:c,error:d}=await g.from("profiles").update({position_title:b}).eq("id",a.id).select("*").maybeSingle();return d?a:c??a},k=await h();if(k)return k.user_id&&await i(k.user_id),j(k);let{count:l,error:m}=await g.from("profiles").select("id",{count:"exact",head:!0}).eq("user_id",e);if(m){if(c(m))throw d("check your profile",m);throw m}if((l??0)>0)throw Error("Multiple profiles are linked to this account. Please contact an administrator to resolve the duplicate profile before continuing.");let n=f?.affiliation_type??"community_member",o="community_member"===n,p=f?.affiliation_status??(o?"approved":"pending"),q=f?.affiliation_requested_at??("pending"===p?new Date().toISOString():null),r=f?.position_title??(o?b:null),s=f?.homelessness_experience??"none",t=f?.substance_use_experience??"none",u={user_id:e,display_name:f?.display_name??"Community Member",organization_id:f?.organization_id??null,rules_acknowledged_at:f?.rules_acknowledged_at??null,position_title:r,affiliation_type:n,affiliation_status:p,affiliation_requested_at:q,affiliation_reviewed_at:f?.affiliation_reviewed_at??null,affiliation_reviewed_by:f?.affiliation_reviewed_by??null,bio:f?.bio??null,avatar_url:f?.avatar_url??null,homelessness_experience:s,substance_use_experience:t,government_role_type:f?.government_role_type??null,requested_organization_name:f?.requested_organization_name??null,requested_government_name:f?.requested_government_name??null,requested_government_level:f?.requested_government_level??null,requested_government_role:f?.requested_government_role??null},{data:v,error:w}=await g.from("profiles").insert(u).select("*").single();if(w){if(c(w)&&"23505"===w.code){let a=await h();if(a)return j(a)}if(c(w)&&"406"===w.code)throw Error("Multiple profiles are linked to this account. Please contact an administrator to resolve the duplicate profile before continuing.");if(c(w))throw d("create your profile",w);throw w}return await i(e),j(v)}async function f(a,b){let{data:c,error:d}=await a.rpc("portal_get_user_email",{p_profile_id:b});if(d)throw d;return c??null}a.s(["NEW_ORGANIZATION_VALUE",0,"__new_org__","NO_ORGANIZATION_VALUE",0,"__none__","PUBLIC_MEMBER_ROLE_LABEL",0,b],3071),a.s(["ensurePortalProfile",()=>e,"getUserEmailForProfile",()=>f],42145)},37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},16349,a=>{"use strict";var b=a.i(5246);a.i(42537);var c=a.i(5860),d=a.i(31507);async function e(){let{url:a,anonKey:e}=(0,d.getSupabaseEnv)(),f=await (0,b.cookies)();return(0,c.createServerClient)(a,e,{cookies:{getAll:()=>f.getAll(),setAll(a){a.forEach(({name:a,value:b,options:c})=>{try{f.set(a,b,{path:"/",sameSite:"lax",httpOnly:!0,secure:!0,...c})}catch(a){}})}}})}a.s(["createSupabaseServerClient",()=>e])},6687,a=>{"use strict";function b(a){if("string"!=typeof a)return;let b=a.trim();if(!b)return;let c=b.startsWith("+"),d=b.replace(/\D+/g,"");if(d){if(c)return`+${d}`;if(10===d.length)return`+1${d}`;if(d.length>10)return`+${d}`}}function c(a){let c=b(a);if(!c)return"";let d=c.slice(-4),e=c.slice(0,Math.max(2,c.length-4)).replace(/\d/g,"*");return`${e}${d}`}a.s(["maskPhoneNumber",()=>c,"normalizePhoneNumber",()=>b])},9307,a=>{"use strict";function b(a,c="/home"){if(!a)return c;let d=Array.isArray(a)?a[0]:a;return!d||!d.startsWith("/")||d.startsWith("//")?c:d}function c(a){if(!a)return null;let b=Array.isArray(a)?a[0]:a;return"google_auth_cancelled"===b||"google_auth_error"===b?b:null}a.s(["parseAuthErrorCode",()=>c,"resolveNextPath",()=>b])},66680,(a,b,c)=>{b.exports=a.x("node:crypto",()=>require("node:crypto"))},82465,a=>{"use strict";var b=a.i(66680);let c="0123456789";function d(a=8){if(a<=0)throw Error("Portal code length must be greater than zero");let e="";for(let d=0;d<a;d+=1){let a=b.default.randomInt(0,c.length);e+=c[a]}return e}function e(a){if(!a)return null;let b=a.replace(/[^0-9A-Za-z]/g,"").toUpperCase();return b.length<=4?b:8===b.length?`${b.slice(0,4)}-${b.slice(4)}`:9===b.length?`${b.slice(0,3)}-${b.slice(3,6)}-${b.slice(6)}`:b}function f(a){if("string"!=typeof a)return null;let b=a.trim();return 0===b.length?null:b}function g(a){if(!a)return null;let b=a.replace(/[^0-9A-Za-z]/g,"").toUpperCase();return b?6===b.length?`${b.slice(0,3)} ${b.slice(3)}`:b:null}a.s(["emptyToNull",()=>f,"formatPortalCode",()=>e,"generatePortalCode",()=>d,"normalizePostalCode",()=>g])},37199,a=>{"use strict";var b=a.i(7997),c=a.i(39138);let d={"form-sm":"max-w-form-sm","form-md":"max-w-form-md","form-lg":"max-w-form-lg",xl:"max-w-page",page:"max-w-page"};function e({children:a,eyebrow:e,title:f,description:g,actions:h,maxWidth:i="form-lg",align:j="start",spacing:k="lg"}){let l="center"===j?"max-w-2xl":"max-w-3xl",m=!!(e||f||g||h);return(0,b.jsx)("div",{className:"page-shell",children:(0,b.jsxs)("div",{className:(0,c.cn)("mx-auto flex w-full flex-col","md"===k?"gap-space-lg":"gap-space-xl",d[i]),children:[m?(0,b.jsxs)("header",{className:(0,c.cn)("flex w-full flex-col gap-space-xs","center"===j?"items-center text-center":"items-start text-left"),children:[e?(0,b.jsx)("p",{className:"text-label-sm font-medium uppercase text-muted-foreground",children:e}):null,f?(0,b.jsx)("h1",{className:(0,c.cn)("text-headline-lg text-on-surface sm:text-display-sm",l),children:f}):null,g?"string"==typeof g?(0,b.jsx)("p",{className:(0,c.cn)("text-body-md text-muted-foreground sm:text-body-lg",l),children:g}):(0,b.jsx)("div",{className:(0,c.cn)("text-body-md text-muted-foreground sm:text-body-lg",l),children:g}):null,h?(0,b.jsx)("div",{className:"flex flex-wrap gap-space-sm pt-space-sm",children:h}):null]}):null,a]})})}a.s(["FormPageShell",()=>e])},87702,a=>{"use strict";var b=a.i(11857);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call VOLUNTEER_APPLICATION_INITIAL_STATE() from the server but VOLUNTEER_APPLICATION_INITIAL_STATE is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/register/_components/volunteer-application-form.tsx <module evaluation>","VOLUNTEER_APPLICATION_INITIAL_STATE"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call VolunteerApplicationForm() from the server but VolunteerApplicationForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/register/_components/volunteer-application-form.tsx <module evaluation>","VolunteerApplicationForm");a.s(["VOLUNTEER_APPLICATION_INITIAL_STATE",0,c,"VolunteerApplicationForm",0,d])},79850,a=>{"use strict";var b=a.i(11857);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call VOLUNTEER_APPLICATION_INITIAL_STATE() from the server but VOLUNTEER_APPLICATION_INITIAL_STATE is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/register/_components/volunteer-application-form.tsx","VOLUNTEER_APPLICATION_INITIAL_STATE"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call VolunteerApplicationForm() from the server but VolunteerApplicationForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/register/_components/volunteer-application-form.tsx","VolunteerApplicationForm");a.s(["VOLUNTEER_APPLICATION_INITIAL_STATE",0,c,"VolunteerApplicationForm",0,d])},47239,a=>{"use strict";a.i(87702);var b=a.i(79850);a.n(b)},64547,a=>{"use strict";var b=a.i(7997),c=a.i(37936);a.i(70396);var d=a.i(73727),e=a.i(47239),f=a.i(9307),g=a.i(82465),h=a.i(9919),i=a.i(16349),j=a.i(42145),k=a.i(6687),l=a.i(37199);let m=async function(a,b){let c=(0,g.emptyToNull)(b.get("full_name"))??"",e=(0,g.emptyToNull)(b.get("pronouns")),h=(0,g.emptyToNull)(b.get("email")?.toLowerCase()??null),l=(0,g.emptyToNull)(b.get("phone")),m=l?(0,k.normalizePhoneNumber)(l)??null:null,n=(0,g.emptyToNull)(b.get("interests"))??"",o=(0,g.emptyToNull)(b.get("availability")),p=b.get("password")??"",q=b.get("password_confirm")??"",r="on"===b.get("consent_privacy"),s="on"===b.get("consent_terms"),t="on"===b.get("consent_screening");if(!c||c.length<2)return{status:"idle",error:"Share your name so we know who is offering to help."};if(!h)return{status:"idle",error:"Enter an email address so we can send volunteer onboarding details."};if(!n||n.length<10)return{status:"idle",error:"Let us know how you would like to help. A few words are fine."};if(!p||p.length<12)return{status:"idle",error:"Create a password with at least 12 characters."};if(p!==q)return{status:"idle",error:"Confirm that both password entries match."};if(!r||!s||!t)return{status:"idle",error:"Confirm the volunteer privacy and screening expectations before submitting your application."};let u=await (0,i.createSupabaseServerClient)(),v=null,w=null,x=!1;try{let{data:a,error:b}=await u.auth.signUp({email:h,password:p,options:{emailRedirectTo:"https://stevi.iharc.ca/login",data:{display_name:c}}});if(b)return{status:"idle",error:b.message??"We could not create your account right now."};v=a.user?.id??null,x=!!a.session}catch(a){if(a instanceof Error)return{status:"idle",error:a.message};return{status:"idle",error:"We could not create your account right now."}}if(!v)return{status:"idle",error:"We could not create your account right now. Try again later."};if(x)try{w=(await (0,j.ensurePortalProfile)(u,v,{display_name:c,affiliation_type:"community_member",position_title:"Volunteer applicant"})).id}catch(a){console.warn("Unable to ensure volunteer profile during registration",a)}let y=u.schema("portal"),{error:z}=await y.from("registration_flows").insert({flow_type:"volunteer_application",status:"pending",chosen_name:c,contact_email:h,contact_phone:m,consent_data_sharing:r,consent_contact:!0,consent_terms:s,metadata:{pronouns:e,interests:n,availability:o,consent_screening:t},supabase_user_id:v,profile_id:w});if(z&&console.error("Failed to store volunteer application",z),x&&w){let a=b.get("next"),c=(0,f.resolveNextPath)("string"==typeof a?a:void 0);(0,d.redirect)(c)}return{status:"success",message:"Thanks for offering to help. Check your email for confirmation and weâ€™ll follow up about screening, training, and shifts."}};async function n({searchParams:a}){let c=a?await a:void 0,g=(0,f.resolveNextPath)(c?.next),i=await (0,h.createSupabaseRSCClient)(),{data:{user:j}}=await i.auth.getUser();return j&&(0,d.redirect)(g),(0,b.jsx)(l.FormPageShell,{maxWidth:"form-lg",children:(0,b.jsx)(e.VolunteerApplicationForm,{action:m,initialState:e.VOLUNTEER_APPLICATION_INITIAL_STATE,nextPath:g})})}(0,c.registerServerReference)(m,"60f70b21a9091cec3d046b81660196c113f94efc8c",null),a.s(["$$RSC_SERVER_ACTION_0",0,m,"default",()=>n,"dynamic",0,"force-dynamic"])},71268,a=>{"use strict";var b=a.i(64547);a.s([],95100),a.i(95100),a.s(["60f70b21a9091cec3d046b81660196c113f94efc8c",()=>b.$$RSC_SERVER_ACTION_0],71268)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__0660f30f._.js.map