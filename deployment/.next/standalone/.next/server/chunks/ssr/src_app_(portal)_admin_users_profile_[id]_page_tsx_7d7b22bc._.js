module.exports=[82958,a=>{"use strict";var b=a.i(7997),c=a.i(37936),d=a.i(95936);a.i(70396);var e=a.i(73727),f=a.i(9919),g=a.i(42145),h=a.i(65108),i=a.i(39251),j=a.i(46592),k=a.i(38904),l=a.i(19637),m=a.i(35330),n=a.i(55583),o=a.i(43562),p=a.i(58774),q=a.i(42457),r=a.i(10508);let s=async function(a){let b=await (0,q.updateProfileAction)(a);if(!b.success)throw Error(b.error)};(0,c.registerServerReference)(s,"4015fc30ed331ffb731d198fb76495635334a09491",null);let t=async function(a){let b=await (0,q.toggleRoleAction)(a);if(!b.success)throw Error(b.error)};(0,c.registerServerReference)(t,"4018d19af297f121e9706311986ce2192d72411b04",null);let u=async function(a){let b=await (0,q.archiveUserAction)(a);if(!b.success)throw Error(b.error)};(0,c.registerServerReference)(u,"4061ac7c1b613cace753a835b0a7e6660bd534d8e6",null);let v=async function(a){let b=await (0,q.sendInviteAction)(a);if(!b.success)throw Error(b.error)};async function w({params:a}){let{id:c}=await a,q=await (0,f.createSupabaseRSCClient)(),w=await (0,h.loadPortalAccess)(q);w||(0,e.redirect)(`/login?next=/admin/users/profile/${c}`),w.canAccessAdminWorkspace||(0,e.redirect)((0,j.resolveDefaultWorkspacePath)(w)),await (0,g.ensurePortalProfile)(q,w.userId);let x=await (0,i.fetchAdminUserDetail)(q,c);x||(0,e.redirect)("/admin/users/all");let y=await (0,i.loadProfileEnums)(q),z=await q.schema("core").from("organizations").select("id, name").order("name");if(z.error)throw z.error;let A=(z.data??[]).map(a=>({id:a.id,name:a.name}))??[],B=await (0,r.getPortalRoles)(q),C=!x.profile.user_id;return(0,b.jsxs)("div",{className:"page-shell page-stack",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-space-sm sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("p",{className:"text-label-sm font-medium uppercase text-muted-foreground",children:"Admin · User"}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-space-xs",children:[(0,b.jsx)("h1",{className:"text-headline-lg text-on-surface",children:x.profile.display_name}),(0,b.jsx)(l.Badge,{variant:"approved"===x.profile.affiliation_status?"default":"pending"===x.profile.affiliation_status?"outline":"secondary",children:x.profile.affiliation_status}),x.organization?(0,b.jsx)(l.Badge,{variant:"outline",children:x.organization.name}):null]}),(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:"Manage profile details, portal roles, organization linkage, and review recent audit history."})]}),(0,b.jsx)(k.Button,{asChild:!0,variant:"outline",children:(0,b.jsx)(d.default,{href:"/admin/users/all",children:"Back to list"})})]}),(0,b.jsxs)("div",{className:"grid gap-space-lg lg:grid-cols-3",children:[(0,b.jsxs)(m.Card,{className:"lg:col-span-2 border-outline/20 bg-surface-container",children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Profile & affiliation"}),(0,b.jsx)(m.CardDescription,{children:"Update visible details and organizational context."})]}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("form",{action:s,className:"grid gap-space-md md:grid-cols-2",children:[(0,b.jsx)("input",{type:"hidden",name:"profile_id",value:x.profile.id}),(0,b.jsxs)("div",{className:"space-y-space-2xs md:col-span-2",children:[(0,b.jsx)(o.Label,{htmlFor:"display_name",children:"Display name"}),(0,b.jsx)(n.Input,{id:"display_name",name:"display_name",defaultValue:x.profile.display_name,required:!0})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs md:col-span-2",children:[(0,b.jsx)(o.Label,{htmlFor:"position_title",children:"Title / role"}),(0,b.jsx)(n.Input,{id:"position_title",name:"position_title",defaultValue:x.profile.position_title??"",placeholder:"Case worker, partner lead, etc."})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(o.Label,{htmlFor:"affiliation_type",children:"Affiliation type"}),(0,b.jsx)("select",{id:"affiliation_type",name:"affiliation_type",defaultValue:x.profile.affiliation_type,className:"w-full rounded-lg border border-outline/30 bg-surface px-space-sm py-space-2xs text-body-sm",children:y.affiliationTypes.map(a=>(0,b.jsx)("option",{value:a,children:(0,r.formatEnumLabel)(a.replace("_"," "))},a))})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(o.Label,{htmlFor:"affiliation_status",children:"Status"}),(0,b.jsx)("select",{id:"affiliation_status",name:"affiliation_status",defaultValue:x.profile.affiliation_status,className:"w-full rounded-lg border border-outline/30 bg-surface px-space-sm py-space-2xs text-body-sm",children:y.affiliationStatuses.map(a=>(0,b.jsx)("option",{value:a,children:(0,r.formatEnumLabel)(a)},a))})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(o.Label,{htmlFor:"organization_id",children:"Organization"}),(0,b.jsxs)("select",{id:"organization_id",name:"organization_id",defaultValue:x.organization?.id??"",className:"w-full rounded-lg border border-outline/30 bg-surface px-space-sm py-space-2xs text-body-sm",children:[(0,b.jsx)("option",{value:"",children:"No organization"}),A.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(o.Label,{htmlFor:"government_role_type",children:"Government role"}),(0,b.jsxs)("select",{id:"government_role_type",name:"government_role_type",defaultValue:x.profile.government_role_type??"",className:"w-full rounded-lg border border-outline/30 bg-surface px-space-sm py-space-2xs text-body-sm",children:[(0,b.jsx)("option",{value:"",children:"Not applicable"}),y.governmentRoleTypes.map(a=>(0,b.jsx)("option",{value:a,children:(0,r.formatEnumLabel)(a)},a))]})]}),(0,b.jsx)("div",{className:"md:col-span-2 flex justify-end gap-space-xs",children:(0,b.jsx)(k.Button,{type:"submit",children:"Save changes"})})]})})]}),(0,b.jsxs)(m.Card,{className:"border-outline/20 bg-surface-container",children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Portal roles"}),(0,b.jsx)(m.CardDescription,{children:"Grant or revoke portal roles with audit logging."})]}),(0,b.jsx)(m.CardContent,{className:"space-y-space-sm",children:B.map(a=>{let c=x.roles.portal.includes(a),d=(0,r.formatEnumLabel)(a.replace(/^portal_/,""));return(0,b.jsxs)("form",{action:t,className:"flex items-center justify-between gap-space-xs rounded-xl border border-outline/12 px-space-sm py-space-2xs",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-body-md font-medium text-on-surface",children:d}),(0,b.jsxs)("p",{className:"text-label-sm text-muted-foreground",children:["Portal role: ",a]})]}),(0,b.jsx)("input",{type:"hidden",name:"profile_id",value:x.profile.id}),(0,b.jsx)("input",{type:"hidden",name:"role_name",value:a}),(0,b.jsx)("input",{type:"hidden",name:"enable",value:(!c).toString()}),(0,b.jsx)(k.Button,{type:"submit",variant:c?"outline":"secondary",size:"sm",children:c?"Revoke":"Grant"})]},a)})})]})]}),(0,b.jsxs)("div",{className:"grid gap-space-lg lg:grid-cols-3",children:[(0,b.jsxs)(m.Card,{className:"lg:col-span-2 border-outline/20",children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Audit history"}),(0,b.jsx)(m.CardDescription,{children:"Recent actions on this profile."})]}),(0,b.jsx)(m.CardContent,{className:"space-y-space-xs",children:0===x.auditEvents.length?(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No events yet."}):(0,b.jsx)("ul",{className:"space-y-space-xs",children:x.auditEvents.map(a=>(0,b.jsxs)("li",{className:"flex items-center justify-between rounded-xl border border-outline/12 bg-surface-container-low px-space-sm py-space-2xs",children:[(0,b.jsxs)("div",{className:"space-y-[2px]",children:[(0,b.jsx)("p",{className:"text-body-sm font-medium text-on-surface",children:a.action}),(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:new Date(a.createdAt).toLocaleString("en-CA",{dateStyle:"medium",timeStyle:"short"})})]}),a.actorProfileId?(0,b.jsxs)(l.Badge,{variant:"outline",className:"text-label-xs",children:["Actor ",a.actorProfileId.slice(0,6)]}):null]},a.id))})})]}),(0,b.jsxs)("div",{className:"space-y-space-lg",children:[(0,b.jsxs)(m.Card,{className:"border-outline/20",children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Account"}),(0,b.jsx)(m.CardDescription,{children:"Email, Supabase user id, and last seen."})]}),(0,b.jsxs)(m.CardContent,{className:"space-y-space-xs text-body-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Email"}),(0,b.jsx)("span",{className:"text-on-surface",children:x.email??"None"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Supabase user"}),(0,b.jsx)("span",{className:"text-on-surface",children:x.profile.user_id??"Not yet accepted"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Last seen"}),(0,b.jsx)("span",{className:"text-on-surface",children:x.profile.last_seen_at?new Date(x.profile.last_seen_at).toLocaleString("en-CA",{dateStyle:"medium",timeStyle:"short"}):"—"})]})]})]}),C?(0,b.jsxs)(m.Card,{className:"border-outline/20",children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Send invitation"}),(0,b.jsx)(m.CardDescription,{children:"Invite this contact to complete their account."})]}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("form",{action:v,className:"space-y-space-sm",children:[(0,b.jsx)("input",{type:"hidden",name:"invite_display_name",value:x.profile.display_name}),(0,b.jsx)("input",{type:"hidden",name:"invite_position_title",value:x.profile.position_title??""}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(o.Label,{htmlFor:"invite_email",children:"Email"}),(0,b.jsx)(n.Input,{id:"invite_email",name:"invite_email",type:"email",required:!0,defaultValue:x.email??""})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(o.Label,{htmlFor:"invite_affiliation_type",children:"Affiliation"}),(0,b.jsx)("select",{id:"invite_affiliation_type",name:"invite_affiliation_type",defaultValue:x.profile.affiliation_type,className:"w-full rounded-lg border border-outline/30 bg-surface px-space-sm py-space-2xs text-body-sm",children:y.affiliationTypes.map(a=>(0,b.jsx)("option",{value:a,children:(0,r.formatEnumLabel)(a.replace("_"," "))},a))})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(o.Label,{htmlFor:"invite_organization_id",children:"Organization"}),(0,b.jsxs)("select",{id:"invite_organization_id",name:"invite_organization_id",defaultValue:x.organization?.id??"",className:"w-full rounded-lg border border-outline/30 bg-surface px-space-sm py-space-2xs text-body-sm",children:[(0,b.jsx)("option",{value:"",children:"No organization"}),A.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(o.Label,{htmlFor:"invite_message",children:"Message (optional)"}),(0,b.jsx)(p.Textarea,{id:"invite_message",name:"invite_message",placeholder:"Add context or instructions."})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(k.Button,{type:"submit",children:"Send invite"})})]})})]}):null,(0,b.jsxs)(m.Card,{className:"border-destructive/30",children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{className:"text-destructive",children:"Archive user"}),(0,b.jsx)(m.CardDescription,{children:"Revoke access and detach from organization."})]}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("form",{action:u,className:"flex flex-col gap-space-sm",children:[(0,b.jsx)("input",{type:"hidden",name:"profile_id",value:x.profile.id}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["This will set the affiliation to ",(0,b.jsx)("strong",{children:"revoked"}),", clear organization, and remove org roles."]}),(0,b.jsx)(k.Button,{type:"submit",variant:"destructive",children:"Archive user"})]})})]})]})]})]})}(0,c.registerServerReference)(v,"4083303bd117fefe98ec3e5e2558637220420b3c5a",null),a.s(["$$RSC_SERVER_ACTION_0",0,s,"$$RSC_SERVER_ACTION_1",0,t,"$$RSC_SERVER_ACTION_2",0,u,"$$RSC_SERVER_ACTION_3",0,v,"default",()=>w,"dynamic",0,"force-dynamic"])}];

//# sourceMappingURL=src_app_%28portal%29_admin_users_profile_%5Bid%5D_page_tsx_7d7b22bc._.js.map