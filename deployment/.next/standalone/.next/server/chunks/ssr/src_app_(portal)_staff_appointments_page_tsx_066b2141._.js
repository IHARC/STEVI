module.exports=[64929,a=>{"use strict";var b=a.i(7997);a.i(70396);var c=a.i(73727),d=a.i(9919),e=a.i(65108),f=a.i(46592),g=a.i(42145),h=a.i(35330),i=a.i(19637),j=a.i(55583),k=a.i(58774),l=a.i(38904),m=a.i(70444),n=a.i(43535),o=a.i(69815),p=a.i(16974),q=a.i(78270),r=a.i(30475),s=a.i(47280);let t=new Intl.DateTimeFormat("en-CA",{dateStyle:"full",timeStyle:"short"});function u(a){if(!a)return"Not scheduled yet";try{return t.format(new Date(a))}catch{return a}}function v({appointment:a,onConfirm:c,onCancel:d}){let e=(0,o.generateAvailabilitySlots)();return(0,b.jsxs)("form",{action:c,className:"space-y-space-xs rounded-lg border border-outline/30 p-space-sm",children:[(0,b.jsx)("input",{type:"hidden",name:"appointment_id",value:a.id}),(0,b.jsxs)("div",{className:"grid gap-space-xs sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm text-on-surface/80",htmlFor:`occurs-${a.id}`,children:"Date & time"}),(0,b.jsx)(j.Input,{id:`occurs-${a.id}`,name:"occurs_at",type:"datetime-local",required:!0,defaultValue:a.occurs_at?.slice(0,16)})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm text-on-surface/80",htmlFor:`location-${a.id}`,children:"Location / meeting link"}),(0,b.jsx)(j.Input,{id:`location-${a.id}`,name:"location",placeholder:"IHARC Outreach Hub, phone, or meeting link",defaultValue:a.location??""})]})]}),(0,b.jsxs)("div",{className:"grid gap-space-xs sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm text-on-surface/80",htmlFor:`duration-${a.id}`,children:"Duration (minutes)"}),(0,b.jsx)(j.Input,{id:`duration-${a.id}`,name:"duration_minutes",type:"number",min:15,step:15,defaultValue:a.duration_minutes??60})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm text-on-surface/80",htmlFor:`location-type-${a.id}`,children:"Meeting type"}),(0,b.jsxs)(m.Select,{name:"location_type",defaultValue:a.location_type??"in_person",children:[(0,b.jsx)(m.SelectTrigger,{id:`location-type-${a.id}`,children:(0,b.jsx)(m.SelectValue,{placeholder:"Select a type"})}),(0,b.jsxs)(m.SelectContent,{children:[(0,b.jsx)(m.SelectItem,{value:"in_person",children:"In person"}),(0,b.jsx)(m.SelectItem,{value:"phone",children:"Phone"}),(0,b.jsx)(m.SelectItem,{value:"video",children:"Video"}),(0,b.jsx)(m.SelectItem,{value:"field",children:"Field / outreach"}),(0,b.jsx)(m.SelectItem,{value:"other",children:"Other"})]})]})]})]}),(0,b.jsxs)("div",{className:"grid gap-space-xs sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm text-on-surface/80",htmlFor:`meeting-url-${a.id}`,children:"Meeting link / call-back (optional)"}),(0,b.jsx)(j.Input,{id:`meeting-url-${a.id}`,name:"meeting_url",placeholder:"Zoom/Teams link or phone number",defaultValue:a.meeting_url??""})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm text-on-surface/80",htmlFor:`notes-${a.id}`,children:"Notes to client (optional)"}),(0,b.jsx)(k.Textarea,{id:`notes-${a.id}`,name:"notes",rows:2,placeholder:"Add context or prep steps",defaultValue:a.reschedule_note??""})]})]}),(0,b.jsx)(n.AvailabilityPicker,{slots:e,targetInputId:`occurs-${a.id}`}),(0,b.jsx)(q.ProfileSearch,{name:"staff_profile_id",label:"Assign staff (optional)",scope:"staff",defaultValue:a.staff_profile_id??"",placeholder:"Search staff",helperText:"Leave blank to stay assigned to you."}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-space-sm",children:[(0,b.jsx)(l.Button,{type:"submit",size:"sm",children:"Confirm & schedule"}),(0,b.jsx)(p.CancelAppointmentForm,{action:d,appointmentId:a.id,variant:"destructive"})]})]})}function w({appointment:a,onComplete:c}){return(0,b.jsxs)("form",{action:c,className:"flex flex-col gap-space-xs sm:flex-row sm:items-center",children:[(0,b.jsx)("input",{type:"hidden",name:"appointment_id",value:a.id}),(0,b.jsx)(k.Textarea,{name:"outcome_notes",placeholder:"Outcome or follow-up notes",className:"sm:min-w-[240px]",rows:2}),(0,b.jsx)(l.Button,{type:"submit",size:"sm",variant:"secondary",children:"Mark complete"})]})}async function x(){let a=await (0,d.createSupabaseRSCClient)(),k=await (0,e.loadPortalAccess)(a);k&&k.canAccessStaffWorkspace||(0,c.redirect)((0,f.resolveDefaultWorkspacePath)(k)),await (0,g.ensurePortalProfile)(a,k.userId);let{upcoming:t,past:x}=await (0,s.fetchScopedAppointments)(a,k,{includeCompleted:!0}),y=(0,o.generateAvailabilitySlots)(),z=async a=>{await (0,r.confirmAppointment)(a)},A=async a=>{await (0,r.completeAppointment)(a)},B=async a=>{await (0,r.cancelAppointmentAsStaff)(a)},C=async a=>{await (0,r.createOfflineAppointment)(a)},D=t.filter(a=>["requested","pending_confirmation","reschedule_requested"].includes(a.status)),E=t.filter(a=>"scheduled"===a.status);return(0,b.jsxs)("div",{className:"space-y-space-lg",children:[(0,b.jsxs)("header",{className:"space-y-space-2xs",children:[(0,b.jsx)("p",{className:"text-label-sm font-semibold uppercase text-muted-foreground",children:"Appointments"}),(0,b.jsx)("h1",{className:"text-headline-lg text-on-surface",children:"Review and schedule requests"}),(0,b.jsx)("p",{className:"max-w-3xl text-body-md text-muted-foreground",children:"Confirm client requests, book offline appointments, and keep outcomes up to date. This list is scoped to your assignments and organization."})]}),(0,b.jsxs)("div",{className:"grid gap-space-lg lg:grid-cols-2",children:[(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{className:"text-title-lg",children:"Quick offline booking"})}),(0,b.jsx)(h.CardContent,{children:(0,b.jsxs)("form",{action:C,className:"grid gap-space-sm",children:[(0,b.jsxs)("div",{className:"grid gap-space-sm sm:grid-cols-2",children:[(0,b.jsx)(q.ProfileSearch,{name:"client_profile_id",label:"Client",scope:"client",placeholder:"Search clients by name",required:!0}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm text-on-surface/80",htmlFor:"offline-occurs",children:"Date & time (optional)"}),(0,b.jsx)(j.Input,{id:"offline-occurs",name:"occurs_at",type:"datetime-local"})]})]}),(0,b.jsx)(j.Input,{name:"title",placeholder:"Appointment title",required:!0}),(0,b.jsxs)("div",{className:"grid gap-space-sm sm:grid-cols-2",children:[(0,b.jsx)(j.Input,{name:"location",placeholder:"Location or meeting link"}),(0,b.jsx)(j.Input,{name:"duration_minutes",type:"number",min:15,step:15,defaultValue:60})]}),(0,b.jsxs)("div",{className:"grid gap-space-sm sm:grid-cols-2",children:[(0,b.jsxs)(m.Select,{name:"location_type",defaultValue:"in_person",children:[(0,b.jsx)(m.SelectTrigger,{children:(0,b.jsx)(m.SelectValue,{placeholder:"Meeting type"})}),(0,b.jsxs)(m.SelectContent,{children:[(0,b.jsx)(m.SelectItem,{value:"in_person",children:"In person"}),(0,b.jsx)(m.SelectItem,{value:"phone",children:"Phone"}),(0,b.jsx)(m.SelectItem,{value:"video",children:"Video"}),(0,b.jsx)(m.SelectItem,{value:"field",children:"Field / outreach"}),(0,b.jsx)(m.SelectItem,{value:"other",children:"Other"})]})]}),(0,b.jsx)(j.Input,{name:"meeting_url",placeholder:"Meeting link / phone (optional)"})]}),(0,b.jsx)(n.AvailabilityPicker,{slots:y,targetInputId:"offline-occurs",label:"Suggested slots"}),(0,b.jsx)(q.ProfileSearch,{name:"staff_profile_id",label:"Assign staff (optional)",scope:"staff",placeholder:"Search staff",helperText:"Leave blank to assign yourself."}),(0,b.jsx)(l.Button,{type:"submit",className:"w-fit",size:"sm",children:"Create appointment"}),(0,b.jsx)("p",{className:"text-body-xs text-muted-foreground",children:"Use profile IDs from the client directory. Booking without a time will keep the request in pending status."})]})})]}),(0,b.jsxs)(h.Card,{className:"lg:col-span-2",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{className:"text-title-lg",children:"Needs attention"})}),(0,b.jsx)(h.CardContent,{className:"space-y-space-md",children:0===D.length?(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:"No pending requests right now."}):D.map(a=>(0,b.jsxs)("article",{className:"rounded-xl border border-outline/20 bg-surface-container-low p-space-md shadow-level-1","aria-labelledby":`needs-${a.id}`,children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{id:`needs-${a.id}`,className:"text-title-md font-medium text-on-surface",children:a.title}),(0,b.jsxs)("p",{className:"text-body-sm text-muted-foreground",children:[a.client?.display_name??"Client"," · ",a.organization?.name??"IHARC"]})]}),(0,b.jsx)(i.Badge,{variant:"secondary",className:"capitalize",children:a.status.replaceAll("_"," ")})]}),(0,b.jsxs)("dl",{className:"mt-space-xs space-y-[0.3rem] text-body-sm text-on-surface/80",children:[a.requested_window?(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(0,b.jsx)("dt",{className:"font-medium text-on-surface/70",children:"Requested window:"}),(0,b.jsx)("dd",{children:a.requested_window})]}):null,a.description?(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(0,b.jsx)("dt",{className:"font-medium text-on-surface/70",children:"Description:"}),(0,b.jsx)("dd",{children:a.description})]}):null,(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(0,b.jsx)("dt",{className:"font-medium text-on-surface/70",children:"Preferred type:"}),(0,b.jsx)("dd",{children:a.location_type.replaceAll("_"," ")})]})]}),(0,b.jsx)("div",{className:"mt-space-md space-y-space-sm",children:(0,b.jsx)(v,{appointment:a,onConfirm:z,onCancel:B})})]},a.id))})]}),(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{className:"text-title-lg",children:"Scheduled"})}),(0,b.jsx)(h.CardContent,{className:"space-y-space-md",children:0===E.length?(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:"No scheduled appointments."}):E.map(a=>(0,b.jsxs)("article",{className:"rounded-lg border border-outline/20 p-space-md shadow-level-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-title-sm font-semibold text-on-surface",children:a.title}),(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:a.client?.display_name??"Client"})]}),(0,b.jsx)(i.Badge,{className:"capitalize",children:a.status})]}),(0,b.jsx)("p",{className:"mt-space-2xs text-body-sm text-on-surface/80",children:u(a.occurs_at)}),(0,b.jsxs)("p",{className:"text-body-sm text-muted-foreground",children:[a.location??"Location TBD"," · ",a.location_type.replaceAll("_"," ")]}),a.meeting_url?(0,b.jsx)("p",{className:"text-body-sm text-primary",children:(0,b.jsx)("a",{className:"underline-offset-4 hover:underline",href:a.meeting_url,target:"_blank",rel:"noreferrer",children:"Open meeting link"})}):null,(0,b.jsxs)("div",{className:"mt-space-sm flex flex-wrap gap-space-sm",children:[(0,b.jsx)(w,{appointment:a,onComplete:A}),(0,b.jsx)(p.CancelAppointmentForm,{action:B,appointmentId:a.id,variant:"secondary"})]})]},a.id))})]}),(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{className:"text-title-lg",children:"Completed & cancelled"})}),(0,b.jsx)(h.CardContent,{className:"space-y-space-sm",children:0===x.length?(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:"No history yet."}):x.map(a=>(0,b.jsxs)("article",{className:"rounded-md border border-outline/15 bg-surface p-space-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsx)("p",{className:"text-body-md font-medium text-on-surface",children:a.title}),(0,b.jsx)(i.Badge,{variant:"outline",className:"capitalize",children:a.status.replaceAll("_"," ")})]}),(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:u(a.occurs_at)}),a.outcome_notes?(0,b.jsx)("p",{className:"text-body-sm text-on-surface/80",children:a.outcome_notes}):null]},a.id))})]})]})]})}a.s(["default",()=>x,"dynamic",0,"force-dynamic"])}];

//# sourceMappingURL=src_app_%28portal%29_staff_appointments_page_tsx_066b2141._.js.map