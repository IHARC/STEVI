module.exports=[63985,a=>{"use strict";let b="[redacted]",c=["password","token","secret","authorization","cookie","session","otp","code","sin","ssn","birth","dob","email","phone","contact","address"];function d(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return b===Object.prototype||null===b}let e=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,f=/^[0-9]+$/,g=/^[a-z0-9_]+$/i,h=/^[a-zA-Z0-9._:-]+$/;function i(a){if(null==a)return null;let b="number"==typeof a?String(a):a.trim?.()??a;return"string"!=typeof b||0===b.length?null:e.test(b)||f.test(b)?b:b.slice(0,128)}function j(a){let b=i(a);return b&&e.test(b)?b:null}function k(a){if(!a)return null;let{schema:b,table:c,id:d}=a;if(!g.test(b)||!g.test(c))return null;let e=i(d);return e&&h.test(e)?`${b.toLowerCase()}.${c.toLowerCase()}:${e}`:null}async function l(a,{actorProfileId:e=null,action:f,entityType:g,entityRef:h,entityId:i,meta:l}){let m=l&&d(l)?function a(e,f){let g={};return Object.entries(e).forEach(([e,h])=>{let i;if(i=e.toLowerCase(),c.some(a=>i.includes(a))){g[e]=b;return}let j=function c(e,f){if(void 0!==e){if(null===e)return null;if("string"==typeof e)return e.length>1024?`${e.slice(0,1024)}...`:e;if("number"==typeof e||"boolean"==typeof e)return e;if("bigint"==typeof e)return e.toString();if(e instanceof Date)return e.toISOString();if(e instanceof URL)return e.toString();if(e instanceof Error)return{name:e.name,message:e.message};if(Array.isArray(e))return e.map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Set)return Array.from(e).map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Map){let a={};return e.forEach((b,d)=>{let e=c(b,f);void 0!==e&&(a[String(d)]=e)}),a}return"object"==typeof e&&d(e)?f.has(e)?b:(f.add(e),a(e,f)):String(e)}}(h,f);void 0!==j&&(g[e]=j)}),g}(l,new WeakSet):{},n="string"==typeof h?h:k(h),o=j(i);!o&&n&&(o=j(n.split(":").pop()??null));let p=!n||"entity_ref"in m?m:{...m,entity_ref:n},q=j(e),{error:r}=await a.rpc("portal_log_audit_event",{p_action:f,p_entity_type:g,p_entity_id:o,p_meta:p,p_actor_profile_id:q});if(r)throw r}a.s(["buildEntityRef",()=>k,"logAuditEvent",()=>l],63985)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},95798,a=>{"use strict";var b=a.i(9919),c=a.i(52404),d=a.i(10508);async function e(){let a=await (0,b.createSupabaseRSCClient)(),[c,e]=await Promise.all([(0,d.getPolicyCategories)(a),(0,d.getPolicyStatuses)(a)]);return{categories:(0,d.toOptions)(c),statuses:(0,d.toOptions)(e)}}function f(a){return(0,d.formatEnumLabel)(a)}let g=`
  id,
  slug,
  title,
  category,
  short_summary,
  body_html,
  status,
  is_published,
  sort_order,
  last_reviewed_at,
  effective_from,
  effective_to,
  internal_ref,
  created_at,
  updated_at
`;async function h(a={}){let c=(await (0,b.createSupabaseRSCClient)()).schema("portal").from("policies").select(g).order("sort_order",{ascending:!0}).order("title",{ascending:!0});a.includeUnpublished||(c=c.eq("status","published"));let{data:d,error:e}=await c;if(e)throw e;return(d??[]).map(k)}async function i(a,c={}){let d=(await (0,b.createSupabaseRSCClient)()).schema("portal").from("policies").select(g).eq("slug",a).limit(1);c.includeUnpublished||(d=d.eq("status","published"));let{data:e,error:f}=await d.maybeSingle();if(f){if("PGRST116"===f.code)return null;throw f}return e?k(e):null}function j(a){return a.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,80)}function k(a){return{id:a.id,slug:a.slug,title:a.title,category:a.category,shortSummary:a.short_summary,bodyHtml:(0,c.sanitizeResourceHtml)(a.body_html??""),status:a.status,isPublished:!!a.is_published,sortOrder:a.sort_order,lastReviewedAt:a.last_reviewed_at,effectiveFrom:a.effective_from,effectiveTo:a.effective_to,internalRef:a.internal_ref,createdAt:a.created_at,updatedAt:a.updated_at}}a.s(["fetchPolicyEnumOptions",()=>e,"formatPolicyCategoryLabel",()=>f,"getPolicyBySlug",()=>i,"listPolicies",()=>h,"normalizePolicySlug",()=>j])},56287,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(16349),e=a.i(63985),f=a.i(52404),g=a.i(42145),h=a.i(95798),i=a.i(65108),j=a.i(10508);async function k(...a){let b=Array.from(new Set(a.filter(a=>!!a).map(a=>a.trim()).filter(Boolean)));await Promise.all(b.map(a=>(0,c.revalidatePath)(a)))}async function l(){let a=await (0,d.createSupabaseServerClient)(),b=await (0,i.loadPortalAccess)(a);if(!b)throw Error("Sign in to continue.");if(!b.canManagePolicies)throw Error("Admin access is required.");let c=await (0,g.ensurePortalProfile)(a,b.userId);return{supabase:a,portalClient:a.schema("portal"),actorProfile:c}}async function m(a,b){let c=await (0,j.getPolicyStatuses)(a);return b&&c.includes(b)?b:c[0]??"draft"}async function n(a,b){let c=await (0,j.getPolicyCategories)(a);return b&&c.includes(b)?b:c[0]??"governance"}function o(a){if(!a)return null;let b=a.trim();if(!/^\d{4}-\d{2}-\d{2}$/.test(b))throw Error("Dates must use YYYY-MM-DD format.");return b}async function p(a){let{supabase:b,portalClient:c,actorProfile:d}=await l(),g=a.get("title")?.trim()??"";if(!g)throw Error("Add a policy title.");let i=a.get("slug")?.trim()??"",j=(0,h.normalizePolicySlug)(i||g),p=await n(b,a.get("category")?.trim()??null),q=await m(b,a.get("status")?.trim()??"draft"),r=a.get("short_summary")?.trim()??"";if(!r)throw Error("Add a short summary.");let s=a.get("body_html")??"",t=(0,f.sanitizeResourceHtml)(s),u=Number.parseInt(a.get("sort_order")??"100",10)||100,v=o(a.get("last_reviewed_at"))??new Date().toISOString(),w=o(a.get("effective_from")),x=o(a.get("effective_to")),y=a.get("internal_ref")?.trim()||null,{data:z,error:A}=await c.from("policies").insert({slug:j,title:g,category:p,short_summary:r,body_html:t,status:q,sort_order:u,last_reviewed_at:v,effective_from:w,effective_to:x,internal_ref:y,created_by_profile_id:d.id,updated_by_profile_id:d.id}).select("id, slug").maybeSingle();if(A)throw A;await (0,e.logAuditEvent)(b,{actorProfileId:d.id,action:"policy_created",entityType:"policy",entityRef:(0,e.buildEntityRef)({schema:"portal",table:"policies",id:z?.id??null}),meta:{slug:j,status:q,category:p}});let B=`/admin/policies/${j}`;await k("/admin","/admin/policies",B,"/policies",`/policies/${j}`,"/transparency","/sitemap.xml")}async function q(a){let{supabase:b,portalClient:c,actorProfile:d}=await l(),g=a.get("policy_id"),i=a.get("current_slug")?.trim()??null;if(!g)throw Error("Admin context is required.");let{data:j,error:p}=await c.from("policies").select("slug").eq("id",g).maybeSingle();if(p||!j)throw p??Error("Policy not found.");let q=a.get("title")?.trim()??"";if(!q)throw Error("Add a policy title.");let r=a.get("slug")?.trim()??"",s=(0,h.normalizePolicySlug)(r||q)||j.slug,t=await n(b,a.get("category")?.trim()??null),u=await m(b,a.get("status")?.trim()??"draft"),v=a.get("short_summary")?.trim()??"";if(!v)throw Error("Add a short summary.");let w=a.get("body_html")??"",x=(0,f.sanitizeResourceHtml)(w),y=Number.parseInt(a.get("sort_order")??"100",10)||100,z=o(a.get("last_reviewed_at"))??new Date().toISOString(),A=o(a.get("effective_from")),B=o(a.get("effective_to")),C=a.get("internal_ref")?.trim()||null,{error:D}=await c.from("policies").update({slug:s,title:q,category:t,short_summary:v,body_html:x,status:u,sort_order:y,last_reviewed_at:z,effective_from:A,effective_to:B,internal_ref:C,updated_by_profile_id:d.id}).eq("id",g);if(D)throw D;await (0,e.logAuditEvent)(b,{actorProfileId:d.id,action:"policy_updated",entityType:"policy",entityRef:(0,e.buildEntityRef)({schema:"portal",table:"policies",id:g}),meta:{slug:s,status:u,category:t}});let E=`/admin/policies/${s}`,F=i&&i!==s?`/policies/${i}`:null,G=i&&i!==s?`/admin/policies/${i}`:null;await k("/admin","/admin/policies",E,"/policies",`/policies/${s}`,F,G,"/transparency","/sitemap.xml")}async function r(a){try{let{supabase:b,portalClient:c,actorProfile:d}=await l(),g=a.get("policy_id");if(!g)throw Error("Policy context is required.");let h=a.get("body_html")??"",i=a.get("short_summary")??"",j=(0,f.sanitizeResourceHtml)(h),{error:k}=await c.from("policies").update({body_html:j,short_summary:i.trim()||null,updated_by_profile_id:d.id}).eq("id",g);if(k)throw k;return await (0,e.logAuditEvent)(b,{actorProfileId:d.id,action:"policy_autosaved",entityType:"policy",entityRef:(0,e.buildEntityRef)({schema:"portal",table:"policies",id:g}),meta:{fields:["body_html","short_summary"]}}),{success:!0}}catch(a){return console.error("autosavePolicyAction error",a),{success:!1,error:a instanceof Error?a.message:"Unable to autosave right now."}}}async function s(a){let b=a.get("policy_id"),c=a.get("policy_slug")?.trim()??null;if(!b)throw Error("Admin context is required.");let{supabase:d,portalClient:f,actorProfile:g}=await l(),{error:h}=await f.from("policies").delete().eq("id",b);if(h)throw h;await (0,e.logAuditEvent)(d,{actorProfileId:g.id,action:"policy_deleted",entityType:"policy",entityRef:(0,e.buildEntityRef)({schema:"portal",table:"policies",id:b}),meta:{slug:c}}),await k("/admin","/admin/policies","/policies",c?`/policies/${c}`:null,c?`/admin/policies/${c}`:null,"/transparency","/sitemap.xml")}(0,a.i(13095).ensureServerEntryExports)([p,q,r,s]),(0,b.registerServerReference)(p,"406dcf9e60213fa3fa6ce8eec1f2fccc19ef6ac739",null),(0,b.registerServerReference)(q,"40cca882723a860ea6501e7acaca2525e56af7fce1",null),(0,b.registerServerReference)(r,"40613ab70c635f30df7fd1d0b88aa147d80ba2194f",null),(0,b.registerServerReference)(s,"40165f50f992ad053d1435e8398d12755408f8f554",null),a.s(["autosavePolicyAction",()=>r,"createPolicy",()=>p,"deletePolicy",()=>s,"updatePolicy",()=>q])},84130,a=>{"use strict";var b=a.i(86731),c=a.i(56287);a.s([],99178),a.i(99178),a.s(["00b7ee4fee263fec1fe8acb860989f6ddb47485e3a",()=>b.$$RSC_SERVER_ACTION_0,"40165f50f992ad053d1435e8398d12755408f8f554",()=>c.deletePolicy,"40613ab70c635f30df7fd1d0b88aa147d80ba2194f",()=>c.autosavePolicyAction,"406dcf9e60213fa3fa6ce8eec1f2fccc19ef6ac739",()=>c.createPolicy,"40cca882723a860ea6501e7acaca2525e56af7fce1",()=>c.updatePolicy],84130)}];

//# sourceMappingURL=_e8adb509._.js.map