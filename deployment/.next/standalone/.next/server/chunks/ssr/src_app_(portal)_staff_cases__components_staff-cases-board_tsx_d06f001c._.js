module.exports=[20126,a=>{"use strict";var b=a.i(87924),c=a.i(38246),d=a.i(72131),e=a.i(86304),f=a.i(99570),g=a.i(91119),h=a.i(81671),i=a.i(66718),j=a.i(5084),k=a.i(6015),l=a.i(35112),m=a.i(70430),n=a.i(29246),o=a.i(5050),p=(0,o.createServerReference)("604d72ab24222a2cb2d22e4d50209f9824968f3934",o.callServer,void 0,o.findSourceMapURL,"staffLogOutreachAction"),q=a.i(68114);let r={status:"idle"};function s(a){let b=a=>String(a).padStart(2,"0");return`${a.getFullYear()}-${b(a.getMonth()+1)}-${b(a.getDate())}T${b(a.getHours())}:${b(a.getMinutes())}`}function t({personId:a,caseId:c,focusSignal:e,defaultTitle:g,dense:h=!1}){let[j,k]=(0,l.useFormState)(p,r),o=(0,d.useRef)(null),t=(0,d.useRef)(null),u=(0,d.useRef)(null),v=(0,d.useMemo)(()=>s(new Date),[]);(0,d.useEffect)(()=>{e&&t.current?.focus()},[e]),(0,d.useEffect)(()=>{if("success"===j.status){o.current?.reset();let a=s(new Date);u.current&&(u.current.value=a),t.current?.focus()}},[j.status]);let w=!a;return(0,b.jsx)("form",{ref:o,action:k,className:(0,q.cn)("rounded-2xl border border-outline/20 bg-surface-container p-space-md shadow-sm",h&&"p-space-sm"),children:(0,b.jsxs)("div",{className:"space-y-space-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-space-sm",children:[(0,b.jsxs)("div",{className:"space-y-space-3xs",children:[(0,b.jsx)("p",{className:"text-title-sm text-on-surface",children:"Log outreach"}),(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:"Quick entry writes to the audit trail and stays staff-only."})]}),(0,b.jsx)("span",{className:"rounded-full bg-outline/10 px-space-xs py-px text-label-sm text-muted-foreground",children:"N"})]}),(0,b.jsx)("input",{type:"hidden",name:"person_id",value:a??"",readOnly:!0}),c?(0,b.jsx)("input",{type:"hidden",name:"case_id",value:c,readOnly:!0}):null,(0,b.jsxs)("div",{className:"grid gap-space-sm sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(m.Label,{htmlFor:"outreach-title",className:"text-label-sm",children:"Title"}),(0,b.jsx)(i.Input,{id:"outreach-title",name:"title",ref:t,required:!0,minLength:3,maxLength:160,placeholder:"Phone check-in, wellness visit, supply drop…",defaultValue:g??"",disabled:w})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(m.Label,{htmlFor:"outreach-occurred-at",className:"text-label-sm",children:"Occurred at"}),(0,b.jsx)(i.Input,{id:"outreach-occurred-at",name:"occurred_at",type:"datetime-local",ref:u,defaultValue:v,disabled:w})]})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsxs)(m.Label,{htmlFor:"outreach-summary",className:"text-label-sm",children:["Summary ",(0,b.jsx)("span",{className:"text-muted-foreground",children:"(optional)"})]}),(0,b.jsx)(n.Textarea,{id:"outreach-summary",name:"summary",minLength:0,maxLength:1200,rows:4,placeholder:"What happened, supports provided, any follow-ups needed.",disabled:w})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsxs)(m.Label,{htmlFor:"outreach-location",className:"text-label-sm",children:["Location ",(0,b.jsx)("span",{className:"text-muted-foreground",children:"(optional)"})]}),(0,b.jsx)(i.Input,{id:"outreach-location",name:"location",maxLength:240,placeholder:"Example: Brookside shelter, phone, outreach van",disabled:w})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-space-sm",children:[(0,b.jsxs)("div",{className:"space-y-space-3xs",children:[(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:"Select a case to enable logging. Entries respect Supabase RLS."}),(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:"Audit trail captures actor, time, and linked person."})]}),(0,b.jsx)(f.Button,{type:"submit",disabled:w,children:"Save outreach"})]}),(0,b.jsxs)("p",{"aria-live":"polite",className:(0,q.cn)("text-label-sm","error"===j.status?"text-destructive":"text-primary"),children:["success"===j.status?j.message:null,"error"===j.status?j.message:null]})]})})}var u=a.i(49363),v=a.i(70106);let w=(0,v.default)("clock-4",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),x=(0,v.default)("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),y=(0,v.default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);var z=a.i(87532);let A=(0,v.default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);function B({cases:a,caseload:c,shifts:f}){let j=(0,d.useRef)(null),[l,m]=(0,d.useState)("all"),[n,o]=(0,d.useState)(""),[p,r]=(0,d.useState)(),s=(0,d.useMemo)(()=>{let b=new Map;return c.forEach(a=>b.set(a.personId,a)),a.map(a=>{let c=b.get(a.personId);return{...a,status:a.status??"active",clientName:c?.clientName??null,nextStep:c?.nextStep??null,nextAt:c?.nextAt??null}})},[a,c]),t=(0,d.useMemo)(()=>[{id:"all",label:"All cases",description:"Everything you can access via RLS.",filter:()=>!0,sort:F},{id:"active",label:"Active",description:"Open cases in progress.",filter:a=>{let b;return!(b=(a.status??"").toLowerCase())||["active","open","ongoing","in_progress"].includes(b)},sort:F},{id:"next",label:"Next steps",description:"Cases with a scheduled next action.",filter:a=>!!(a.nextAt||a.nextStep),sort:G},{id:"priority",label:"High priority",description:"High, urgent, or critical cases.",filter:a=>["high","urgent","critical","emergency"].includes((a.priority??"").toLowerCase()),sort:F},{id:"recent",label:"New this month",description:"Started in the last 30 days.",filter:a=>H(a.startDate,30),sort:F},{id:"closed",label:"Closed",description:"Completed, resolved, or closed cases.",filter:a=>["closed","completed","resolved","archived"].includes((a.status??"").toLowerCase()),sort:F}],[]),u=t.find(a=>a.id===l)??t[0],v=(0,d.useMemo)(()=>{let a=n.trim().toLowerCase(),b=s.filter(a=>u.filter(a));return[...a?b.filter(b=>{var c,d;return c=b,d=a,[c.caseType,c.caseManagerName,c.caseManagerContact,c.caseNumber,c.clientName,c.priority,c.status,String(c.personId)].filter(Boolean).map(a=>String(a).toLowerCase()).some(a=>a.includes(d))}):b].sort(u.sort??F)},[s,u,n]),[w,x]=(0,d.useState)(null),A=(0,d.useMemo)(()=>v.length?w&&v.some(a=>a.id===w)?w:v[0].id:null,[v,w]);(0,d.useEffect)(()=>{function a(a){let b=a.key.toLowerCase(),c=document.activeElement,d=c?.tagName==="INPUT"||c?.tagName==="TEXTAREA"||c?.isContentEditable;"/"!==b||a.metaKey||a.ctrlKey||d||(a.preventDefault(),j.current?.focus()),"n"!==b||a.metaKey||a.ctrlKey||d||(a.preventDefault(),r(Date.now()))}return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]);let B=v.find(a=>a.id===A)??null,D=(0,d.useMemo)(()=>{var a,b;let c,d,e,g;return a=s,b=f,g=(d=String((c=new Date).getMonth()+1).padStart(2,"0"),e=String(c.getDate()).padStart(2,"0"),`${c.getFullYear()}-${d}-${e}`),{dueToday:a.filter(a=>(a.nextAt??"").slice(0,10)===g).sort(G),newThisWeek:a.filter(a=>H(a.startDate,7)).length,nextShift:b.slice().sort((a,b)=>Date.parse(a.startsAt)-Date.parse(b.startsAt))[0]??null}},[s,f]);return(0,b.jsxs)("div",{className:"space-y-space-lg",children:[(0,b.jsx)(C,{highlights:D}),(0,b.jsxs)(g.Card,{className:"border border-outline/20 shadow-sm",children:[(0,b.jsxs)(g.CardHeader,{className:"space-y-space-sm",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-space-sm lg:flex-row lg:items-center lg:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)(g.CardTitle,{className:"text-title-lg",children:"Cases"}),(0,b.jsx)(g.CardDescription,{children:"Saved views filter by status, priority, and schedule. Use / to search, N to log outreach, and the header workspace bar to change workspaces."})]}),(0,b.jsxs)("div",{className:"flex w-full flex-col gap-space-2xs sm:max-w-md",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(h.Icon,{icon:z.Search,size:"sm",className:"absolute left-space-sm top-1/2 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(i.Input,{ref:j,value:n,onChange:a=>o(a.target.value),placeholder:"Search case type, manager, or # (/)",className:"pl-10","aria-label":"Search cases"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-space-xs text-label-sm text-muted-foreground",children:[(0,b.jsxs)("span",{className:"inline-flex items-center gap-space-2xs rounded-full bg-outline/10 px-space-xs py-px",children:[(0,b.jsx)(h.Icon,{icon:y,size:"sm"}),u.label]}),(0,b.jsxs)("span",{className:"inline-flex items-center gap-space-2xs rounded-full bg-outline/10 px-space-xs py-px",children:[(0,b.jsx)("span",{className:"font-medium",children:"/"}),"Search"]}),(0,b.jsxs)("span",{className:"inline-flex items-center gap-space-2xs rounded-full bg-outline/10 px-space-xs py-px",children:[(0,b.jsx)("span",{className:"font-medium",children:"N"}),"Log outreach"]})]})]})]}),(0,b.jsx)("div",{className:"flex flex-wrap items-center gap-space-sm",children:t.map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>m(a.id),className:(0,q.cn)("rounded-full border px-space-sm py-space-2xs text-label-md font-medium transition state-layer-color-primary",a.id===u.id?"border-primary bg-primary/10 text-primary":"border-outline/40 text-on-surface/80 hover:border-outline"),children:a.label},a.id))}),(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:u.description})]}),(0,b.jsx)(g.CardContent,{className:"space-y-space-md",children:(0,b.jsxs)("div",{className:"grid gap-space-md xl:grid-cols-[1.6fr,1fr]",children:[(0,b.jsx)("div",{className:"space-y-space-sm",children:0===v.length?(0,b.jsx)("div",{className:"rounded-2xl border border-dashed border-outline/50 bg-surface-container-low p-space-lg text-center text-body-md text-muted-foreground",children:"No cases match this view yet. Try another saved view or clear your search."}):(0,b.jsx)("div",{className:"overflow-hidden rounded-2xl border border-outline/20 bg-surface-container-low",children:(0,b.jsxs)(k.Table,{children:[(0,b.jsx)(k.TableHeader,{children:(0,b.jsxs)(k.TableRow,{className:"bg-surface-container-high",children:[(0,b.jsx)(k.TableHead,{children:"Case"}),(0,b.jsx)(k.TableHead,{children:"Status"}),(0,b.jsx)(k.TableHead,{children:"Priority"}),(0,b.jsx)(k.TableHead,{children:"Next step"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Opened"})]})}),(0,b.jsx)(k.TableBody,{children:v.map(a=>{let c=a.id===A;return(0,b.jsxs)(k.TableRow,{"data-state":c?"selected":void 0,className:(0,q.cn)("cursor-pointer",c&&"bg-surface-container-high/70"),onClick:()=>x(a.id),tabIndex:0,onKeyDown:b=>{("Enter"===b.key||" "===b.key)&&(b.preventDefault(),x(a.id))},"aria-selected":c,children:[(0,b.jsxs)(k.TableCell,{className:"space-y-space-2xs",children:[(0,b.jsxs)("div",{className:"flex items-center gap-space-xs",children:[(0,b.jsx)("span",{className:"text-body-md font-semibold text-on-surface",children:a.caseType??"Support case"}),(0,b.jsxs)(e.Badge,{variant:"outline",className:"text-label-sm text-muted-foreground",children:["#",a.caseNumber??a.id]})]}),(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:a.clientName?a.clientName:`Person #${a.personId}`}),(0,b.jsxs)("p",{className:"text-label-sm text-muted-foreground",children:[a.caseManagerName,a.caseManagerContact?` \xb7 ${a.caseManagerContact}`:""]})]}),(0,b.jsx)(k.TableCell,{children:(0,b.jsx)(e.Badge,{variant:M(a.status),children:I(a.status)})}),(0,b.jsx)(k.TableCell,{children:(0,b.jsx)(e.Badge,{variant:N(a.priority),children:J(a.priority)})}),(0,b.jsx)(k.TableCell,{children:(0,b.jsxs)("div",{className:"space-y-space-3xs",children:[(0,b.jsx)("p",{className:"text-body-sm text-on-surface/90",children:a.nextStep??"Next step not recorded"}),a.nextAt?(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:L(a.nextAt)}):null]})}),(0,b.jsx)(k.TableCell,{className:"text-right text-label-sm text-muted-foreground",children:K(a.startDate)})]},a.id)})})]})})}),(0,b.jsx)("div",{className:"space-y-space-sm",children:(0,b.jsx)(E,{selectedCase:B,focusSignal:p})})]})})]})]})}function C({highlights:a}){let{dueToday:c,newThisWeek:d,nextShift:e}=a;return(0,b.jsxs)("div",{className:"grid gap-space-sm lg:grid-cols-3",children:[(0,b.jsx)(D,{title:"Today",icon:u.CalendarClock,value:`${c.length} due`,detail:c[0]?.nextStep??"No follow-ups scheduled today.",meta:c[0]?.nextAt?L(c[0].nextAt):void 0}),(0,b.jsx)(D,{title:"Next shift",icon:w,value:e?e.title:"Not scheduled",detail:e?e.location:"No shift logged for today.",meta:e?`${e.startsAt} – ${e.endsAt}`:void 0}),(0,b.jsx)(D,{title:"New this week",icon:A,value:`${d} opened`,detail:d>0?"Keep momentum with early outreach.":"No new cases this week yet."})]})}function D({title:a,value:c,detail:d,meta:e,icon:f}){return(0,b.jsxs)("div",{className:"flex items-start gap-space-sm rounded-2xl border border-outline/20 bg-surface-container-high p-space-md shadow-sm",children:[(0,b.jsx)("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-primary/10 text-primary",children:(0,b.jsx)(h.Icon,{icon:f,size:"md"})}),(0,b.jsxs)("div",{className:"space-y-space-3xs",children:[(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:a}),(0,b.jsx)("p",{className:"text-title-md text-on-surface",children:c}),(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:d}),e?(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:e}):null]})]})}function E({selectedCase:a,focusSignal:d}){return a?(0,b.jsxs)("div",{className:"space-y-space-sm rounded-2xl border border-outline/20 bg-surface-container-high p-space-md shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-space-sm",children:[(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsxs)("p",{className:"text-label-sm text-muted-foreground",children:["Case #",a.caseNumber??a.id]}),(0,b.jsx)("p",{className:"text-title-lg text-on-surface",children:a.caseType??"Support case"}),(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:a.clientName?a.clientName:`Person #${a.personId}`})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-space-2xs",children:[(0,b.jsx)(e.Badge,{variant:M(a.status),children:I(a.status)}),(0,b.jsx)(e.Badge,{variant:N(a.priority),children:J(a.priority)})]})]}),(0,b.jsx)(j.Separator,{}),(0,b.jsxs)("dl",{className:"grid grid-cols-2 gap-space-sm text-label-sm text-muted-foreground",children:[(0,b.jsxs)("div",{className:"space-y-space-3xs",children:[(0,b.jsx)("dt",{children:"Case manager"}),(0,b.jsx)("dd",{className:"text-body-sm text-on-surface",children:a.caseManagerName}),a.caseManagerContact?(0,b.jsx)("dd",{className:"text-label-sm text-muted-foreground",children:a.caseManagerContact}):null]}),(0,b.jsxs)("div",{className:"space-y-space-3xs",children:[(0,b.jsx)("dt",{children:"Opened"}),(0,b.jsx)("dd",{className:"text-body-sm text-on-surface",children:K(a.startDate)}),(0,b.jsx)("dd",{className:"text-label-sm text-muted-foreground",children:a.endDate?`Closed ${K(a.endDate)}`:"Open case"})]})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs rounded-xl bg-surface-container-low p-space-sm",children:[(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:"Next step"}),(0,b.jsx)("p",{className:"text-body-md text-on-surface/90",children:a.nextStep??"Next action not captured yet."}),a.nextAt?(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground",children:L(a.nextAt)}):null]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-space-sm",children:[(0,b.jsx)(f.Button,{asChild:!0,size:"sm",variant:"secondary",children:(0,b.jsx)(c.default,{href:`/staff/cases/${a.id}`,children:"Open full case"})}),(0,b.jsxs)(e.Badge,{variant:"outline",className:"inline-flex items-center gap-space-2xs",children:[(0,b.jsx)(h.Icon,{icon:x,size:"sm"}),"Shift + ⌘/Ctrl + W to change workspace"]})]}),(0,b.jsx)(t,{personId:a.personId,caseId:a.id,defaultTitle:"Outreach follow-up",focusSignal:d,dense:!0})]}):(0,b.jsx)("div",{className:"rounded-2xl border border-dashed border-outline/50 bg-surface-container-low p-space-lg text-center",children:(0,b.jsx)("p",{className:"text-body-md text-muted-foreground",children:"Select a case to preview details and log outreach."})})}function F(a,b){let c=a.startDate?Date.parse(a.startDate):0;return(b.startDate?Date.parse(b.startDate):0)-c}function G(a,b){return(a.nextAt?Date.parse(a.nextAt):1/0)-(b.nextAt?Date.parse(b.nextAt):1/0)}function H(a,b){if(!a)return!1;let c=Date.parse(a);if(Number.isNaN(c))return!1;let d=Date.now()-c;return d>=0&&d<=24*b*36e5}function I(a){return a?"in_progress"===a.toLowerCase()?"In progress":a.charAt(0).toUpperCase()+a.slice(1):"Active"}function J(a){return a?a.charAt(0).toUpperCase()+a.slice(1):"Standard"}function K(a){if(!a)return"—";let b=new Date(a);return Number.isNaN(b.getTime())?"—":b.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function L(a){let b=new Date(a);return Number.isNaN(b.getTime())?a:b.toLocaleString(void 0,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}function M(a){let b=(a??"").toLowerCase();return["closed","completed","resolved","archived"].includes(b)?"secondary":["escalated","overdue"].includes(b)?"destructive":"default"}function N(a){let b=(a??"").toLowerCase();return["high","urgent","critical","emergency"].includes(b)?"destructive":["medium","standard"].includes(b)?"secondary":"outline"}a.s(["StaffCasesBoard",()=>B],20126)}];

//# sourceMappingURL=src_app_%28portal%29_staff_cases__components_staff-cases-board_tsx_d06f001c._.js.map