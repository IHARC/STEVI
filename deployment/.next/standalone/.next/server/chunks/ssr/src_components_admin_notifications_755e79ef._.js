module.exports=[30167,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(91119),f=a.i(99570),g=a.i(86304),h=a.i(66718),i=a.i(29246),j=a.i(70430),k=a.i(80701),l=a.i(78125),m=a.i(5050),n=(0,m.createServerReference)("40d2fdb7c3d2c6140d23500beb4148ad3908a86db6",m.callServer,void 0,m.findSourceMapURL,"sendNotificationAction");let o=[{value:"general",label:"General update"},{value:"appointment",label:"Appointment reminder"},{value:"alert",label:"Urgent alert"},{value:"case_note",label:"Case note / follow-up"},{value:"test",label:"Test message"}],p=[{id:"appt-reminder",label:"Appointment reminder",type:"appointment",subject:"Reminder: your upcoming appointment",bodyText:"Hi there, this is a reminder about your upcoming appointment. Reply if you need to reschedule."},{id:"case-followup",label:"Case follow-up",type:"case_note",subject:"Checking in on next steps",bodyText:"Hi, following up on our last conversation. Let us know if you need support before the next visit."},{id:"general-update",label:"General update",type:"general",subject:"Update from the STEVI team",bodyText:"Hi, we have a quick update to share. Reply here if you have questions."},{id:"test-send",label:"Test message",type:"test",subject:"[TEST] Notification delivery check",bodyText:"This is a test message to confirm notification delivery from STEVI."}];function q({recipients:a,hasAlertsSecret:m}){let q=(0,d.useRouter)(),{toast:r}=(0,l.useToast)(),s=(0,c.useRef)(null),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)("general"),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useTransition)(),J=(0,c.useMemo)(()=>new Map(a.map(a=>[a.id,a])),[a]),K=async a=>{if(a.preventDefault(),H)return;let b=new FormData(a.currentTarget);if(F&&!m)return void r({title:"Test send blocked",description:"Configure PORTAL_ALERTS_SECRET to send tests.",variant:"destructive"});b.append("is_test",String(F));let c=await n(b);c.success?(r({title:F?"Test queued":"Notification queued",description:"Delivery will start shortly."}),s.current?.reset(),u(""),w(""),y(""),A("general"),C(""),E(""),I(()=>q.refresh())):r({title:"Notification error",description:c.error,variant:"destructive"})};return(0,b.jsxs)(e.Card,{className:"border-border/60",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{className:"text-title-lg",children:"Compose notification"}),(0,b.jsx)(e.CardDescription,{children:"Send trauma-informed updates. Messages respect notification consent stored with each profile."})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("form",{ref:s,onSubmit:K,className:"grid gap-space-md",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-space-sm rounded-xl border border-outline/15 bg-surface-container-low px-space-sm py-space-2xs text-label-sm text-muted-foreground",children:[(0,b.jsx)(g.Badge,{variant:m?"secondary":"destructive",children:m?"Edge function ready":"Configure PORTAL_ALERTS_SECRET for sends"}),(0,b.jsx)(g.Badge,{variant:"outline",children:"Consent enforced server-side"})]}),(0,b.jsxs)("div",{className:"grid gap-space-sm md:grid-cols-2",children:[(0,b.jsxs)(j.Label,{className:"grid gap-1 text-body-sm text-on-surface",children:[(0,b.jsx)("span",{className:"text-label-sm uppercase text-muted-foreground",children:"Recipient"}),(0,b.jsxs)(k.Select,{name:"recipient_profile_id",value:t,onValueChange:a=>{if(u(a),a){let b=J.get(a);w(b?.email??"")}else w("")},disabled:H,children:[(0,b.jsx)(k.SelectTrigger,{"aria-label":"Recipient",children:(0,b.jsx)(k.SelectValue,{placeholder:"Select profile"})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"",children:"Select profile"}),a.map(a=>(0,b.jsxs)(k.SelectItem,{value:a.id,children:[a.displayName,a.organizationName?` • ${a.organizationName}`:""]},a.id))]})]})]}),(0,b.jsxs)(j.Label,{className:"grid gap-1 text-body-sm text-on-surface",children:[(0,b.jsx)("span",{className:"text-label-sm uppercase text-muted-foreground",children:"Notification type"}),(0,b.jsxs)(k.Select,{name:"notification_type",value:z,onValueChange:A,disabled:H,children:[(0,b.jsx)(k.SelectTrigger,{"aria-label":"Notification type",children:(0,b.jsx)(k.SelectValue,{placeholder:"Select type"})}),(0,b.jsx)(k.SelectContent,{children:o.map(a=>(0,b.jsx)(k.SelectItem,{value:a.value,children:a.label},a.value))})]})]})]}),(0,b.jsxs)("div",{className:"grid gap-space-sm md:grid-cols-2",children:[(0,b.jsxs)(j.Label,{className:"grid gap-1 text-body-sm text-on-surface",children:[(0,b.jsx)("span",{className:"text-label-sm uppercase text-muted-foreground",children:"Recipient email override"}),(0,b.jsx)(h.Input,{name:"recipient_email",type:"email",value:v,onChange:a=>w(a.target.value),placeholder:"client@example.ca",disabled:H})]}),(0,b.jsxs)(j.Label,{className:"grid gap-1 text-body-sm text-on-surface",children:[(0,b.jsx)("span",{className:"text-label-sm uppercase text-muted-foreground",children:"Payload (JSON, optional)"}),(0,b.jsx)(i.Textarea,{name:"payload_json",placeholder:'{"appointmentId":"123"}',className:"min-h-[72px]",disabled:H})]})]}),(0,b.jsxs)(j.Label,{className:"grid gap-1 text-body-sm text-on-surface",children:[(0,b.jsx)("span",{className:"text-label-sm uppercase text-muted-foreground",children:"Template"}),(0,b.jsxs)(k.Select,{value:x,onValueChange:a=>{let b=p.find(b=>b.id===a);y(a),b&&(A(b.type),C(b.subject),E(b.bodyText))},disabled:H,children:[(0,b.jsx)(k.SelectTrigger,{"aria-label":"Template",children:(0,b.jsx)(k.SelectValue,{placeholder:"Select template"})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"",children:"No template"}),p.map(a=>(0,b.jsx)(k.SelectItem,{value:a.id,children:a.label},a.id))]})]})]}),(0,b.jsxs)(j.Label,{className:"grid gap-1 text-body-sm text-on-surface",children:[(0,b.jsx)("span",{className:"text-label-sm uppercase text-muted-foreground",children:"Subject"}),(0,b.jsx)(h.Input,{name:"subject",placeholder:"Reminder: upcoming appointment",required:!0,disabled:H,value:B,onChange:a=>C(a.target.value)})]}),(0,b.jsxs)(j.Label,{className:"grid gap-1 text-body-sm text-on-surface",children:[(0,b.jsx)("span",{className:"text-label-sm uppercase text-muted-foreground",children:"Plain text body"}),(0,b.jsx)(i.Textarea,{name:"body_text",required:!0,placeholder:"Hi Jordan, this is a reminder for tomorrow’s appointment...",className:"min-h-[140px]",disabled:H,value:D,onChange:a=>E(a.target.value)})]}),(0,b.jsxs)(j.Label,{className:"grid gap-1 text-body-sm text-on-surface",children:[(0,b.jsx)("span",{className:"text-label-sm uppercase text-muted-foreground",children:"HTML body (optional)"}),(0,b.jsx)(i.Textarea,{name:"body_html",placeholder:"<p>Hi Jordan,</p><p>See you tomorrow...</p>",className:"min-h-[140px]",disabled:H})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-space-sm",children:[(0,b.jsxs)("label",{className:"flex items-center gap-space-2xs text-label-sm text-muted-foreground",children:[(0,b.jsx)("input",{type:"checkbox",checked:F,onChange:a=>G(a.target.checked),className:"h-4 w-4 rounded border border-outline",disabled:H}),(0,b.jsx)("span",{children:"Test send (uses templates; requires secret)"})]}),(0,b.jsx)(f.Button,{type:"submit",disabled:H||F&&!m,children:F?"Send test":"Queue notification"})]})]})})]})}a.s(["ComposeNotificationForm",()=>q],30167)},586,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(91119),e=a.i(86304),f=a.i(6015);let g=new Intl.DateTimeFormat("en-CA",{dateStyle:"medium",timeStyle:"short"});function h(a){if(!a)return"Pending";try{return g.format(new Date(a))}catch{return a}}function i({notifications:a}){let g=(0,c.useMemo)(()=>a.map(a=>({...a,sentLabel:h(a.sentAt),statusLabel:a.status.replace(/_/g," ")})),[a]);return(0,b.jsxs)(d.Card,{className:"border-border/60",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{className:"text-title-lg",children:"Delivery history"}),(0,b.jsx)(d.CardDescription,{children:"Last 20 notifications queued through STEVI."})]}),(0,b.jsx)(d.CardContent,{className:"overflow-x-auto",children:0===g.length?(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:"No notifications yet."}):(0,b.jsxs)(f.Table,{children:[(0,b.jsx)(f.TableHeader,{children:(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableHead,{children:"Subject"}),(0,b.jsx)(f.TableHead,{children:"Recipient"}),(0,b.jsx)(f.TableHead,{children:"Type"}),(0,b.jsx)(f.TableHead,{children:"Status"}),(0,b.jsx)(f.TableHead,{children:"Queued"}),(0,b.jsx)(f.TableHead,{children:"Sent"})]})}),(0,b.jsx)(f.TableBody,{children:g.map(a=>(0,b.jsxs)(f.TableRow,{children:[(0,b.jsxs)(f.TableCell,{className:"max-w-xs",children:[(0,b.jsx)("p",{className:"font-medium text-on-surface",children:a.subject}),(0,b.jsx)("p",{className:"text-label-sm text-muted-foreground line-clamp-2",children:a.bodyText})]}),(0,b.jsx)(f.TableCell,{className:"text-body-sm",children:(0,b.jsxs)("div",{className:"flex flex-col",children:[a.profileId?(0,b.jsx)("span",{className:"font-medium text-on-surface",children:a.profileName??a.profileId}):(0,b.jsx)("span",{className:"text-muted-foreground",children:"External"}),(0,b.jsx)("span",{className:"text-label-sm text-muted-foreground",children:a.recipientEmail})]})}),(0,b.jsx)(f.TableCell,{className:"text-label-sm uppercase text-muted-foreground",children:a.notificationType}),(0,b.jsx)(f.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"sent"===a.status?"secondary":"outline",children:a.statusLabel})}),(0,b.jsx)(f.TableCell,{className:"text-label-sm text-muted-foreground",children:h(a.createdAt)}),(0,b.jsx)(f.TableCell,{className:"text-label-sm text-muted-foreground",children:a.sentLabel})]},a.id))})]})})]})}a.s(["RecentNotifications",()=>i])},91818,a=>{"use strict";var b=a.i(87924),c=a.i(35112),d=a.i(91119),e=a.i(66718),f=a.i(99570),g=a.i(80701),h=a.i(5050),i=(0,h.createServerReference)("4023de9a73ed1fc562c739a8b9d926e6aa5e926e38",h.callServer,void 0,h.findSourceMapURL,"upsertRelayAction");function j(){let{pending:a}=(0,c.useFormStatus)();return(0,b.jsx)(f.Button,{type:"submit",size:"sm",disabled:a,children:a?"Saving…":"Save relay"})}function k({channel:a}){return(0,b.jsxs)("form",{action:i,className:"space-y-space-sm","aria-label":`${a} relay form`,children:[(0,b.jsx)("input",{type:"hidden",name:"channel",value:a}),(0,b.jsxs)("div",{className:"grid gap-space-sm sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm font-semibold text-on-surface",htmlFor:`${a}-provider`,children:"Provider name"}),(0,b.jsx)(e.Input,{id:`${a}-provider`,name:"provider",placeholder:"e.g., SendGrid, Twilio",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm font-semibold text-on-surface",htmlFor:`${a}-api-url`,children:"API base URL (optional)"}),(0,b.jsx)(e.Input,{id:`${a}-api-url`,name:"api_url",placeholder:"https://api.example.com"})]})]}),(0,b.jsxs)("div",{className:"grid gap-space-sm sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm font-semibold text-on-surface",htmlFor:`${a}-api-key`,children:"API key / token"}),(0,b.jsx)(e.Input,{id:`${a}-api-key`,name:"api_key",type:"password",placeholder:"Never shared with clients",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm font-semibold text-on-surface",htmlFor:`${a}-active`,children:"Relay status"}),(0,b.jsxs)(g.Select,{name:"is_active",defaultValue:"true",children:[(0,b.jsx)(g.SelectTrigger,{id:`${a}-active`,children:(0,b.jsx)(g.SelectValue,{placeholder:"Active?"})}),(0,b.jsxs)(g.SelectContent,{children:[(0,b.jsx)(g.SelectItem,{value:"true",children:"Active"}),(0,b.jsx)(g.SelectItem,{value:"false",children:"Inactive"})]})]})]})]}),"email"===a?(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm font-semibold text-on-surface",htmlFor:"from-email",children:"From email (envelope)"}),(0,b.jsx)(e.Input,{id:"from-email",name:"from_email",type:"email",placeholder:"notifications@iharc.ca"})]}):(0,b.jsxs)("div",{className:"space-y-space-2xs",children:[(0,b.jsx)("label",{className:"text-label-sm font-semibold text-on-surface",htmlFor:"from-phone",children:"From phone / sender ID"}),(0,b.jsx)(e.Input,{id:"from-phone",name:"from_phone",placeholder:"+1647xxxxxxx"})]}),(0,b.jsx)(j,{})]})}function l(){return(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{className:"text-title-lg",children:"Delivery relays"}),(0,b.jsx)("p",{className:"text-body-sm text-muted-foreground",children:"Configure email/SMS gateways for reminders. Keys stay server-side and are restricted to IHARC and portal admins."})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-space-md",children:[(0,b.jsx)(k,{channel:"email"}),(0,b.jsx)("div",{className:"border-t border-outline/20"}),(0,b.jsx)(k,{channel:"sms"})]})]})}a.s(["RelaySettingsCard",()=>l],91818)}];

//# sourceMappingURL=src_components_admin_notifications_755e79ef._.js.map