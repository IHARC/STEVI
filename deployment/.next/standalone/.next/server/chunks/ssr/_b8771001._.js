module.exports=[49126,(a,b,c)=>{"use strict";let d;Object.defineProperty(c,"__esModule",{value:!0});var e={arrayBufferToString:function(){return j},decrypt:function(){return m},encrypt:function(){return l},getActionEncryptionKey:function(){return r},getClientReferenceManifestForRsc:function(){return q},getServerModuleMap:function(){return p},setReferenceManifestsSingleton:function(){return o},stringToUint8Array:function(){return k}};for(var f in e)Object.defineProperty(c,f,{enumerable:!0,get:e[f]});let g=a.r(50640),h=a.r(5847),i=a.r(56704);function j(a){let b=new Uint8Array(a),c=b.byteLength;if(c<65535)return String.fromCharCode.apply(null,b);let d="";for(let a=0;a<c;a++)d+=String.fromCharCode(b[a]);return d}function k(a){let b=a.length,c=new Uint8Array(b);for(let d=0;d<b;d++)c[d]=a.charCodeAt(d);return c}function l(a,b,c){return crypto.subtle.encrypt({name:"AES-GCM",iv:b},a,c)}function m(a,b,c){return crypto.subtle.decrypt({name:"AES-GCM",iv:b},a,c)}let n=Symbol.for("next.server.action-manifests");function o({page:a,clientReferenceManifest:b,serverActionsManifest:c,serverModuleMap:d}){var e;let f=null==(e=globalThis[n])?void 0:e.clientReferenceManifestsPerPage;globalThis[n]={clientReferenceManifestsPerPage:{...f,[(0,h.normalizeAppPath)(a)]:b},serverActionsManifest:c,serverModuleMap:d}}function p(){let a=globalThis[n];if(!a)throw Object.defineProperty(new g.InvariantError("Missing manifest for Server Actions."),"__NEXT_ERROR_CODE",{value:"E606",enumerable:!1,configurable:!0});return a.serverModuleMap}function q(){let a=globalThis[n];if(!a)throw Object.defineProperty(new g.InvariantError("Missing manifest for Server Actions."),"__NEXT_ERROR_CODE",{value:"E606",enumerable:!1,configurable:!0});let{clientReferenceManifestsPerPage:b}=a,c=i.workAsyncStorage.getStore();if(!c){var d=b;let a=Object.values(d),c={clientModules:{},edgeRscModuleMapping:{},rscModuleMapping:{}};for(let b of a)c.clientModules={...c.clientModules,...b.clientModules},c.edgeRscModuleMapping={...c.edgeRscModuleMapping,...b.edgeRscModuleMapping},c.rscModuleMapping={...c.rscModuleMapping,...b.rscModuleMapping};return c}let e=b[c.route];if(!e)throw Object.defineProperty(new g.InvariantError(`Missing Client Reference Manifest for ${c.route}.`),"__NEXT_ERROR_CODE",{value:"E570",enumerable:!1,configurable:!0});return e}async function r(){if(d)return d;let a=globalThis[n];if(!a)throw Object.defineProperty(new g.InvariantError("Missing manifest for Server Actions."),"__NEXT_ERROR_CODE",{value:"E606",enumerable:!1,configurable:!0});let b=process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY||a.serverActionsManifest.encryptionKey;if(void 0===b)throw Object.defineProperty(new g.InvariantError("Missing encryption key for Server Actions"),"__NEXT_ERROR_CODE",{value:"E571",enumerable:!1,configurable:!0});return d=await crypto.subtle.importKey("raw",k(atob(b)),"AES-GCM",!0,["encrypt","decrypt"])}},44721,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e,f={decryptActionBoundArgs:function(){return w},encryptActionBoundArgs:function(){return v}};for(var g in f)Object.defineProperty(c,g,{enumerable:!0,get:f[g]});a.r(55781);let h=a.r(11857),i=a.r(87231),j=a.r(75406),k=a.r(49126),l=a.r(32319),m=a.r(60384),n=(d=a.r(717))&&d.__esModule?d:{default:d},o=new TextEncoder,p=new TextDecoder,q,r;async function s(a,b){let c=await (0,k.getActionEncryptionKey)();if(void 0===c)throw Object.defineProperty(Error("Missing encryption key for Server Action. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E65",enumerable:!1,configurable:!0});let d=atob(b),e=d.slice(0,16),f=d.slice(16),g=p.decode(await (0,k.decrypt)(c,(0,k.stringToUint8Array)(e),(0,k.stringToUint8Array)(f)));if(!g.startsWith(a))throw Object.defineProperty(Error("Invalid Server Action payload: failed to decrypt."),"__NEXT_ERROR_CODE",{value:"E191",enumerable:!1,configurable:!0});return g.slice(a.length)}async function t(a,b){let c=await (0,k.getActionEncryptionKey)();if(void 0===c)throw Object.defineProperty(Error("Missing encryption key for Server Action. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E65",enumerable:!1,configurable:!0});let d=new Uint8Array(16);l.workUnitAsyncStorage.exit(()=>crypto.getRandomValues(d));let e=(0,k.arrayBufferToString)(d.buffer),f=await (0,k.encrypt)(c,d,o.encode(a+b));return btoa(e+(0,k.arrayBufferToString)(f))}var u=((e=u||{})[e.Ready=0]="Ready",e[e.Pending=1]="Pending",e[e.Complete=2]="Complete",e);let v=n.default.cache(async function a(b,...c){let d=l.workUnitAsyncStorage.getStore(),e=d?(0,l.getCacheSignal)(d):void 0,{clientModules:f}=(0,k.getClientReferenceManifestForRsc)(),g=Error();Error.captureStackTrace(g,a);let i=!1,n=d?(0,m.createHangingInputAbortSignal)(d):void 0,o=0;function p(){0===o&&(o=1,null==e||e.beginRead())}function r(){1===o&&(null==e||e.endRead()),o=2}n&&e&&n.addEventListener("abort",p,{once:!0});let s=await (0,j.streamToString)((0,h.renderToReadableStream)(c,f,{filterStackFrame:q,signal:n,onError(a){(null==n?void 0:n.aborted)||i||(i=!0,g.message=a instanceof Error?a.message:String(a))}}),n);if(i)throw r(),g;if(!d)return t(b,s);p();let u=(0,l.getPrerenderResumeDataCache)(d),v=(0,l.getRenderResumeDataCache)(d),w=b+s,x=(null==u?void 0:u.encryptedBoundArgs.get(w))??(null==v?void 0:v.encryptedBoundArgs.get(w));if(x)return x;let y=await t(b,s);return r(),null==u||u.encryptedBoundArgs.set(w,y),y});async function w(a,b){let c,d=await b,e=l.workUnitAsyncStorage.getStore();if(e){let b=(0,l.getCacheSignal)(e),f=(0,l.getPrerenderResumeDataCache)(e),g=(0,l.getRenderResumeDataCache)(e);(c=(null==f?void 0:f.decryptedBoundArgs.get(d))??(null==g?void 0:g.decryptedBoundArgs.get(d)))||(null==b||b.beginRead(),c=await s(a,d),null==b||b.endRead(),null==f||f.decryptedBoundArgs.set(d,c))}else c=await s(a,d);let{edgeRscModuleMapping:f,rscModuleMapping:g}=(0,k.getClientReferenceManifestForRsc)();return await (0,i.createFromReadableStream)(new ReadableStream({start(a){switch(a.enqueue(o.encode(c)),null==e?void 0:e.type){case"prerender":case"prerender-runtime":e.renderSignal.aborted?a.close():e.renderSignal.addEventListener("abort",()=>a.close(),{once:!0});break;case"prerender-client":case"prerender-ppr":case"prerender-legacy":case"request":case"cache":case"private-cache":case"unstable-cache":case void 0:return a.close()}}}),{findSourceMapURL:r,serverConsumerManifest:{moduleLoading:null,moduleMap:g,serverModuleMap:(0,k.getServerModuleMap)()}})}},10114,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call ProfileDetailsForm() from the server but ProfileDetailsForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/portal/profile/profile-details-form.tsx <module evaluation>","ProfileDetailsForm");a.s(["ProfileDetailsForm",0,b])},51672,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call ProfileDetailsForm() from the server but ProfileDetailsForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/portal/profile/profile-details-form.tsx","ProfileDetailsForm");a.s(["ProfileDetailsForm",0,b])},29155,a=>{"use strict";a.i(10114);var b=a.i(51672);a.n(b)},77134,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call ProfileContactCard() from the server but ProfileContactCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/portal/profile/profile-contact-card.tsx <module evaluation>","ProfileContactCard");a.s(["ProfileContactCard",0,b])},24375,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call ProfileContactCard() from the server but ProfileContactCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/portal/profile/profile-contact-card.tsx","ProfileContactCard");a.s(["ProfileContactCard",0,b])},84218,a=>{"use strict";a.i(77134);var b=a.i(24375);a.n(b)},48152,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call ProfilePasswordForm() from the server but ProfilePasswordForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/portal/profile/profile-password-form.tsx <module evaluation>","ProfilePasswordForm");a.s(["ProfilePasswordForm",0,b])},26923,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call ProfilePasswordForm() from the server but ProfilePasswordForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/portal/profile/profile-password-form.tsx","ProfilePasswordForm");a.s(["ProfilePasswordForm",0,b])},50948,a=>{"use strict";a.i(48152);var b=a.i(26923);a.n(b)},38971,a=>{"use strict";var b=a.i(7997),c=a.i(37936),d=a.i(44721);a.i(70396);var e=a.i(73727),f=a.i(18558),g=a.i(9919),h=a.i(16349),i=a.i(42145),j=a.i(29155),k=a.i(84218),l=a.i(50948),m=a.i(10508);let n={none:{label:"No lived experience to share",description:"Keeps collaboration focused on community building without adding personal context."},current:{label:"Currently navigating this lived experience",description:"Signals that you are living through this reality right now and want that perspective acknowledged."},former:{label:"Previously navigated this lived experience",description:"Honours lived expertise from past chapters and ongoing peer mentorship."},prefer_not_to_share:{label:"Prefer not to share",description:"Lets neighbours know you are choosing privacy while still welcoming collaboration."}};function o(a,b){return a&&b.includes(a)?a:b[0]??"none"}var p=a.i(6687),q=a.i(28725),r=a.i(3071),s=a.i(39251);let t={status:"idle"},u={status:"idle"},v={status:"idle"},w={status:"idle"},x=async function(a,b,c){var[e,g,i,j,k,l,m,n,p]=await (0,d.decryptActionBoundArgs)("70ba9926c40a190231a1e41a6b602078bf89aff60e",a);let q=(await (0,h.createSupabaseServerClient)()).schema("portal"),s=c.get("display_name")?.trim(),t=c.get("affiliation_type")?.trim()??e,u=g.includes(t)?t:e,v=c.get("agency_organization_id")?.trim()??null,w=c.get("new_organization_name")?.trim()??null,x=c.get("position_title")?.trim()??null,y=c.get("homelessness_experience")??i[0]??"none",z=c.get("substance_use_experience")??i[0]??"none",A=o(y,i),B=o(z,i),C=null,D=null;if("agency_partner"===u)if(v===r.NEW_ORGANIZATION_VALUE){if(!w||w.length<3)return{status:"idle",error:"Share the organization name (minimum 3 characters)."};D=w}else if(v&&v!==r.NO_ORGANIZATION_VALUE){let a=Number.parseInt(v,10);C=Number.isNaN(a)?null:a}else{if("agency_partner"!==e||!j)return{status:"idle",error:"Select an organization or request a new listing."};let a="number"==typeof j?j:Number(j);C=Number.isNaN(a)?null:a}if(!s||s.length<2)return{status:"idle",error:"Share the name neighbours should see."};let E="community_member"===u,F=E?r.PUBLIC_MEMBER_ROLE_LABEL:x,G=C!==(null===j?null:Number(j)),H="agency_partner"===u&&null!==D,I=e!==u||H||"agency_partner"===u&&G,J=k,K=l,L=m,M=n;E?(C=null,D=null,J="approved",K=null,L=null,M=null):(I||"pending"===k)&&(J="pending",K=I||!l?new Date().toISOString():l,L=null,M=null),"pending"!==J&&(D=null);try{let a={display_name:s,organization_id:C,requested_organization_name:D,position_title:F,affiliation_type:u,affiliation_status:J,affiliation_requested_at:K,affiliation_reviewed_at:L,affiliation_reviewed_by:M,homelessness_experience:A,substance_use_experience:B},{error:b}=await q.from("profiles").update(a).eq("id",p);if(b)throw b;return await (0,f.revalidatePath)("/profile"),{status:"success",message:"Profile updated."}}catch(a){if(a instanceof Error)return{status:"idle",error:a.message};return{status:"idle",error:"We could not update your profile right now."}}};(0,c.registerServerReference)(x,"70ba9926c40a190231a1e41a6b602078bf89aff60e",null);let y=async function(a,b){let c=await (0,h.createSupabaseServerClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)return{status:"idle",error:"Sign in to update your contact details."};let e=(0,q.normalizeEmail)(b.get("email"));if(!e)return d.email?{status:"idle",error:"Enter a valid email address to update your account."}:{status:"idle",message:"Email remains empty. Add one when you are ready."};if(d.email&&d.email.toLowerCase()===e)return{status:"idle",message:"This email is already active on your account."};try{let{error:a}=await c.auth.updateUser({email:e});if(a)throw a;return{status:"success",message:"Check your inbox to confirm the update. We will switch emails once you verify."}}catch(a){if(a instanceof Error)return{status:"idle",error:a.message};return{status:"idle",error:"We could not update your email right now."}}};(0,c.registerServerReference)(y,"606a91c4a11386e7d7a83090ffd66bdb5c0735e1f7",null);let z=async function(a,b){let c=await (0,h.createSupabaseServerClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)return{status:"idle",error:"Sign in to update your contact details."};let e=b.get("intent")??"",g=b.get("stage")??"request";if("cancel"===e)return{status:"idle"};if("verify"===g){let a=b.get("otp_code")?.trim(),d=b.get("otp_phone")??b.get("phone")??"",e=(0,p.normalizePhoneNumber)(d);if(!e)return{status:"otp_sent",error:"Enter the phone number we texted the code to."};if(!a||a.length<4)return{status:"otp_sent",phone:e,maskedPhone:(0,p.maskPhoneNumber)(e)??e,error:"Enter the 6-digit code from your text message."};try{let{error:b}=await c.auth.verifyOtp({phone:e,token:a,type:"phone_change"});if(b)throw b;return await (0,f.revalidatePath)("/profile"),{status:"success",phone:e,message:"Phone number verified."}}catch(b){let a=(0,p.maskPhoneNumber)(e)??e;if(b instanceof Error)return{status:"otp_sent",phone:e,maskedPhone:a,error:b.message};return{status:"otp_sent",phone:e,maskedPhone:a,error:"We could not verify that code. Try again."}}}let i=b.get("phone")??"",j=(0,p.normalizePhoneNumber)(i);if(!j)return{status:"idle",error:"Enter a valid phone number with country code (e.g. +16475551234)."};if(d.phone&&(0,p.normalizePhoneNumber)(d.phone)===j)return{status:"idle",message:"This phone number is already active on your account."};try{let{error:a}=await c.auth.updateUser({phone:j});if(a)throw a;return{status:"otp_sent",phone:j,maskedPhone:(0,p.maskPhoneNumber)(j)??j,message:"We sent a 6-digit verification code to your phone."}}catch(a){if(a instanceof Error)return{status:"idle",error:a.message};return{status:"idle",error:"We could not send a verification code. Try again shortly."}}};(0,c.registerServerReference)(z,"60f02e46daa9f34680b68312895254364a20d08c5e",null);let A=async function(a,b){let c=await (0,h.createSupabaseServerClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)return{status:"idle",error:"Sign in to update your password."};let e=b.get("current_password")??"",f=b.get("new_password")??"",g=b.get("confirm_password")??"";if(!e)return{status:"idle",error:"Enter your current password to continue."};if(f.length<8)return{status:"idle",error:"New password must be at least 8 characters."};if(f!==g)return{status:"idle",error:"New passwords do not match."};try{if(d.email){let{error:a}=await c.auth.signInWithPassword({email:d.email,password:e});if(a)return{status:"idle",error:"Current password is incorrect."}}else{if(!d.phone)return{status:"idle",error:"No contact information found. Add an email or phone before updating the password."};let{error:a}=await c.auth.signInWithPassword({phone:d.phone,password:e});if(a)return{status:"idle",error:"Current password is incorrect."}}let{error:a}=await c.auth.updateUser({password:f});if(a)throw a;return{status:"success",message:"Password updated. Use your new password next time you sign in."}}catch(a){if(a instanceof Error)return{status:"idle",error:a.message};return{status:"idle",error:"We could not update your password right now."}}};async function B(){let a=await (0,g.createSupabaseRSCClient)(),{data:{user:c}}=await a.auth.getUser();c||(0,e.redirect)("/login?next=/profile");let f=await (0,i.ensurePortalProfile)(a,c.id),{data:h}=await a.schema("core").from("organizations").select("id, name, is_active").eq("is_active",!0).order("name",{ascending:!0}),p=(h??[]).map(a=>({id:String(a.id),name:a.name})),q=p.some(a=>Number(a.id)===Number(f.organization_id))?String(f.organization_id):null,r=await (0,s.loadProfileEnums)(a),B=r.affiliationTypes,C=await (0,m.getLivedExperienceStatuses)(a),D=C.map(a=>{let b=n[a];return{value:a,label:b?.label??(0,m.formatEnumLabel)(a),description:b?.description??""}}),E=B.includes(f.affiliation_type)?f.affiliation_type:B[0]??"community_member",F={displayName:f.display_name??"Community member",organizationId:q,positionTitle:f.position_title,affiliationType:E,homelessnessExperience:o(f.homelessness_experience??null,C),substanceUseExperience:o(f.substance_use_experience??null,C),affiliationStatus:f.affiliation_status,requestedOrganizationName:f.requested_organization_name},G=c.email??null,H=c.phone??null;var I=x.bind(null,(0,d.encryptActionBoundArgs)("70ba9926c40a190231a1e41a6b602078bf89aff60e",E,B,C,f.organization_id,f.affiliation_status,f.affiliation_requested_at,f.affiliation_reviewed_at,f.affiliation_reviewed_by,f.id));let J="pending"===f.affiliation_status,K="revoked"===f.affiliation_status;return(0,b.jsxs)("div",{className:"page-shell page-stack",children:[(0,b.jsxs)("header",{className:"flex flex-col gap-space-xs",children:[(0,b.jsx)("h1",{className:"text-headline-lg text-on-surface",children:"Account settings"}),(0,b.jsx)("p",{className:"max-w-3xl text-body-sm text-on-surface/70",children:"Keep your profile details and contact information up to date so neighbours know how you collaborate."})]}),J?(0,b.jsx)("div",{className:"rounded-2xl border border-primary bg-primary-container p-space-md text-body-sm text-on-primary-container",children:"We are confirming your IHARC team role. You can keep contributing as a community member while we verify."}):null,K?(0,b.jsx)("div",{className:"rounded-2xl border border-error bg-error-container p-space-md text-body-sm text-on-error-container",children:"Your verified affiliation was revoked. Reach out to IHARC administrators if circumstances have changed."}):null,(0,b.jsx)(j.ProfileDetailsForm,{organizations:p,action:I,initialState:t,initialValues:F,affiliationOptions:r.affiliationTypes.map(a=>({value:a,label:(0,m.formatEnumLabel)(a)})),livedExperienceOptions:D}),(0,b.jsx)(k.ProfileContactCard,{initialEmail:G,initialPhone:H,emailAction:y,phoneAction:z,initialEmailState:u,initialPhoneState:v}),(0,b.jsx)(l.ProfilePasswordForm,{action:A,initialState:w,hasEmail:!!G,hasPhone:!!H})]})}(0,c.registerServerReference)(A,"60f0a63e8deab51e95f440f1315d1f1db76b399e37",null),a.s(["$$RSC_SERVER_ACTION_0",0,x,"$$RSC_SERVER_ACTION_1",0,y,"$$RSC_SERVER_ACTION_2",0,z,"$$RSC_SERVER_ACTION_3",0,A,"default",()=>B,"dynamic",0,"force-dynamic"],38971)}];

//# sourceMappingURL=_b8771001._.js.map