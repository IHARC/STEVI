module.exports=[93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},50645,a=>{a.n(a.i(27572))},43619,a=>{a.n(a.i(79962))},13718,a=>{a.n(a.i(85523))},18198,a=>{a.n(a.i(45518))},62212,a=>{a.n(a.i(66114))},47907,a=>{a.n(a.i(39621))},35330,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("rounded-[var(--md-sys-shape-corner-medium)] border border-outline/12 bg-surface-container-low text-body-md text-on-surface shadow-level-1",a),...c}));e.displayName="Card";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex flex-col gap-space-sm p-space-lg pb-space-sm text-on-surface",a),...c}));f.displayName="CardHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("h3",{ref:e,className:(0,d.cn)("text-title-lg font-medium leading-tight",a),...c}));g.displayName="CardTitle";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("p",{ref:e,className:(0,d.cn)("text-body-sm text-on-surface-variant",a),...c}));h.displayName="CardDescription";let i=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("p-space-lg pt-0 text-body-md text-on-surface",a),...c}));i.displayName="CardContent",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex items-center gap-space-sm p-space-lg pt-0",a),...c})).displayName="CardFooter",a.s(["Card",()=>e,"CardContent",()=>i,"CardDescription",()=>h,"CardHeader",()=>f,"CardTitle",()=>g])},96942,59797,a=>{"use strict";var b=a.i(84347);let c=a=>"boolean"==typeof a?`${a}`:0===a?"0":a,d=b.clsx;a.s(["cva",0,(a,b)=>e=>{var f;if((null==b?void 0:b.variants)==null)return d(a,null==e?void 0:e.class,null==e?void 0:e.className);let{variants:g,defaultVariants:h}=b,i=Object.keys(g).map(a=>{let b=null==e?void 0:e[a],d=null==h?void 0:h[a];if(null===b)return null;let f=c(b)||c(d);return g[a][f]}),j=e&&Object.entries(e).reduce((a,b)=>{let[c,d]=b;return void 0===d||(a[c]=d),a},{});return d(a,i,null==b||null==(f=b.compoundVariants)?void 0:f.reduce((a,b)=>{let{class:c,className:d,...e}=b;return Object.entries(e).every(a=>{let[b,c]=a;return Array.isArray(c)?c.includes({...h,...j}[b]):({...h,...j})[b]===c})?[...a,c,d]:a},[]),null==e?void 0:e.class,null==e?void 0:e.className)}],96942);let e="hover:state-layer-hover focus-visible:state-layer-focus active:state-layer-pressed",f={primary:`state-layer-color-primary ${e}`,"primary-container":`state-layer-color-primary-container ${e}`,secondary:`state-layer-color-secondary ${e}`,"secondary-container":`state-layer-color-secondary-container ${e}`,surface:`state-layer-color-surface ${e}`,"surface-container":`state-layer-color-surface-container ${e}`,inverse:`state-layer-color-inverse-surface ${e}`,error:`state-layer-color-error ${e}`},g={...f,brand:f.primary,"brand-soft":f["primary-container"],supportive:f.secondary,"supportive-container":f["secondary-container"],destructive:f.error,neutral:f.surface,"neutral-container":f["surface-container"]};function h(a){return a?g[a]:""}a.s(["getStateLayerClasses",()=>h],59797)},38904,63770,a=>{"use strict";let b,c,d;var e=a.i(7997),f=a.i(717);function g(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}function h(...a){return b=>{let c=!1,d=a.map(a=>{let d=g(a,b);return c||"function"!=typeof d||(c=!0),d});if(c)return()=>{for(let b=0;b<d.length;b++){let c=d[b];"function"==typeof c?c():g(a[b],null)}}}}a.s(["composeRefs",()=>h],63770);var i=((d=f.forwardRef((a,b)=>{let{children:c,...d}=a;if(f.isValidElement(c)){var e;let a,g,i=(e=c,(g=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(g=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),j=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==f.Fragment&&(j.ref=b?h(b,i):i),f.cloneElement(c,j)}return f.Children.count(c)>1?f.Children.only(null):null})).displayName="Slot.SlotClone",b=d,(c=f.forwardRef((a,c)=>{let{children:d,...g}=a,h=f.Children.toArray(d),i=h.find(k);if(i){let a=i.props.children,d=h.map(b=>b!==i?b:f.Children.count(a)>1?f.Children.only(null):f.isValidElement(a)?a.props.children:null);return(0,e.jsx)(b,{...g,ref:c,children:f.isValidElement(a)?f.cloneElement(a,void 0,d):null})}return(0,e.jsx)(b,{...g,ref:c,children:d})})).displayName="Slot.Slot",c),j=Symbol("radix.slottable");function k(a){return f.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===j}var l=a.i(96942),m=a.i(39138),n=a.i(59797);let o=(0,l.cva)("inline-flex items-center justify-center gap-space-xs whitespace-nowrap rounded-[var(--md-sys-shape-corner-extra-small)] text-label-lg transition-colors motion-duration-short motion-ease-standard focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-surface disabled:pointer-events-none disabled:opacity-60 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-level-2 hover:bg-primary/92 focus-visible:ring-primary",destructive:"bg-destructive text-destructive-foreground shadow-level-2 hover:bg-destructive/90 focus-visible:ring-destructive",outline:"border border-outline bg-surface text-on-surface shadow-level-1 hover:bg-surface-container focus-visible:ring-primary",secondary:"bg-secondary-container text-on-secondary-container shadow-level-1 hover:bg-secondary-container/90 focus-visible:ring-secondary",ghost:"text-primary focus-visible:ring-primary",link:"text-primary underline-offset-4 hover:underline focus-visible:ring-transparent"},size:{default:"h-10 px-space-md",sm:"h-8 px-space-sm text-label-md",lg:"h-11 px-space-lg text-label-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),p={default:"brand",destructive:"destructive",outline:"neutral",secondary:"supportive-container",ghost:"brand",link:null},q=f.forwardRef(({className:a,variant:b,size:c,stateLayerTone:d,asChild:f=!1,...g},h)=>{let j=p[b??"default"],k=(0,n.getStateLayerClasses)(d??j);return(0,e.jsx)(f?i:"button",{className:(0,m.cn)(o({variant:b,size:c}),k,a),ref:h,...g})});q.displayName="Button",a.s(["Button",()=>q],38904)},9307,a=>{"use strict";function b(a,c="/home"){if(!a)return c;let d=Array.isArray(a)?a[0]:a;return!d||!d.startsWith("/")||d.startsWith("//")?c:d}function c(a){if(!a)return null;let b=Array.isArray(a)?a[0]:a;return"google_auth_cancelled"===b||"google_auth_error"===b?b:null}a.s(["parseAuthErrorCode",()=>c,"resolveNextPath",()=>b])},95798,a=>{"use strict";var b=a.i(9919),c=a.i(52404),d=a.i(10508);async function e(){let a=await (0,b.createSupabaseRSCClient)(),[c,e]=await Promise.all([(0,d.getPolicyCategories)(a),(0,d.getPolicyStatuses)(a)]);return{categories:(0,d.toOptions)(c),statuses:(0,d.toOptions)(e)}}function f(a){return(0,d.formatEnumLabel)(a)}let g=`
  id,
  slug,
  title,
  category,
  short_summary,
  body_html,
  status,
  is_published,
  sort_order,
  last_reviewed_at,
  effective_from,
  effective_to,
  internal_ref,
  created_at,
  updated_at
`;async function h(a={}){let c=(await (0,b.createSupabaseRSCClient)()).schema("portal").from("policies").select(g).order("sort_order",{ascending:!0}).order("title",{ascending:!0});a.includeUnpublished||(c=c.eq("status","published"));let{data:d,error:e}=await c;if(e)throw e;return(d??[]).map(k)}async function i(a,c={}){let d=(await (0,b.createSupabaseRSCClient)()).schema("portal").from("policies").select(g).eq("slug",a).limit(1);c.includeUnpublished||(d=d.eq("status","published"));let{data:e,error:f}=await d.maybeSingle();if(f){if("PGRST116"===f.code)return null;throw f}return e?k(e):null}function j(a){return a.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,80)}function k(a){return{id:a.id,slug:a.slug,title:a.title,category:a.category,shortSummary:a.short_summary,bodyHtml:(0,c.sanitizeResourceHtml)(a.body_html??""),status:a.status,isPublished:!!a.is_published,sortOrder:a.sort_order,lastReviewedAt:a.last_reviewed_at,effectiveFrom:a.effective_from,effectiveTo:a.effective_to,internalRef:a.internal_ref,createdAt:a.created_at,updatedAt:a.updated_at}}a.s(["fetchPolicyEnumOptions",()=>e,"formatPolicyCategoryLabel",()=>f,"getPolicyBySlug",()=>i,"listPolicies",()=>h,"normalizePolicySlug",()=>j])},14962,a=>{"use strict";var b=a.i(7997),c=a.i(39138);function d({eyebrow:a,title:d,description:e,actions:f,align:g="start",padded:h=!1}){let i="center"===g?"max-w-3xl":"max-w-4xl";return(0,b.jsxs)("header",{className:(0,c.cn)("flex w-full flex-col gap-space-2xs","center"===g?"items-center text-center":"items-start text-left",h?"rounded-2xl border border-outline/10 bg-surface px-space-lg py-space-md shadow-level-1":null),children:[a?(0,b.jsx)("p",{className:"inline-flex items-center gap-space-2xs rounded-full bg-surface-container-low px-space-sm py-space-3xs text-label-sm font-semibold uppercase tracking-label-uppercase text-primary",children:a}):null,(0,b.jsx)("h1",{className:(0,c.cn)("text-headline-lg text-on-surface sm:text-display-sm",i),children:d}),e?(0,b.jsx)("div",{className:(0,c.cn)("text-body-md text-muted-foreground sm:text-body-lg",i),children:e}):null,f?(0,b.jsx)("div",{className:"flex flex-wrap gap-space-sm pt-space-sm",children:f}):null]})}a.s(["PageHeader",()=>d])},61569,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call OnboardingWizard() from the server but OnboardingWizard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/onboarding/onboarding-wizard.tsx <module evaluation>","OnboardingWizard");a.s(["OnboardingWizard",0,b])},72861,a=>{"use strict";let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call OnboardingWizard() from the server but OnboardingWizard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/onboarding/onboarding-wizard.tsx","OnboardingWizard");a.s(["OnboardingWizard",0,b])},26089,a=>{"use strict";a.i(61569);var b=a.i(72861);a.n(b)},23946,a=>{"use strict";var b=a.i(7997),c=a.i(95936);a.i(70396);var d=a.i(73727),e=a.i(9919),f=a.i(9307),g=a.i(65108),h=a.i(3412),i=a.i(39016),j=a.i(26089),k=a.i(95798),l=a.i(82465),m=a.i(46592),n=a.i(38904),o=a.i(14962),p=a.i(35330);async function q({searchParams:a}){let q=a?await a:{},u=(0,f.resolveNextPath)(q.next,"/home"),v=function(a){if(!a)return null;let b=Number.parseInt(Array.isArray(a)?a[0]:a,10);return Number.isNaN(b)||b<=0?null:b}(q.person),w=await (0,e.createSupabaseRSCClient)(),{data:{user:x}}=await w.auth.getUser();x||(0,d.redirect)(`/login?next=${encodeURIComponent("/onboarding")}`);let y=await (0,g.loadPortalAccess)(w);y||(0,d.redirect)(`/login?next=${encodeURIComponent("/onboarding")}`);let z=(0,i.resolveOnboardingActor)(y);y.iharcRoles.includes("iharc_admin")&&(0,d.redirect)((0,m.resolveDefaultWorkspacePath)(y));let A="client"===z?null:v,B=await (0,h.getOnboardingStatus)({userId:x.id,personId:A},w),C=B.personId??A??null,[D,E,F,G,H]=await Promise.all([C?r(w,C):Promise.resolve(null),s(w,x.id,y.profile.id),(0,k.getPolicyBySlug)("client-service-agreement"),(0,k.getPolicyBySlug)("client-privacy-notice"),C?t(w,x.id,C):Promise.resolve(!1)]),I=function({person:a,draft:b,fallbackName:c}){let d=a?.first_name??b?.chosen_name??c??"Community member",e=a?.last_name??b?.legal_name??null,f=a?.preferred_pronouns??b?.pronouns??null,g=a?.email??b?.contact_email??null,h=a?.phone??b?.contact_phone??null,i=b?.contact_window??null,j=(0,l.normalizePostalCode)(b?.postal_code??null),k=b?.date_of_birth_month??null,m=b?.date_of_birth_year??null;return{chosenName:d,legalName:e,pronouns:f,email:g,phone:h,preferredContactMethod:a?.preferred_contact_method??(b?.contact_email?"email":"phone"),contactWindow:i,postalCode:j,dobMonth:k,dobYear:m,safeCall:b?.contact_phone_safe_call??!1,safeText:b?.contact_phone_safe_text??!1,safeVoicemail:b?.contact_phone_safe_voicemail??!1,dataSharingConsent:a?.data_sharing_consent??b?.consent_data_sharing??null}}({person:D,draft:E,fallbackName:y.profile.display_name}),J="partner"!==z?null:C?!0===I.dataSharingConsent?null:"This client has not opted into partner sharing. Ask IHARC staff or the client to update sharing before assisting.":"Partner assistance requires an existing client record created by IHARC staff.";return(0,b.jsxs)("div",{className:"page-shell page-stack",children:[(0,b.jsx)(o.PageHeader,{eyebrow:"Onboarding",title:"staff"===z?"Assist a client with onboarding":"Share your details to get support",description:"We keep this process calm and concise. You can save and return anytime; changes respect IHARC’s consent and privacy settings.",padded:!0}),"staff"===z?(0,b.jsxs)(p.Card,{className:"border-outline/14 bg-surface shadow-level-1",children:[(0,b.jsxs)(p.CardHeader,{className:"gap-space-2xs",children:[(0,b.jsx)(p.CardTitle,{className:"text-title-md",children:"Assisted onboarding"}),(0,b.jsx)(p.CardDescription,{children:"Use this wizard while you’re with the client. Start a new record with basic info below, or open an existing client to continue their onboarding where they left off."})]}),(0,b.jsxs)(p.CardContent,{className:"flex flex-wrap gap-space-sm pt-space-xs",children:[y.canAccessAdminWorkspace?(0,b.jsx)(n.Button,{asChild:!0,size:"sm",variant:"secondary",children:(0,b.jsx)(c.default,{href:"/admin/clients",children:"Find existing client"})}):null,y.canAccessStaffWorkspace?(0,b.jsx)(n.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsx)(c.default,{href:"/staff/intake",children:"View intake queue"})}):null,C?(0,b.jsxs)(n.Button,{size:"sm",variant:"ghost",disabled:!0,children:["Working on client #",C]}):null]})]}):null,(y.canManagePolicies||y.canAccessAdminWorkspace)&&(!F||!G)?(0,b.jsx)("div",{className:"rounded-3xl border border-destructive/30 bg-destructive/10 p-space-md text-body-sm text-destructive shadow-level-1",children:"Policy copy missing: publish both “Client Service Agreement” and “Privacy & Data Protection Notice” in Admin → Policies to unblock onboarding."}):null,(y.canManagePolicies||y.canAccessAdminWorkspace)&&!E?(0,b.jsx)("div",{className:"rounded-3xl border border-outline/16 bg-surface-container-low p-space-md text-body-sm text-on-surface/80 shadow-level-1",children:"No registration draft found for this account. Prefill may be empty; this is expected for staff-assisted onboarding."}):null,(0,b.jsx)(j.OnboardingWizard,{initialStatus:B,prefill:I,personId:C,actor:z,nextPath:u,hasAccountLink:H,policies:{service:F?{slug:F.slug,title:F.title,shortSummary:F.shortSummary,bodyHtml:F.bodyHtml}:null,privacy:G?{slug:G.slug,title:G.title,shortSummary:G.shortSummary,bodyHtml:G.bodyHtml}:null},partnerBlockedReason:J})]})}async function r(a,b){let{data:c}=await a.schema("core").from("people").select("id, first_name, last_name, email, phone, preferred_pronouns, preferred_contact_method, data_sharing_consent").eq("id",b).maybeSingle();return c??null}async function s(a,b,c){let d=a.schema("portal"),e=[`supabase_user_id.eq.${b}`,`profile_id.eq.${c}`],f=d.from("registration_flows").select("chosen_name, legal_name, pronouns, contact_email, contact_phone, contact_window, postal_code, date_of_birth_month, date_of_birth_year, contact_phone_safe_call, contact_phone_safe_text, contact_phone_safe_voicemail, consent_data_sharing").order("updated_at",{ascending:!1}).limit(1).or(e.join(",")),{data:g,error:h}=await f.maybeSingle();return h?null:g??null}async function t(a,b,c){let{data:d,error:e}=await a.schema("core").from("user_people").select("id").eq("user_id",b).eq("person_id",c).limit(1).maybeSingle();return!e&&!!d}a.s(["default",()=>q,"dynamic",0,"force-dynamic"])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__dcdb2e53._.js.map