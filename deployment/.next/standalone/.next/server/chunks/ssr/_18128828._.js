module.exports=[19637,a=>{"use strict";var b=a.i(7997),c=a.i(96942),d=a.i(39138),e=a.i(59797);let f=(0,c.cva)("inline-flex items-center rounded-[var(--md-sys-shape-corner-extra-small)] border px-2.5 py-0.5 text-label-sm transition-colors motion-duration-short motion-ease-standard focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}}),g={default:"brand",secondary:"supportive",destructive:"destructive",outline:"neutral"};function h({className:a,variant:c,stateLayerTone:h,...i}){let j=g[c??"default"],k=(0,e.getStateLayerClasses)(h??j);return(0,b.jsx)("div",{className:(0,d.cn)(f({variant:c}),k,a),...i})}a.s(["Badge",()=>h])},35330,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("rounded-[var(--md-sys-shape-corner-medium)] border border-outline/12 bg-surface-container-low text-body-md text-on-surface shadow-level-1",a),...c}));e.displayName="Card";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex flex-col gap-space-sm p-space-lg pb-space-sm text-on-surface",a),...c}));f.displayName="CardHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("h3",{ref:e,className:(0,d.cn)("text-title-lg font-medium leading-tight",a),...c}));g.displayName="CardTitle";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("p",{ref:e,className:(0,d.cn)("text-body-sm text-on-surface-variant",a),...c}));h.displayName="CardDescription";let i=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("p-space-lg pt-0 text-body-md text-on-surface",a),...c}));i.displayName="CardContent",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex items-center gap-space-sm p-space-lg pt-0",a),...c})).displayName="CardFooter",a.s(["Card",()=>e,"CardContent",()=>i,"CardDescription",()=>h,"CardHeader",()=>f,"CardTitle",()=>g])},96942,59797,a=>{"use strict";var b=a.i(84347);let c=a=>"boolean"==typeof a?`${a}`:0===a?"0":a,d=b.clsx;a.s(["cva",0,(a,b)=>e=>{var f;if((null==b?void 0:b.variants)==null)return d(a,null==e?void 0:e.class,null==e?void 0:e.className);let{variants:g,defaultVariants:h}=b,i=Object.keys(g).map(a=>{let b=null==e?void 0:e[a],d=null==h?void 0:h[a];if(null===b)return null;let f=c(b)||c(d);return g[a][f]}),j=e&&Object.entries(e).reduce((a,b)=>{let[c,d]=b;return void 0===d||(a[c]=d),a},{});return d(a,i,null==b||null==(f=b.compoundVariants)?void 0:f.reduce((a,b)=>{let{class:c,className:d,...e}=b;return Object.entries(e).every(a=>{let[b,c]=a;return Array.isArray(c)?c.includes({...h,...j}[b]):({...h,...j})[b]===c})?[...a,c,d]:a},[]),null==e?void 0:e.class,null==e?void 0:e.className)}],96942);let e="hover:state-layer-hover focus-visible:state-layer-focus active:state-layer-pressed",f={primary:`state-layer-color-primary ${e}`,"primary-container":`state-layer-color-primary-container ${e}`,secondary:`state-layer-color-secondary ${e}`,"secondary-container":`state-layer-color-secondary-container ${e}`,surface:`state-layer-color-surface ${e}`,"surface-container":`state-layer-color-surface-container ${e}`,inverse:`state-layer-color-inverse-surface ${e}`,error:`state-layer-color-error ${e}`},g={...f,brand:f.primary,"brand-soft":f["primary-container"],supportive:f.secondary,"supportive-container":f["secondary-container"],destructive:f.error,neutral:f.surface,"neutral-container":f["surface-container"]};function h(a){return a?g[a]:""}a.s(["getStateLayerClasses",()=>h],59797)},38904,63770,a=>{"use strict";let b,c,d;var e=a.i(7997),f=a.i(717);function g(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}function h(...a){return b=>{let c=!1,d=a.map(a=>{let d=g(a,b);return c||"function"!=typeof d||(c=!0),d});if(c)return()=>{for(let b=0;b<d.length;b++){let c=d[b];"function"==typeof c?c():g(a[b],null)}}}}a.s(["composeRefs",()=>h],63770);var i=((d=f.forwardRef((a,b)=>{let{children:c,...d}=a;if(f.isValidElement(c)){var e;let a,g,i=(e=c,(g=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(g=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),j=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==f.Fragment&&(j.ref=b?h(b,i):i),f.cloneElement(c,j)}return f.Children.count(c)>1?f.Children.only(null):null})).displayName="Slot.SlotClone",b=d,(c=f.forwardRef((a,c)=>{let{children:d,...g}=a,h=f.Children.toArray(d),i=h.find(k);if(i){let a=i.props.children,d=h.map(b=>b!==i?b:f.Children.count(a)>1?f.Children.only(null):f.isValidElement(a)?a.props.children:null);return(0,e.jsx)(b,{...g,ref:c,children:f.isValidElement(a)?f.cloneElement(a,void 0,d):null})}return(0,e.jsx)(b,{...g,ref:c,children:d})})).displayName="Slot.Slot",c),j=Symbol("radix.slottable");function k(a){return f.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===j}var l=a.i(96942),m=a.i(39138),n=a.i(59797);let o=(0,l.cva)("inline-flex items-center justify-center gap-space-xs whitespace-nowrap rounded-[var(--md-sys-shape-corner-extra-small)] text-label-lg transition-colors motion-duration-short motion-ease-standard focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-surface disabled:pointer-events-none disabled:opacity-60 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-level-2 hover:bg-primary/92 focus-visible:ring-primary",destructive:"bg-destructive text-destructive-foreground shadow-level-2 hover:bg-destructive/90 focus-visible:ring-destructive",outline:"border border-outline bg-surface text-on-surface shadow-level-1 hover:bg-surface-container focus-visible:ring-primary",secondary:"bg-secondary-container text-on-secondary-container shadow-level-1 hover:bg-secondary-container/90 focus-visible:ring-secondary",ghost:"text-primary focus-visible:ring-primary",link:"text-primary underline-offset-4 hover:underline focus-visible:ring-transparent"},size:{default:"h-10 px-space-md",sm:"h-8 px-space-sm text-label-md",lg:"h-11 px-space-lg text-label-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),p={default:"brand",destructive:"destructive",outline:"neutral",secondary:"supportive-container",ghost:"brand",link:null},q=f.forwardRef(({className:a,variant:b,size:c,stateLayerTone:d,asChild:f=!1,...g},h)=>{let j=p[b??"default"],k=(0,n.getStateLayerClasses)(d??j);return(0,e.jsx)(f?i:"button",{className:(0,m.cn)(o({variant:b,size:c}),k,a),ref:h,...g})});q.displayName="Button",a.s(["Button",()=>q],38904)},22359,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e={indicator:"var(--md-sys-spacing-xs)",control:"calc(var(--md-sys-spacing-sm) - (var(--md-sys-spacing-2xs)/2))",xs:"var(--md-sys-size-icon-xs)",sm:"var(--md-sys-size-icon-sm)",md:"var(--md-sys-size-icon-md)",lg:"var(--md-sys-size-icon-lg)"},f=c.forwardRef(({icon:a,className:c,size:f="md",strokeWidth:g=1.5,decorative:h=!0,style:i,...j},k)=>{let l=e[f]??e.md;return(0,b.jsx)(a,{ref:k,"aria-hidden":!!h||void 0,role:h?void 0:"img",focusable:"false",className:(0,d.cn)("shrink-0 text-inherit",c),style:{width:l,height:l,...i},strokeWidth:g,...j})});f.displayName="Icon",a.s(["Icon",0,f])},1269,a=>{"use strict";var b=a.i(717);let c=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)},d=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let f=(0,b.forwardRef)(({color:a="currentColor",size:c=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,b.createElement)("svg",{ref:l,...e,width:c,height:c,stroke:a,strokeWidth:g?24*Number(f)/Number(c):f,className:d("lucide",h),...!i&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0})(k)&&{"aria-hidden":"true"},...k},[...j.map(([a,c])=>(0,b.createElement)(a,c)),...Array.isArray(i)?i:[i]])),g=(a,e)=>{let g=(0,b.forwardRef)(({className:g,...h},i)=>(0,b.createElement)(f,{ref:i,iconNode:e,className:d(`lucide-${c(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,g),...h}));return g.displayName=c(a),g};a.s(["default",()=>g],1269)},30215,a=>{"use strict";let b=(0,a.i(1269).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["Check",()=>b],30215)},55583,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,type:c,...e},f)=>(0,b.jsx)("input",{type:c,className:(0,d.cn)("flex h-12 w-full rounded-lg border border-outline bg-surface px-space-md py-space-sm text-body-md text-on-surface shadow-level-1 ring-offset-surface transition placeholder:text-on-surface-variant/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-surface data-[invalid=true]:border-error file:border-0 file:bg-transparent file:text-label-sm file:font-medium file:text-on-surface disabled:cursor-not-allowed disabled:opacity-60 md:h-11",a),ref:f,...e}));e.displayName="Input",a.s(["Input",()=>e])},49378,a=>{"use strict";var b=a.i(11857);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call Label() from the server but Label is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/node_modules/@radix-ui/react-label/dist/index.mjs <module evaluation>","Label"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call Root() from the server but Root is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/node_modules/@radix-ui/react-label/dist/index.mjs <module evaluation>","Root");a.s(["Label",0,c,"Root",0,d])},86751,a=>{"use strict";var b=a.i(11857);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call Label() from the server but Label is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/node_modules/@radix-ui/react-label/dist/index.mjs","Label"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call Root() from the server but Root is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/node_modules/@radix-ui/react-label/dist/index.mjs","Root");a.s(["Label",0,c,"Root",0,d])},29558,a=>{"use strict";a.i(49378);var b=a.i(86751);a.n(b)},43562,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(29558),e=a.i(96942),f=a.i(39138);let g=(0,e.cva)("text-label-md font-medium leading-none text-on-surface peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)(d.Root,{ref:e,className:(0,f.cn)(g(),a),...c}));h.displayName=d.Root.displayName,a.s(["Label",()=>h])},63985,a=>{"use strict";let b="[redacted]",c=["password","token","secret","authorization","cookie","session","otp","code","sin","ssn","birth","dob","email","phone","contact","address"];function d(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return b===Object.prototype||null===b}let e=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,f=/^[0-9]+$/,g=/^[a-z0-9_]+$/i,h=/^[a-zA-Z0-9._:-]+$/;function i(a){if(null==a)return null;let b="number"==typeof a?String(a):a.trim?.()??a;return"string"!=typeof b||0===b.length?null:e.test(b)||f.test(b)?b:b.slice(0,128)}function j(a){let b=i(a);return b&&e.test(b)?b:null}function k(a){if(!a)return null;let{schema:b,table:c,id:d}=a;if(!g.test(b)||!g.test(c))return null;let e=i(d);return e&&h.test(e)?`${b.toLowerCase()}.${c.toLowerCase()}:${e}`:null}async function l(a,{actorProfileId:e=null,action:f,entityType:g,entityRef:h,entityId:i,meta:l}){let m=l&&d(l)?function a(e,f){let g={};return Object.entries(e).forEach(([e,h])=>{let i;if(i=e.toLowerCase(),c.some(a=>i.includes(a))){g[e]=b;return}let j=function c(e,f){if(void 0!==e){if(null===e)return null;if("string"==typeof e)return e.length>1024?`${e.slice(0,1024)}...`:e;if("number"==typeof e||"boolean"==typeof e)return e;if("bigint"==typeof e)return e.toString();if(e instanceof Date)return e.toISOString();if(e instanceof URL)return e.toString();if(e instanceof Error)return{name:e.name,message:e.message};if(Array.isArray(e))return e.map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Set)return Array.from(e).map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Map){let a={};return e.forEach((b,d)=>{let e=c(b,f);void 0!==e&&(a[String(d)]=e)}),a}return"object"==typeof e&&d(e)?f.has(e)?b:(f.add(e),a(e,f)):String(e)}}(h,f);void 0!==j&&(g[e]=j)}),g}(l,new WeakSet):{},n="string"==typeof h?h:k(h),o=j(i);!o&&n&&(o=j(n.split(":").pop()??null));let p=!n||"entity_ref"in m?m:{...m,entity_ref:n},q=j(e),{error:r}=await a.rpc("portal_log_audit_event",{p_action:f,p_entity_type:g,p_entity_id:o,p_meta:p,p_actor_profile_id:q});if(r)throw r}a.s(["buildEntityRef",()=>k,"logAuditEvent",()=>l],63985)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},58774,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("textarea",{className:(0,d.cn)("flex min-h-[96px] w-full rounded-lg border border-outline bg-surface px-space-md py-space-sm text-body-md text-on-surface shadow-level-1 ring-offset-surface transition placeholder:text-on-surface-variant/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-surface disabled:cursor-not-allowed disabled:opacity-60",a),ref:e,...c}));e.displayName="Textarea",a.s(["Textarea",()=>e])},45310,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{className:"relative w-full overflow-auto",children:(0,b.jsx)("table",{ref:e,className:(0,d.cn)("w-full caption-bottom text-body-md",a),...c})}));e.displayName="Table";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("thead",{ref:e,className:(0,d.cn)("[&_tr]:border-b",a),...c}));f.displayName="TableHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tbody",{ref:e,className:(0,d.cn)("[&_tr:last-child]:border-0",a),...c}));g.displayName="TableBody",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tfoot",{ref:e,className:(0,d.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...c})).displayName="TableFooter";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tr",{ref:e,className:(0,d.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...c}));h.displayName="TableRow";let i=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("th",{ref:e,className:(0,d.cn)("h-12 px-space-md text-left align-middle text-label-lg font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...c}));i.displayName="TableHead";let j=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("td",{ref:e,className:(0,d.cn)("p-space-md align-middle [&:has([role=checkbox])]:pr-0",a),...c}));j.displayName="TableCell",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("caption",{ref:e,className:(0,d.cn)("mt-space-md text-body-md text-muted-foreground",a),...c})).displayName="TableCaption",a.s(["Table",()=>e,"TableBody",()=>g,"TableCell",()=>j,"TableHead",()=>i,"TableHeader",()=>f,"TableRow",()=>h])},77175,41923,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(16349),e=a.i(42145),f=a.i(63985),g=a.i(65108);let h=[{value:"appointments",label:"Appointments"},{value:"documents",label:"Documents locker"},{value:"notifications",label:"Notifications"},{value:"inventory",label:"Inventory"},{value:"donations",label:"Donations"},{value:"metrics",label:"Metrics"},{value:"org_workspace",label:"Org workspace"}],i=h.map(a=>a.value),j=new Set(i);function k(a){return!!a&&j.has(a)}function l(a){if(!a)return[];if(Array.isArray(a))return a.map(a=>"string"==typeof a?a:null).filter(k);if("object"==typeof a){let b=a.features;if(Array.isArray(b))return b.map(a=>"string"==typeof a?a:null).filter(k)}return[]}function m(a,b){if(Array.isArray(a)){let c=a.map(a=>"string"==typeof a?a:null).filter(a=>!!a&&!k(a));return 0===b.length?c.length?c:null:[...c,...b]}if(a&&"object"==typeof a){let c={...a};return b.length?c.features=b:delete c.features,Object.keys(c).length?c:null}return 0===b.length?null:b}a.s(["ORG_FEATURE_KEYS",0,i,"ORG_FEATURE_OPTIONS",0,h,"extractOrgFeatureFlags",()=>l,"mergeFeatureFlagsIntoTags",()=>m],41923);var n=a.i(13095);let o="/admin/organizations",p=a=>`${o}/${a}`,q=["active","inactive","pending","under_review"],r=["addiction","crisis_support","food_services","housing","mental_health","multi_service","healthcare","government","non_profit","faith_based","community_center","legal_services","other"],s=["referral_partner","service_provider","funding_partner","collaborative_partner","resource_partner","other"];function t(a,b){let c=a.get(b);if("string"!=typeof c)return null;let d=c.trim();return d.length?d:null}function u(a,b,c){let d=t(a,b);if(!d)throw Error(c);return d}function v(a,b,c=!1){let d=a.get(b);if("string"==typeof d){if(["true","1","on","yes"].includes(d.toLowerCase()))return!0;if(["false","0","off","no"].includes(d.toLowerCase()))return!1}return c}function w(a){if("string"!=typeof a)return null;let b=Number.parseInt(a,10);return Number.isNaN(b)?null:b}function x(a,b){return a&&b.includes(a)?a:null}function y(a){return a.getAll("features").map(a=>"string"==typeof a?a.trim():null).filter(a=>!!a&&i.includes(a))}async function z(){let a=await (0,d.createSupabaseServerClient)(),b=await (0,g.loadPortalAccess)(a);if(!b)throw Error("Sign in to continue.");if(!b.portalRoles.includes("portal_admin"))throw Error("Administrator access is required.");let c=await (0,e.ensurePortalProfile)(a,b.userId);return{supabase:a,core:a.schema("core"),portal:a.schema("portal"),actorProfile:c}}async function A(a,b,c,d){let e=a.schema("portal"),{error:f}=await e.rpc("set_profile_role",{p_profile_id:b,p_role_name:c,p_enable:d});if(f)throw f}async function B(a,b){if(b)try{await a.rpc("refresh_user_permissions",{user_uuid:b})}catch(a){console.warn("refresh_user_permissions failed",a)}}function C(a,b){return{success:!1,error:a instanceof Error?a.message:b}}async function D(a){try{let b=u(a,"name","Organization name is required."),d=t(a,"website"),e=x(t(a,"status"),q)??"active",g=x(t(a,"organization_type"),r),h=x(t(a,"partnership_type"),s),i=v(a,"is_active",!1),j=y(a),{supabase:k,core:l,actorProfile:n}=await z(),p=new Date().toISOString(),w=j.length?m(null,j):null,A=await l.from("organizations").insert({name:b,website:d,organization_type:g,partnership_type:h,status:e,is_active:i,created_by:n.id,updated_by:n.id,created_at:p,updated_at:p,services_tags:w}).select("id").maybeSingle();if(A.error)throw A.error;return A.data&&await (0,f.logAuditEvent)(k,{actorProfileId:n.id,action:"organization_created",entityType:"organization",entityRef:(0,f.buildEntityRef)({schema:"core",table:"organizations",id:A.data.id}),meta:{pk_int:A.data.id,name:b,status:e,features:j}}),await (0,c.revalidatePath)(o),{success:!0}}catch(a){return console.error("createOrganizationAction error",a),C(a,"Unable to create organization.")}}async function E(a){try{let b=w(a.get("organization_id"));if(!b)throw Error("Organization context is missing.");let d=u(a,"name","Organization name is required."),e=t(a,"website"),g=t(a,"email"),h=t(a,"phone"),i=x(t(a,"organization_type"),r),j=x(t(a,"partnership_type"),s),k=x(t(a,"status"),q)??"active",l=v(a,"is_active",!1),n=t(a,"description"),A=t(a,"services_provided"),B=t(a,"address"),C=t(a,"city"),D=t(a,"province"),E=t(a,"postal_code"),F=t(a,"contact_person"),G=t(a,"contact_title"),H=t(a,"contact_phone"),I=t(a,"contact_email"),J=t(a,"operating_hours"),K=t(a,"availability_notes"),L=t(a,"referral_process"),M=t(a,"special_requirements"),N=t(a,"notes"),O=y(a),{supabase:P,core:Q,actorProfile:R}=await z(),{data:S,error:T}=await Q.from("organizations").select("services_tags, name").eq("id",b).maybeSingle();if(T||!S)throw T??Error("Organization not found.");let U=m(S.services_tags,O),V=new Date().toISOString(),W={name:d,website:e,email:g,phone:h,organization_type:i,partnership_type:j,status:k,is_active:l,description:n,services_provided:A,address:B,city:C,province:D,postal_code:E,contact_person:F,contact_title:G,contact_phone:H,contact_email:I,operating_hours:J,availability_notes:K,referral_process:L,special_requirements:M,notes:N,services_tags:U,updated_at:V,updated_by:R.id},{error:X}=await Q.from("organizations").update(W).eq("id",b);if(X)throw X;return await (0,f.logAuditEvent)(P,{actorProfileId:R.id,action:"organization_updated",entityType:"organization",entityRef:(0,f.buildEntityRef)({schema:"core",table:"organizations",id:b}),meta:{pk_int:b,status:k,is_active:l,features:O}}),await Promise.all([(0,c.revalidatePath)(o),(0,c.revalidatePath)(p(b))]),{success:!0}}catch(a){return console.error("updateOrganizationAction error",a),C(a,"Unable to update organization.")}}async function F(a){try{let b=w(a.get("organization_id"));if(!b)throw Error("Organization context is missing.");let d=t(a,"confirm_name"),{supabase:e,core:g,portal:h,actorProfile:i}=await z(),{data:j,error:k}=await g.from("organizations").select("name").eq("id",b).maybeSingle();if(k||!j)throw k??Error("Organization not found.");if(!d||d.toLowerCase().trim()!==j.name.toLowerCase())throw Error("Type the organization name to confirm deletion.");let[{count:l},{count:m},{count:n}]=await Promise.all([h.from("profiles").select("id",{count:"exact",head:!0}).eq("organization_id",b),h.from("profile_invites").select("id",{count:"exact",head:!0}).eq("organization_id",b),g.from("organization_people").select("id",{count:"exact",head:!0}).eq("organization_id",b)]);if((l??0)>0||(m??0)>0||(n??0)>0)throw Error("Remove or reassign members, invites, and linked people before deleting this organization.");let{error:p}=await g.from("organizations").delete().eq("id",b);if(p){if("23503"===p.code)throw Error("Cannot delete this organization because related records still exist.");throw p}return await (0,f.logAuditEvent)(e,{actorProfileId:i.id,action:"organization_deleted",entityType:"organization",entityRef:(0,f.buildEntityRef)({schema:"core",table:"organizations",id:b}),meta:{pk_int:b}}),await (0,c.revalidatePath)(o),{success:!0}}catch(a){return console.error("deleteOrganizationAction error",a),C(a,"Unable to delete organization.")}}async function G(a){try{let b=w(a.get("organization_id")),d=t(a,"profile_id"),e=v(a,"make_admin",!1),g=v(a,"make_rep",!1);if(!b||!d)throw Error("Profile and organization are required.");if(!e&&!g)throw Error("Select at least one role for the member.");let{supabase:h,portal:i,actorProfile:j}=await z(),{data:k,error:l}=await i.from("profiles").select("id, user_id, organization_id").eq("id",d).maybeSingle();if(l||!k)throw l??Error("Profile not found.");let m=new Date().toISOString(),{error:n}=await i.from("profiles").update({organization_id:b,affiliation_status:"approved",affiliation_reviewed_at:m,affiliation_reviewed_by:j.id,updated_at:m}).eq("id",d);if(n)throw n;return await Promise.all([A(h,d,"portal_org_admin",e),A(h,d,"portal_org_rep",g||e)]),await B(h,k.user_id),await (0,f.logAuditEvent)(h,{actorProfileId:j.id,action:"org_member_attached",entityType:"profile",entityRef:(0,f.buildEntityRef)({schema:"portal",table:"profiles",id:d}),meta:{organization_id:b,make_admin:e,make_rep:g}}),await Promise.all([(0,c.revalidatePath)(o),(0,c.revalidatePath)(p(b))]),{success:!0}}catch(a){return console.error("attachOrgMemberAction error",a),C(a,"Unable to add member.")}}async function H(a){try{let b=w(a.get("organization_id")),d=t(a,"profile_id"),e=t(a,"role_name"),g=v(a,"enable",!1);if(!b||!d||!e)throw Error("Missing role context.");if("portal_org_admin"!==e&&"portal_org_rep"!==e)throw Error("Unsupported role.");let{supabase:h,portal:i,actorProfile:j}=await z(),{data:k,error:l}=await i.from("profiles").select("id, organization_id, user_id").eq("id",d).maybeSingle();if(l||!k)throw l??Error("Member not found.");if(k.organization_id!==b)throw Error("Member does not belong to this organization.");return await A(h,d,e,g),await B(h,k.user_id??null),await (0,f.logAuditEvent)(h,{actorProfileId:j.id,action:g?"org_role_granted":"org_role_revoked",entityType:"profile",entityRef:(0,f.buildEntityRef)({schema:"portal",table:"profiles",id:d}),meta:{organization_id:b,role:e}}),await (0,c.revalidatePath)(p(b)),{success:!0}}catch(a){return console.error("adminToggleOrgMemberRoleAction error",a),C(a,"Unable to update member role.")}}async function I(a){try{let b=w(a.get("organization_id")),d=t(a,"profile_id");if(!b||!d)throw Error("Member context is missing.");let{supabase:e,portal:g,actorProfile:h}=await z(),{data:i,error:j}=await g.from("profiles").select("id, organization_id, user_id").eq("id",d).maybeSingle();if(j||!i)throw j??Error("Member not found.");if(i.organization_id!==b)throw Error("Member does not belong to this organization.");let k=new Date().toISOString();for(let a of["portal_org_admin","portal_org_rep"])try{await A(e,d,a,!1)}catch(b){console.warn(`Failed to revoke ${a} role when removing member`,b)}let{error:l}=await g.from("profiles").update({organization_id:null,updated_at:k}).eq("id",d);if(l)throw l;return await B(e,i.user_id??null),await (0,f.logAuditEvent)(e,{actorProfileId:h.id,action:"org_member_removed",entityType:"profile",entityRef:(0,f.buildEntityRef)({schema:"portal",table:"profiles",id:d}),meta:{organization_id:b}}),await (0,c.revalidatePath)(p(b)),{success:!0}}catch(a){return console.error("adminRemoveOrgMemberAction error",a),C(a,"Unable to remove member.")}}(0,n.ensureServerEntryExports)([D,E,F,G,H,I]),(0,b.registerServerReference)(D,"4080609d50b5cf5b3d33c7e1137a69d52a6d6a90c4",null),(0,b.registerServerReference)(E,"40dd757dfb67f34fee1dad955a7c0a541566f2d484",null),(0,b.registerServerReference)(F,"40589e6132aca61018d08150deab69bf8b00940101",null),(0,b.registerServerReference)(G,"409cd60fb3123e6882e30d164e64ebd523e0edf08c",null),(0,b.registerServerReference)(H,"4041b919bc1688f605bdd5131e671fac39b2bf4a55",null),(0,b.registerServerReference)(I,"40eec4085a13bd85d094fafe1b23fb313b3813447c",null),a.s(["adminRemoveOrgMemberAction",()=>I,"adminToggleOrgMemberRoleAction",()=>H,"attachOrgMemberAction",()=>G,"createOrganizationAction",()=>D,"deleteOrganizationAction",()=>F,"updateOrganizationAction",()=>E],77175)},35762,a=>{"use strict";var b=a.i(86731),c=a.i(64153),d=a.i(77175);a.s([],76665),a.i(76665),a.s(["00b7ee4fee263fec1fe8acb860989f6ddb47485e3a",()=>b.$$RSC_SERVER_ACTION_0,"4041b919bc1688f605bdd5131e671fac39b2bf4a55",()=>d.adminToggleOrgMemberRoleAction,"404a92a85f795c40de8e7974d99b633e134e135600",()=>c.$$RSC_SERVER_ACTION_3,"404cb3e641abfb3aa12ecb321b1d4a8a89404267ab",()=>c.$$RSC_SERVER_ACTION_0,"40589e6132aca61018d08150deab69bf8b00940101",()=>d.deleteOrganizationAction,"405b63c1a4f60f89c84784420700e3e9d5439c1497",()=>c.$$RSC_SERVER_ACTION_2,"4080609d50b5cf5b3d33c7e1137a69d52a6d6a90c4",()=>d.createOrganizationAction,"408138480e876f019773478c0dedad434e098280a7",()=>c.$$RSC_SERVER_ACTION_1,"409cd60fb3123e6882e30d164e64ebd523e0edf08c",()=>d.attachOrgMemberAction,"40dd757dfb67f34fee1dad955a7c0a541566f2d484",()=>d.updateOrganizationAction,"40edf247a8e20a974b7b449a2ab4236b527d1706a4",()=>c.$$RSC_SERVER_ACTION_4,"40eec4085a13bd85d094fafe1b23fb313b3813447c",()=>d.adminRemoveOrgMemberAction],35762)}];

//# sourceMappingURL=_18128828._.js.map