module.exports=[63985,a=>{"use strict";let b="[redacted]",c=["password","token","secret","authorization","cookie","session","otp","code","sin","ssn","birth","dob","email","phone","contact","address"];function d(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return b===Object.prototype||null===b}let e=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,f=/^[0-9]+$/,g=/^[a-z0-9_]+$/i,h=/^[a-zA-Z0-9._:-]+$/;function i(a){if(null==a)return null;let b="number"==typeof a?String(a):a.trim?.()??a;return"string"!=typeof b||0===b.length?null:e.test(b)||f.test(b)?b:b.slice(0,128)}function j(a){let b=i(a);return b&&e.test(b)?b:null}function k(a){if(!a)return null;let{schema:b,table:c,id:d}=a;if(!g.test(b)||!g.test(c))return null;let e=i(d);return e&&h.test(e)?`${b.toLowerCase()}.${c.toLowerCase()}:${e}`:null}async function l(a,{actorProfileId:e=null,action:f,entityType:g,entityRef:h,entityId:i,meta:l}){let m=l&&d(l)?function a(e,f){let g={};return Object.entries(e).forEach(([e,h])=>{let i;if(i=e.toLowerCase(),c.some(a=>i.includes(a))){g[e]=b;return}let j=function c(e,f){if(void 0!==e){if(null===e)return null;if("string"==typeof e)return e.length>1024?`${e.slice(0,1024)}...`:e;if("number"==typeof e||"boolean"==typeof e)return e;if("bigint"==typeof e)return e.toString();if(e instanceof Date)return e.toISOString();if(e instanceof URL)return e.toString();if(e instanceof Error)return{name:e.name,message:e.message};if(Array.isArray(e))return e.map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Set)return Array.from(e).map(a=>c(a,f)).filter(a=>void 0!==a);if(e instanceof Map){let a={};return e.forEach((b,d)=>{let e=c(b,f);void 0!==e&&(a[String(d)]=e)}),a}return"object"==typeof e&&d(e)?f.has(e)?b:(f.add(e),a(e,f)):String(e)}}(h,f);void 0!==j&&(g[e]=j)}),g}(l,new WeakSet):{},n="string"==typeof h?h:k(h),o=j(i);!o&&n&&(o=j(n.split(":").pop()??null));let p=!n||"entity_ref"in m?m:{...m,entity_ref:n},q=j(e),{error:r}=await a.rpc("portal_log_audit_event",{p_action:f,p_entity_type:g,p_entity_id:o,p_meta:p,p_actor_profile_id:q});if(r)throw r}a.s(["buildEntityRef",()=>k,"logAuditEvent",()=>l],63985)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},44545,a=>{"use strict";var b=a.i(86731),c=a.i(37936),d=a.i(18558),e=a.i(16349),f=a.i(42145),g=a.i(63985),h=a.i(65108),i=a.i(13095);let j="/org/members";async function k(){let a=await (0,e.createSupabaseServerClient)(),b=await (0,h.loadPortalAccess)(a);if(!b)throw Error("Sign in to continue.");if(!b.canManageOrgUsers)throw Error("Organization admin access is required.");let c=await (0,f.ensurePortalProfile)(a,b.userId);if(!c.organization_id)throw Error("Your profile is not linked to an organization.");let d=a.schema("portal");return{supabase:a,portal:d,actorProfile:c}}async function l(a,b){let c=a.schema("portal"),{error:d}=await c.rpc("set_profile_role",{p_profile_id:b.profileId,p_role_name:b.roleName,p_enable:b.enable});if(d)throw d}async function m(a){try{let b=a.get("profile_id"),c=a.get("role_name"),e=a.get("enable");if("string"!=typeof b||"string"!=typeof c||"string"!=typeof e)throw Error("Invalid form data.");let f="true"===e;if("portal_org_admin"!==c&&"portal_org_rep"!==c)throw Error("Unsupported role.");let{supabase:h,portal:i,actorProfile:m}=await k(),{data:n,error:o}=await i.from("profiles").select("id, organization_id, user_id").eq("id",b).maybeSingle();if(o||!n)throw o??Error("Member not found.");if(n.organization_id!==m.organization_id)throw Error("You can only manage members in your organization.");return await l(h,{profileId:b,roleName:c,enable:f}),await (0,g.logAuditEvent)(h,{actorProfileId:m.id,action:f?"org_role_granted":"org_role_revoked",entityType:"profile",entityRef:(0,g.buildEntityRef)({schema:"portal",table:"profiles",id:b}),meta:{role:c,organization_id:m.organization_id}}),await (0,d.revalidatePath)(j),{success:!0}}catch(a){return console.error("toggleMemberRoleAction error",a),{success:!1,error:a instanceof Error?a.message:"Unable to update member."}}}async function n(a){try{let b=a.get("profile_id");if("string"!=typeof b)throw Error("Missing member id.");let{supabase:c,portal:e,actorProfile:f}=await k(),{data:h,error:i}=await e.from("profiles").select("id, organization_id").eq("id",b).maybeSingle();if(i||!h)throw i??Error("Member not found.");if(h.organization_id!==f.organization_id)throw Error("You can only remove members from your organization.");let m=new Date().toISOString();for(let a of["portal_org_admin","portal_org_rep"])try{await l(c,{profileId:b,roleName:a,enable:!1})}catch(b){console.warn(`Failed to revoke ${a} role when removing member`,b)}let n=await e.from("profiles").update({organization_id:null,updated_at:m}).eq("id",b);if(n.error)throw n.error;return await (0,g.logAuditEvent)(c,{actorProfileId:f.id,action:"org_member_removed",entityType:"profile",entityRef:(0,g.buildEntityRef)({schema:"portal",table:"profiles",id:b}),meta:{organization_id:f.organization_id}}),await (0,d.revalidatePath)(j),{success:!0}}catch(a){return console.error("removeMemberAction error",a),{success:!1,error:a instanceof Error?a.message:"Unable to remove member."}}}(0,i.ensureServerEntryExports)([m,n]),(0,c.registerServerReference)(m,"405dd1f997612e490d8925326021e1036c46c9cab9",null),(0,c.registerServerReference)(n,"40c902b3dbdc60cffb63d2516810fded4652ab4135",null),a.s([],80997),a.i(80997),a.s(["00b7ee4fee263fec1fe8acb860989f6ddb47485e3a",()=>b.$$RSC_SERVER_ACTION_0,"405dd1f997612e490d8925326021e1036c46c9cab9",()=>m,"40c902b3dbdc60cffb63d2516810fded4652ab4135",()=>n],44545)}];

//# sourceMappingURL=_7885f13d._.js.map