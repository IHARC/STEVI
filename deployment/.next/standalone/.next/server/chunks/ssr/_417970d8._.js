module.exports=[49378,a=>{"use strict";var b=a.i(11857);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call Label() from the server but Label is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/node_modules/@radix-ui/react-label/dist/index.mjs <module evaluation>","Label"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call Root() from the server but Root is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/node_modules/@radix-ui/react-label/dist/index.mjs <module evaluation>","Root");a.s(["Label",0,c,"Root",0,d])},86751,a=>{"use strict";var b=a.i(11857);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call Label() from the server but Label is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/node_modules/@radix-ui/react-label/dist/index.mjs","Label"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call Root() from the server but Root is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/node_modules/@radix-ui/react-label/dist/index.mjs","Root");a.s(["Label",0,c,"Root",0,d])},29558,a=>{"use strict";a.i(49378);var b=a.i(86751);a.n(b)},43562,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(29558),e=a.i(96942),f=a.i(39138);let g=(0,e.cva)("text-label-md font-medium leading-none text-on-surface peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)(d.Root,{ref:e,className:(0,f.cn)(g(),a),...c}));h.displayName=d.Root.displayName,a.s(["Label",()=>h])},55583,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,type:c,...e},f)=>(0,b.jsx)("input",{type:c,className:(0,d.cn)("flex h-12 w-full rounded-lg border border-outline bg-surface px-space-md py-space-sm text-body-md text-on-surface shadow-level-1 ring-offset-surface transition placeholder:text-on-surface-variant/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-surface data-[invalid=true]:border-error file:border-0 file:bg-transparent file:text-label-sm file:font-medium file:text-on-surface disabled:cursor-not-allowed disabled:opacity-60 md:h-11",a),ref:f,...e}));e.displayName="Input",a.s(["Input",()=>e])},1269,a=>{"use strict";var b=a.i(717);let c=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)},d=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let f=(0,b.forwardRef)(({color:a="currentColor",size:c=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,b.createElement)("svg",{ref:l,...e,width:c,height:c,stroke:a,strokeWidth:g?24*Number(f)/Number(c):f,className:d("lucide",h),...!i&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0})(k)&&{"aria-hidden":"true"},...k},[...j.map(([a,c])=>(0,b.createElement)(a,c)),...Array.isArray(i)?i:[i]])),g=(a,e)=>{let g=(0,b.forwardRef)(({className:g,...h},i)=>(0,b.createElement)(f,{ref:i,iconNode:e,className:d(`lucide-${c(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,g),...h}));return g.displayName=c(a),g};a.s(["default",()=>g],1269)},30215,a=>{"use strict";let b=(0,a.i(1269).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["Check",()=>b],30215)},45310,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{className:"relative w-full overflow-auto",children:(0,b.jsx)("table",{ref:e,className:(0,d.cn)("w-full caption-bottom text-body-md",a),...c})}));e.displayName="Table";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("thead",{ref:e,className:(0,d.cn)("[&_tr]:border-b",a),...c}));f.displayName="TableHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tbody",{ref:e,className:(0,d.cn)("[&_tr:last-child]:border-0",a),...c}));g.displayName="TableBody",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tfoot",{ref:e,className:(0,d.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...c})).displayName="TableFooter";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tr",{ref:e,className:(0,d.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...c}));h.displayName="TableRow";let i=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("th",{ref:e,className:(0,d.cn)("h-12 px-space-md text-left align-middle text-label-lg font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...c}));i.displayName="TableHead";let j=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("td",{ref:e,className:(0,d.cn)("p-space-md align-middle [&:has([role=checkbox])]:pr-0",a),...c}));j.displayName="TableCell",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("caption",{ref:e,className:(0,d.cn)("mt-space-md text-body-md text-muted-foreground",a),...c})).displayName="TableCaption",a.s(["Table",()=>e,"TableBody",()=>g,"TableCell",()=>j,"TableHead",()=>i,"TableHeader",()=>f,"TableRow",()=>h])},77175,41923,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(16349),e=a.i(42145),f=a.i(63985),g=a.i(65108);let h=[{value:"appointments",label:"Appointments"},{value:"documents",label:"Documents locker"},{value:"notifications",label:"Notifications"},{value:"inventory",label:"Inventory"},{value:"donations",label:"Donations"},{value:"metrics",label:"Metrics"},{value:"org_workspace",label:"Org workspace"}],i=h.map(a=>a.value),j=new Set(i);function k(a){return!!a&&j.has(a)}function l(a){if(!a)return[];if(Array.isArray(a))return a.map(a=>"string"==typeof a?a:null).filter(k);if("object"==typeof a){let b=a.features;if(Array.isArray(b))return b.map(a=>"string"==typeof a?a:null).filter(k)}return[]}function m(a,b){if(Array.isArray(a)){let c=a.map(a=>"string"==typeof a?a:null).filter(a=>!!a&&!k(a));return 0===b.length?c.length?c:null:[...c,...b]}if(a&&"object"==typeof a){let c={...a};return b.length?c.features=b:delete c.features,Object.keys(c).length?c:null}return 0===b.length?null:b}a.s(["ORG_FEATURE_KEYS",0,i,"ORG_FEATURE_OPTIONS",0,h,"extractOrgFeatureFlags",()=>l,"mergeFeatureFlagsIntoTags",()=>m],41923);var n=a.i(13095);let o="/admin/organizations",p=a=>`${o}/${a}`,q=["active","inactive","pending","under_review"],r=["addiction","crisis_support","food_services","housing","mental_health","multi_service","healthcare","government","non_profit","faith_based","community_center","legal_services","other"],s=["referral_partner","service_provider","funding_partner","collaborative_partner","resource_partner","other"];function t(a,b){let c=a.get(b);if("string"!=typeof c)return null;let d=c.trim();return d.length?d:null}function u(a,b,c){let d=t(a,b);if(!d)throw Error(c);return d}function v(a,b,c=!1){let d=a.get(b);if("string"==typeof d){if(["true","1","on","yes"].includes(d.toLowerCase()))return!0;if(["false","0","off","no"].includes(d.toLowerCase()))return!1}return c}function w(a){if("string"!=typeof a)return null;let b=Number.parseInt(a,10);return Number.isNaN(b)?null:b}function x(a,b){return a&&b.includes(a)?a:null}function y(a){return a.getAll("features").map(a=>"string"==typeof a?a.trim():null).filter(a=>!!a&&i.includes(a))}async function z(){let a=await (0,d.createSupabaseServerClient)(),b=await (0,g.loadPortalAccess)(a);if(!b)throw Error("Sign in to continue.");if(!b.portalRoles.includes("portal_admin"))throw Error("Administrator access is required.");let c=await (0,e.ensurePortalProfile)(a,b.userId);return{supabase:a,core:a.schema("core"),portal:a.schema("portal"),actorProfile:c}}async function A(a,b,c,d){let e=a.schema("portal"),{error:f}=await e.rpc("set_profile_role",{p_profile_id:b,p_role_name:c,p_enable:d});if(f)throw f}async function B(a,b){if(b)try{await a.rpc("refresh_user_permissions",{user_uuid:b})}catch(a){console.warn("refresh_user_permissions failed",a)}}function C(a,b){return{success:!1,error:a instanceof Error?a.message:b}}async function D(a){try{let b=u(a,"name","Organization name is required."),d=t(a,"website"),e=x(t(a,"status"),q)??"active",g=x(t(a,"organization_type"),r),h=x(t(a,"partnership_type"),s),i=v(a,"is_active",!1),j=y(a),{supabase:k,core:l,actorProfile:n}=await z(),p=new Date().toISOString(),w=j.length?m(null,j):null,A=await l.from("organizations").insert({name:b,website:d,organization_type:g,partnership_type:h,status:e,is_active:i,created_by:n.id,updated_by:n.id,created_at:p,updated_at:p,services_tags:w}).select("id").maybeSingle();if(A.error)throw A.error;return A.data&&await (0,f.logAuditEvent)(k,{actorProfileId:n.id,action:"organization_created",entityType:"organization",entityRef:(0,f.buildEntityRef)({schema:"core",table:"organizations",id:A.data.id}),meta:{pk_int:A.data.id,name:b,status:e,features:j}}),await (0,c.revalidatePath)(o),{success:!0}}catch(a){return console.error("createOrganizationAction error",a),C(a,"Unable to create organization.")}}async function E(a){try{let b=w(a.get("organization_id"));if(!b)throw Error("Organization context is missing.");let d=u(a,"name","Organization name is required."),e=t(a,"website"),g=t(a,"email"),h=t(a,"phone"),i=x(t(a,"organization_type"),r),j=x(t(a,"partnership_type"),s),k=x(t(a,"status"),q)??"active",l=v(a,"is_active",!1),n=t(a,"description"),A=t(a,"services_provided"),B=t(a,"address"),C=t(a,"city"),D=t(a,"province"),E=t(a,"postal_code"),F=t(a,"contact_person"),G=t(a,"contact_title"),H=t(a,"contact_phone"),I=t(a,"contact_email"),J=t(a,"operating_hours"),K=t(a,"availability_notes"),L=t(a,"referral_process"),M=t(a,"special_requirements"),N=t(a,"notes"),O=y(a),{supabase:P,core:Q,actorProfile:R}=await z(),{data:S,error:T}=await Q.from("organizations").select("services_tags, name").eq("id",b).maybeSingle();if(T||!S)throw T??Error("Organization not found.");let U=m(S.services_tags,O),V=new Date().toISOString(),W={name:d,website:e,email:g,phone:h,organization_type:i,partnership_type:j,status:k,is_active:l,description:n,services_provided:A,address:B,city:C,province:D,postal_code:E,contact_person:F,contact_title:G,contact_phone:H,contact_email:I,operating_hours:J,availability_notes:K,referral_process:L,special_requirements:M,notes:N,services_tags:U,updated_at:V,updated_by:R.id},{error:X}=await Q.from("organizations").update(W).eq("id",b);if(X)throw X;return await (0,f.logAuditEvent)(P,{actorProfileId:R.id,action:"organization_updated",entityType:"organization",entityRef:(0,f.buildEntityRef)({schema:"core",table:"organizations",id:b}),meta:{pk_int:b,status:k,is_active:l,features:O}}),await Promise.all([(0,c.revalidatePath)(o),(0,c.revalidatePath)(p(b))]),{success:!0}}catch(a){return console.error("updateOrganizationAction error",a),C(a,"Unable to update organization.")}}async function F(a){try{let b=w(a.get("organization_id"));if(!b)throw Error("Organization context is missing.");let d=t(a,"confirm_name"),{supabase:e,core:g,portal:h,actorProfile:i}=await z(),{data:j,error:k}=await g.from("organizations").select("name").eq("id",b).maybeSingle();if(k||!j)throw k??Error("Organization not found.");if(!d||d.toLowerCase().trim()!==j.name.toLowerCase())throw Error("Type the organization name to confirm deletion.");let[{count:l},{count:m},{count:n}]=await Promise.all([h.from("profiles").select("id",{count:"exact",head:!0}).eq("organization_id",b),h.from("profile_invites").select("id",{count:"exact",head:!0}).eq("organization_id",b),g.from("organization_people").select("id",{count:"exact",head:!0}).eq("organization_id",b)]);if((l??0)>0||(m??0)>0||(n??0)>0)throw Error("Remove or reassign members, invites, and linked people before deleting this organization.");let{error:p}=await g.from("organizations").delete().eq("id",b);if(p){if("23503"===p.code)throw Error("Cannot delete this organization because related records still exist.");throw p}return await (0,f.logAuditEvent)(e,{actorProfileId:i.id,action:"organization_deleted",entityType:"organization",entityRef:(0,f.buildEntityRef)({schema:"core",table:"organizations",id:b}),meta:{pk_int:b}}),await (0,c.revalidatePath)(o),{success:!0}}catch(a){return console.error("deleteOrganizationAction error",a),C(a,"Unable to delete organization.")}}async function G(a){try{let b=w(a.get("organization_id")),d=t(a,"profile_id"),e=v(a,"make_admin",!1),g=v(a,"make_rep",!1);if(!b||!d)throw Error("Profile and organization are required.");if(!e&&!g)throw Error("Select at least one role for the member.");let{supabase:h,portal:i,actorProfile:j}=await z(),{data:k,error:l}=await i.from("profiles").select("id, user_id, organization_id").eq("id",d).maybeSingle();if(l||!k)throw l??Error("Profile not found.");let m=new Date().toISOString(),{error:n}=await i.from("profiles").update({organization_id:b,affiliation_status:"approved",affiliation_reviewed_at:m,affiliation_reviewed_by:j.id,updated_at:m}).eq("id",d);if(n)throw n;return await Promise.all([A(h,d,"portal_org_admin",e),A(h,d,"portal_org_rep",g||e)]),await B(h,k.user_id),await (0,f.logAuditEvent)(h,{actorProfileId:j.id,action:"org_member_attached",entityType:"profile",entityRef:(0,f.buildEntityRef)({schema:"portal",table:"profiles",id:d}),meta:{organization_id:b,make_admin:e,make_rep:g}}),await Promise.all([(0,c.revalidatePath)(o),(0,c.revalidatePath)(p(b))]),{success:!0}}catch(a){return console.error("attachOrgMemberAction error",a),C(a,"Unable to add member.")}}async function H(a){try{let b=w(a.get("organization_id")),d=t(a,"profile_id"),e=t(a,"role_name"),g=v(a,"enable",!1);if(!b||!d||!e)throw Error("Missing role context.");if("portal_org_admin"!==e&&"portal_org_rep"!==e)throw Error("Unsupported role.");let{supabase:h,portal:i,actorProfile:j}=await z(),{data:k,error:l}=await i.from("profiles").select("id, organization_id, user_id").eq("id",d).maybeSingle();if(l||!k)throw l??Error("Member not found.");if(k.organization_id!==b)throw Error("Member does not belong to this organization.");return await A(h,d,e,g),await B(h,k.user_id??null),await (0,f.logAuditEvent)(h,{actorProfileId:j.id,action:g?"org_role_granted":"org_role_revoked",entityType:"profile",entityRef:(0,f.buildEntityRef)({schema:"portal",table:"profiles",id:d}),meta:{organization_id:b,role:e}}),await (0,c.revalidatePath)(p(b)),{success:!0}}catch(a){return console.error("adminToggleOrgMemberRoleAction error",a),C(a,"Unable to update member role.")}}async function I(a){try{let b=w(a.get("organization_id")),d=t(a,"profile_id");if(!b||!d)throw Error("Member context is missing.");let{supabase:e,portal:g,actorProfile:h}=await z(),{data:i,error:j}=await g.from("profiles").select("id, organization_id, user_id").eq("id",d).maybeSingle();if(j||!i)throw j??Error("Member not found.");if(i.organization_id!==b)throw Error("Member does not belong to this organization.");let k=new Date().toISOString();for(let a of["portal_org_admin","portal_org_rep"])try{await A(e,d,a,!1)}catch(b){console.warn(`Failed to revoke ${a} role when removing member`,b)}let{error:l}=await g.from("profiles").update({organization_id:null,updated_at:k}).eq("id",d);if(l)throw l;return await B(e,i.user_id??null),await (0,f.logAuditEvent)(e,{actorProfileId:h.id,action:"org_member_removed",entityType:"profile",entityRef:(0,f.buildEntityRef)({schema:"portal",table:"profiles",id:d}),meta:{organization_id:b}}),await (0,c.revalidatePath)(p(b)),{success:!0}}catch(a){return console.error("adminRemoveOrgMemberAction error",a),C(a,"Unable to remove member.")}}(0,n.ensureServerEntryExports)([D,E,F,G,H,I]),(0,b.registerServerReference)(D,"4080609d50b5cf5b3d33c7e1137a69d52a6d6a90c4",null),(0,b.registerServerReference)(E,"40dd757dfb67f34fee1dad955a7c0a541566f2d484",null),(0,b.registerServerReference)(F,"40589e6132aca61018d08150deab69bf8b00940101",null),(0,b.registerServerReference)(G,"409cd60fb3123e6882e30d164e64ebd523e0edf08c",null),(0,b.registerServerReference)(H,"4041b919bc1688f605bdd5131e671fac39b2bf4a55",null),(0,b.registerServerReference)(I,"40eec4085a13bd85d094fafe1b23fb313b3813447c",null),a.s(["adminRemoveOrgMemberAction",()=>I,"adminToggleOrgMemberRoleAction",()=>H,"attachOrgMemberAction",()=>G,"createOrganizationAction",()=>D,"deleteOrganizationAction",()=>F,"updateOrganizationAction",()=>E],77175)}];

//# sourceMappingURL=_417970d8._.js.map