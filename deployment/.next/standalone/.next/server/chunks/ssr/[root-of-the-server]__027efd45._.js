module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},16349,a=>{"use strict";var b=a.i(5246);a.i(42537);var c=a.i(5860),d=a.i(31507);async function e(){let{url:a,anonKey:e}=(0,d.getSupabaseEnv)(),f=await (0,b.cookies)();return(0,c.createServerClient)(a,e,{cookies:{getAll:()=>f.getAll(),setAll(a){a.forEach(({name:a,value:b,options:c})=>{try{f.set(a,b,{path:"/",sameSite:"lax",httpOnly:!0,secure:!0,...c})}catch(a){}})}}})}a.s(["createSupabaseServerClient",()=>e])},6687,a=>{"use strict";function b(a){if("string"!=typeof a)return;let b=a.trim();if(!b)return;let c=b.startsWith("+"),d=b.replace(/\D+/g,"");if(d){if(c)return`+${d}`;if(10===d.length)return`+1${d}`;if(d.length>10)return`+${d}`}}function c(a){let c=b(a);if(!c)return"";let d=c.slice(-4),e=c.slice(0,Math.max(2,c.length-4)).replace(/\d/g,"*");return`${e}${d}`}a.s(["maskPhoneNumber",()=>c,"normalizePhoneNumber",()=>b])},66680,(a,b,c)=>{b.exports=a.x("node:crypto",()=>require("node:crypto"))},82465,a=>{"use strict";var b=a.i(66680);let c="0123456789";function d(a=8){if(a<=0)throw Error("Portal code length must be greater than zero");let e="";for(let d=0;d<a;d+=1){let a=b.default.randomInt(0,c.length);e+=c[a]}return e}function e(a){if(!a)return null;let b=a.replace(/[^0-9A-Za-z]/g,"").toUpperCase();return b.length<=4?b:8===b.length?`${b.slice(0,4)}-${b.slice(4)}`:9===b.length?`${b.slice(0,3)}-${b.slice(3,6)}-${b.slice(6)}`:b}function f(a){if("string"!=typeof a)return null;let b=a.trim();return 0===b.length?null:b}function g(a){if(!a)return null;let b=a.replace(/[^0-9A-Za-z]/g,"").toUpperCase();return b?6===b.length?`${b.slice(0,3)} ${b.slice(3)}`:b:null}a.s(["emptyToNull",()=>f,"formatPortalCode",()=>e,"generatePortalCode",()=>d,"normalizePostalCode",()=>g])},37199,a=>{"use strict";var b=a.i(7997),c=a.i(39138);let d={"form-sm":"max-w-form-sm","form-md":"max-w-form-md","form-lg":"max-w-form-lg",xl:"max-w-page",page:"max-w-page"};function e({children:a,eyebrow:e,title:f,description:g,actions:h,maxWidth:i="form-lg",align:j="start",spacing:k="lg"}){let l="center"===j?"max-w-2xl":"max-w-3xl",m=!!(e||f||g||h);return(0,b.jsx)("div",{className:"page-shell",children:(0,b.jsxs)("div",{className:(0,c.cn)("mx-auto flex w-full flex-col","md"===k?"gap-space-lg":"gap-space-xl",d[i]),children:[m?(0,b.jsxs)("header",{className:(0,c.cn)("flex w-full flex-col gap-space-xs","center"===j?"items-center text-center":"items-start text-left"),children:[e?(0,b.jsx)("p",{className:"text-label-sm font-medium uppercase text-muted-foreground",children:e}):null,f?(0,b.jsx)("h1",{className:(0,c.cn)("text-headline-lg text-on-surface sm:text-display-sm",l),children:f}):null,g?"string"==typeof g?(0,b.jsx)("p",{className:(0,c.cn)("text-body-md text-muted-foreground sm:text-body-lg",l),children:g}):(0,b.jsx)("div",{className:(0,c.cn)("text-body-md text-muted-foreground sm:text-body-lg",l),children:g}):null,h?(0,b.jsx)("div",{className:"flex flex-wrap gap-space-sm pt-space-sm",children:h}):null]}):null,a]})})}a.s(["FormPageShell",()=>e])},12573,a=>{"use strict";async function b({supabase:a,type:b,limit:c,cooldownMs:d}){let{data:e,error:f}=await a.rpc("portal_check_rate_limit",{p_event:b,p_limit:c,p_cooldown_ms:d??null});if(f)throw f;let[g]=e??[];return!g||g.allowed?{allowed:!0,retryInMs:0}:{allowed:!1,retryInMs:Math.max(g.retry_in_ms??0,0)||1e3}}a.s(["checkRateLimit",()=>b])},81401,a=>{"use strict";var b=a.i(11857);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call CONCERN_REPORT_INITIAL_STATE() from the server but CONCERN_REPORT_INITIAL_STATE is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/register/_components/concern-report-form.tsx <module evaluation>","CONCERN_REPORT_INITIAL_STATE"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call ConcernReportForm() from the server but ConcernReportForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/register/_components/concern-report-form.tsx <module evaluation>","ConcernReportForm");a.s(["CONCERN_REPORT_INITIAL_STATE",0,c,"ConcernReportForm",0,d])},22365,a=>{"use strict";var b=a.i(11857);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call CONCERN_REPORT_INITIAL_STATE() from the server but CONCERN_REPORT_INITIAL_STATE is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/register/_components/concern-report-form.tsx","CONCERN_REPORT_INITIAL_STATE"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call ConcernReportForm() from the server but ConcernReportForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/app/register/_components/concern-report-form.tsx","ConcernReportForm");a.s(["CONCERN_REPORT_INITIAL_STATE",0,c,"ConcernReportForm",0,d])},93700,a=>{"use strict";a.i(81401);var b=a.i(22365);a.n(b)},87177,a=>{"use strict";var b=a.i(7997),c=a.i(37936),d=a.i(93700),e=a.i(82465),f=a.i(16349),g=a.i(6687),h=a.i(12573),i=a.i(37199);let j=async function(a,b){let c=(0,e.emptyToNull)(b.get("category"))??"other",d=(0,e.emptyToNull)(b.get("description"))??"",i=(0,e.emptyToNull)(b.get("location"))??"",j=(0,e.emptyToNull)(b.get("additional_details")),k=(0,e.emptyToNull)(b.get("contact_preference"))??"anonymous",l="email"===k||"phone"===k?k:"anonymous",m="email"===l?(0,e.emptyToNull)(b.get("contact_email")?.toLowerCase()??null):null,n="phone"===l?(0,g.normalizePhoneNumber)(b.get("contact_phone"))??null:null;if(!d||d.length<10)return{status:"idle",error:"Share a few details about what happened so we can respond appropriately."};if(!i)return{status:"idle",error:"Let us know where this happened so we can direct the right outreach team."};if("email"===l&&!m)return{status:"idle",error:"Enter the email where we can send updates, or switch to the anonymous option."};if("phone"===l&&!n)return{status:"idle",error:"Enter a valid phone number for follow-up, or choose the anonymous option."};let o=await (0,f.createSupabaseServerClient)(),p=await (0,h.checkRateLimit)({supabase:o,type:"registration_concern",limit:5,cooldownMs:3e5});if(!p.allowed){let a;return{status:"idle",error:(a=Math.max(1,Math.ceil(p.retryInMs/6e4)),`Weâ€™re receiving many requests. Please wait about ${a} minute${1===a?"":"s"} and try again.`)}}let q=o.schema("portal"),r={category:c,description:d,location:i,additional_details:j,contact_preference:l},s=null;for(let a=0;a<6;a+=1){let a=(0,e.generatePortalCode)(),b={flow_type:"concern_report",status:"submitted",portal_code:a,chosen_name:"anonymous"===l?"Anonymous reporter":"Concern reporter",contact_email:m,contact_phone:n,consent_data_sharing:!0,consent_contact:"anonymous"!==l,consent_terms:!0,metadata:r},{error:c}=await q.from("registration_flows").insert(b);if(!c){s=a;break}if("23505"!==c.code)return console.error("Unable to store concern report",c),{status:"idle",error:"We could not submit your concern right now. Please try again or contact IHARC staff directly."}}return s?{status:"success",trackingCode:(0,e.formatPortalCode)(s),message:"We logged your concern. A member of the IHARC team will review and follow up if you requested it."}:{status:"idle",error:"We could not generate a tracking code. Try again or contact IHARC staff."}};async function k(){return(0,b.jsx)(i.FormPageShell,{maxWidth:"form-lg",children:(0,b.jsx)(d.ConcernReportForm,{action:j,initialState:d.CONCERN_REPORT_INITIAL_STATE})})}(0,c.registerServerReference)(j,"60de36d14f354453dd00668d8fa9cf95aa06ee8681",null),a.s(["$$RSC_SERVER_ACTION_0",0,j,"default",()=>k,"dynamic",0,"force-dynamic"])},7730,a=>{"use strict";var b=a.i(87177);a.s([],74898),a.i(74898),a.s(["60de36d14f354453dd00668d8fa9cf95aa06ee8681",()=>b.$$RSC_SERVER_ACTION_0],7730)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__027efd45._.js.map