module.exports=[79799,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),o=e.i(61916),i=e.i(14444),s=e.i(37092),l=e.i(69741),u=e.i(16795),c=e.i(87718),d=e.i(95169),p=e.i(47587),f=e.i(66012),h=e.i(70101),g=e.i(26937),m=e.i(10372),R=e.i(93695);e.i(52474);var v=e.i(5232),w=e.i(89171),_=e.i(26500),A=e.i(60360);function C(e,t="/home"){if(!e)return t;let r=Array.isArray(e)?e[0]:e;return!r||!r.startsWith("/")||r.startsWith("//")?t:r}var b=e.i(77596),E=e.i(86939);let x=["admin","org","staff","client"];function y(e){let t=(0,E.getWorkspaceNavBlueprint)(e);if(t?.defaultRoute)return t.defaultRoute;switch(e){case"admin":return"/admin";case"org":return"/org";case"staff":return"/staff";default:return"/home"}}function P(e={}){return{id:"client",label:"Client portal",href:y("client"),description:"Client-facing navigation for neighbours using STEVI.",roleLabel:"Client",statusLabel:"Approved",statusTone:"neutral",...e}}function T(e,t){switch(t){case"admin":if(e.portalRoles.includes("portal_admin"))return"Portal admin";if(e.iharcRoles.includes("iharc_admin"))return"IHARC admin";if(e.portalRoles.includes("portal_org_admin"))return"Org admin";return"Admin";case"org":if(e.portalRoles.includes("portal_org_admin"))return"Org admin";if(e.portalRoles.includes("portal_org_rep"))return"Org rep";return"Organization";case"staff":if(e.iharcRoles.includes("iharc_supervisor"))return"IHARC supervisor";if(e.iharcRoles.includes("iharc_staff"))return"IHARC staff";if(e.iharcRoles.includes("iharc_volunteer"))return"Volunteer";return"Staff";default:return"Client"}}function O(e){let t=e.profile.affiliation_status;return"approved"===t?"Approved":"pending"===t?"Pending review":"revoked"===t?"Suspended":"Unknown"}function S(e){let t=e.profile.affiliation_status;return"approved"===t?"success":"pending"===t?"warning":"revoked"===t?"critical":"neutral"}async function k(e){var t,r,a,n;let o=new URL(e.url),i=o.searchParams.get("code"),s=o.searchParams.get("error"),l=o.searchParams.get("error_description"),u="register"===o.searchParams.get("flow")?"register":"login",c=o.searchParams.get("next")??void 0;if(!i){let a,n=(t=s,a=(r=l)?r.toLowerCase():null,(t||a)&&("access_denied"===t||a&&a.includes("access_denied"))?"google_auth_cancelled":"google_auth_error");return H(e,u,C(c),n)}try{let t,r=await (0,_.createSupabaseServerClient)(),{error:o}=await r.auth.exchangeCodeForSession(i);if(o)return console.error("Google OAuth exchange failed",o),H(e,u,C(c),"google_auth_error");await N(r);let s=await (0,b.loadPortalAccess)(r),l=C(c,function(e){let t=function(e){if(!e)return[P()];let t=[P({roleLabel:T(e,"client"),statusLabel:O(e),statusTone:S(e)})];return e.canAccessAdminWorkspace&&t.push({id:"admin",label:"Admin workspace",href:y("admin"),description:"Team tooling for moderation, content, and operations.",roleLabel:T(e,"admin"),statusLabel:O(e),statusTone:S(e)}),e.canAccessOrgWorkspace&&t.push({id:"org",label:"Organization workspace",href:y("org"),description:"Org-scoped controls for members, invites, and settings.",roleLabel:T(e,"org"),statusLabel:O(e),statusTone:S(e)}),e.canAccessStaffWorkspace&&t.push({id:"staff",label:"Staff workspace",href:y("staff"),description:"IHARC staff and volunteer caseload + outreach tools.",roleLabel:T(e,"staff"),statusLabel:O(e),statusTone:S(e)}),t}(e),r=x.find(e=>t.some(t=>t.id===e));if(r){let e=t.find(e=>e.id===r);if(e)return e}return P()}(s).href);return a=e,n=l,t=new URL(n,U(a)),w.NextResponse.redirect(t)}catch(t){return console.error("Unexpected error during Google OAuth exchange",t),H(e,u,C(c),"google_auth_error")}}async function N(e){var t;let{data:{user:r},error:a}=await e.auth.getUser();if(a||!r){a&&console.error("Unable to load user after Google OAuth exchange",a);return}let n=r.user_metadata??{},o="string"==typeof n.full_name&&n.full_name||"string"==typeof n.name&&n.name||"string"==typeof n.preferred_username&&n.preferred_username||(r.email?r.email.split("@")[0]:null),i=o?.trim()?(t=o.trim(),t.length>80?t.slice(0,80):t):"Community Member",s="string"==typeof n.avatar_url?n.avatar_url:null;try{await (0,A.ensurePortalProfile)(e,r.id,{display_name:i,avatar_url:s})}catch(e){console.error("Unable to ensure portal profile after Google sign-in",e)}}function U(e){let t=e.headers.get("x-forwarded-host"),r=e.headers.get("x-forwarded-proto");if(t&&r)return`${r}://${t}`;let a=new URL(e.url);return`${a.protocol}//${a.host}`}function H(e,t,r,a){let n=new URL("register"===t?"/register":"/login",U(e));return n.searchParams.set("error",a),r&&"login"===t&&n.searchParams.set("next",r),w.NextResponse.redirect(n)}e.s(["GET",()=>k],69920);var I=e.i(69920);let L=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/auth/callback/route",pathname:"/auth/callback",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/auth/callback/route.ts",nextConfigOutput:"standalone",userland:I}),{workAsyncStorage:M,workUnitAsyncStorage:q,serverHooks:D}=L;function $(){return(0,a.patchFetch)({workAsyncStorage:M,workUnitAsyncStorage:q})}async function F(e,t,a){L.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/auth/callback/route";w=w.replace(/\/index$/,"")||"/";let _=await L.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!_)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:A,params:C,nextConfig:b,parsedUrl:E,isDraftMode:x,prerenderManifest:y,routerServerContext:P,isOnDemandRevalidate:T,revalidateOnlyGenerated:O,resolvedPathname:S,clientReferenceManifest:k,serverActionsManifest:N}=_,U=(0,l.normalizeAppPath)(w),H=!!(y.dynamicRoutes[U]||y.routes[S]),I=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,E,!1):t.end("This page could not be found"),null);if(H&&!x){let e=!!y.routes[S],t=y.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await I();throw new R.NoFallbackError}}let M=null;!H||L.isDev||x||(M="/index"===(M=S)?"/":M);let q=!0===L.isDev||!H,D=H&&!q;N&&k&&(0,i.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:k,serverActionsManifest:N,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:N})});let $=e.method||"GET",F=(0,o.getTracer)(),G=F.getActiveScopeSpan(),K={params:C,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>L.onRequestError(e,t,a,P)},sharedContext:{buildId:A}},W=new u.NodeNextRequest(e),j=new u.NodeNextResponse(t),B=c.NextRequestAdapter.fromNodeNextRequest(W,(0,c.signalFromNodeResponse)(t));try{let i=async e=>L.handle(B,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${$} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${w}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let u=async({previousCacheEntry:r})=>{try{if(!s&&T&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=K.renderOpts.collectedTags;if(!H)return await (0,f.sendResponse)(W,j,o,K.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await L.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:T})},P),t}},c=await L.handleResponse({req:e,nextConfig:b,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:O,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:s});if(!H)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",T?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&H||d.delete(m.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,f.sendResponse)(W,j,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};G?await l(G):await F.withPropagatedContext(e.headers,()=>F.trace(d.BaseServerSpan.handleRequest,{spanName:`${$} ${w}`,kind:o.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await L.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:T})}),H)throw t;return await (0,f.sendResponse)(W,j,new Response(null,{status:500})),null}}e.s(["handler",()=>F,"patchFetch",()=>$,"routeModule",()=>L,"serverHooks",()=>D,"workAsyncStorage",()=>M,"workUnitAsyncStorage",()=>q],79799)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_aa74f994.js.map